<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product Research Tracker â€” Anton Empire</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#05060a;--bg2:#0a0b12;--surface:#0f1018;--card:#12131d;--card2:#181924;
  --border:#1a1b28;--border2:#252638;--border-hl:#2f3050;
  --text:#eeeef2;--text2:#b8b8cc;--sub:#7c7c96;--dim:#4a4a62;
  --accent:#7c5cfc;--accent2:#9b7dff;--accent3:#c0afff;--accent-glow:rgba(124,92,252,.12);
  --green:#0fd68c;--green-bg:rgba(15,214,140,.08);--green-border:rgba(15,214,140,.18);
  --red:#ff4d6a;--red-bg:rgba(255,77,106,.08);--red-border:rgba(255,77,106,.18);
  --amber:#ffb020;--amber-bg:rgba(255,176,32,.08);--amber-border:rgba(255,176,32,.18);
  --blue:#4d9eff;--blue-bg:rgba(77,158,255,.08);--blue-border:rgba(77,158,255,.18);
  --teal:#00d4aa;--teal-bg:rgba(0,212,170,.08);
  --pink:#ff6baa;--pink-bg:rgba(255,107,170,.08);
  --radius:14px;--radius-sm:10px;--radius-xs:7px;
  --shadow:0 2px 8px rgba(0,0,0,.3),0 0 1px rgba(124,92,252,.06);
  --shadow-lg:0 8px 32px rgba(0,0,0,.4);
  --glow:0 0 20px rgba(124,92,252,.08);
}
html{scroll-behavior:smooth}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--sub)}

.app{max-width:1800px;margin:0 auto;padding:20px 24px 40px}

/* â•â•â• TOPBAR â•â•â• */
.topbar{display:flex;justify-content:space-between;align-items:center;padding:20px 0 24px;border-bottom:1px solid var(--border)}
.brand{display:flex;align-items:center;gap:14px}
.brand-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),#5c3cdc);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 16px rgba(124,92,252,.25)}
.brand h1{font-size:22px;font-weight:800;letter-spacing:-.4px}
.brand h1 em{font-style:normal;background:linear-gradient(135deg,var(--accent2),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.brand-sub{font-size:11px;color:var(--sub);font-weight:400;margin-top:1px;letter-spacing:.2px}
.topbar-actions{display:flex;gap:6px;align-items:center}

/* â•â•â• BUTTONS â•â•â• */
button,.btn{font-family:'Inter',sans-serif;font-weight:600;cursor:pointer;transition:all .15s;border:none;outline:none}
.btn-p{background:linear-gradient(135deg,var(--accent),#5c3cdc);color:#fff;padding:10px 22px;border-radius:var(--radius-xs);font-size:13px;box-shadow:0 3px 12px rgba(124,92,252,.2)}
.btn-p:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(124,92,252,.3)}
.btn-o{background:var(--card2);border:1px solid var(--border2);color:var(--text2);padding:7px 14px;border-radius:var(--radius-xs);font-size:11px;letter-spacing:.2px}
.btn-o:hover{border-color:var(--accent);color:var(--accent2);background:var(--accent-glow)}
.btn-d{background:var(--red-bg);color:var(--red);border:1px solid var(--red-border);padding:5px 10px;border-radius:var(--radius-xs);font-size:10px}
.btn-d:hover{background:var(--red);color:#fff}
.btn-g{background:transparent;color:var(--sub);border:none;padding:5px;font-size:11px;border-radius:var(--radius-xs)}
.btn-g:hover{color:var(--text);background:var(--card2)}
.badge{font-size:11px;padding:6px 16px;border-radius:24px;font-weight:700;background:linear-gradient(135deg,var(--accent),#5c3cdc);color:#fff;letter-spacing:.2px;box-shadow:0 2px 10px rgba(124,92,252,.2)}

/* â•â•â• TABS â•â•â• */
.tabs{display:flex;gap:2px;margin:20px 0 16px;background:var(--surface);border-radius:var(--radius-sm);padding:3px;border:1px solid var(--border)}
.tab{padding:10px 20px;border-radius:var(--radius-xs);font-size:12px;font-weight:600;color:var(--sub);cursor:pointer;transition:all .15s;letter-spacing:.2px}
.tab:hover{color:var(--text)}
.tab.active{background:var(--card2);color:var(--text);box-shadow:var(--shadow)}
.tab-panel{display:none}.tab-panel.active{display:block}

/* â•â•â• STAT CARDS â•â•â• */
.stats{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-bottom:18px}
@media(max-width:1200px){.stats{grid-template-columns:repeat(4,1fr)}}
@media(max-width:640px){.stats{grid-template-columns:repeat(2,1fr)}}
.stat{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px 18px;position:relative;overflow:hidden;transition:all .15s}
.stat:hover{border-color:var(--border2);transform:translateY(-1px)}
.stat::after{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.stat.c1::after{background:linear-gradient(90deg,var(--accent),var(--accent2))}
.stat.c2::after{background:var(--green)}.stat.c3::after{background:var(--amber)}
.stat.c4::after{background:var(--red)}.stat.c5::after{background:var(--blue)}
.stat.c6::after{background:var(--teal)}.stat.c7::after{background:var(--pink)}
.stat-n{font-size:28px;font-weight:800;letter-spacing:-.5px;line-height:1}
.stat-l{font-size:9px;color:var(--sub);text-transform:uppercase;letter-spacing:.8px;font-weight:600;margin-top:5px}

/* â•â•â• CARD â•â•â• */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:16px;overflow:hidden;box-shadow:var(--shadow)}
.card-h{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border)}
.card-t{font-size:13px;font-weight:700;display:flex;align-items:center;gap:8px;letter-spacing:-.1px}
.card-body{padding:20px}

/* â•â•â• FORM â•â•â• */
.fg{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.fi{display:flex;flex-direction:column;gap:4px}
.fi label{font-size:9px;color:var(--sub);text-transform:uppercase;letter-spacing:.6px;font-weight:700}
.fi input,.fi select,.fi textarea{background:var(--bg2);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:var(--radius-xs);font-size:12px;font-family:'Inter',sans-serif;outline:none;transition:all .15s}
.fi input::placeholder,.fi textarea::placeholder{color:var(--dim)}
.fi input:focus,.fi select:focus,.fi textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,92,252,.08)}
.fi textarea{resize:vertical;min-height:70px;line-height:1.5}
.fi-full{grid-column:1/-1}
.fi-2{grid-column:span 2}

.scoring-bar{margin-top:14px;padding-top:14px;border-top:1px solid var(--border)}
.scoring-bar .lbl{font-size:10px;font-weight:700;color:var(--accent2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px}
.sg{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.sg .fi input{text-align:center;font-weight:800;font-size:16px;padding:8px}

/* Collapse */
.coll-trigger{cursor:pointer;user-select:none}.coll-trigger .chev{transition:transform .2s;display:inline-block;font-size:10px;margin-left:4px}
.coll-trigger.open .chev{transform:rotate(180deg)}
.coll-body{transition:max-height .3s,opacity .2s,padding .2s}.coll-body.shut{max-height:0;opacity:0;padding:0 20px!important;overflow:hidden}.coll-body.show{max-height:4000px;opacity:1}

/* â•â•â• FILTERS â•â•â• */
.filters{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:12px}
.pill{padding:6px 14px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);color:var(--sub);background:transparent;transition:all .15s;letter-spacing:.2px}
.pill:hover{border-color:var(--accent);color:var(--accent2)}
.pill.on{background:linear-gradient(135deg,var(--accent),#5c3cdc);color:#fff;border-color:transparent;box-shadow:0 2px 10px rgba(124,92,252,.2)}
.search-wrap{position:relative;display:inline-block}
.search-wrap input{width:220px;padding-left:30px;background:var(--bg2);border:1px solid var(--border);color:var(--text);padding:8px 10px 8px 30px;border-radius:var(--radius-xs);font-size:12px;font-family:'Inter',sans-serif;outline:none}
.search-wrap input:focus{border-color:var(--accent)}
.search-wrap::before{content:'ğŸ”';position:absolute;left:9px;top:50%;transform:translateY(-50%);font-size:11px;opacity:.3}

/* â•â•â• TABLE â•â•â• */
.tw{overflow-x:auto;max-height:68vh;overflow-y:auto;border:1px solid var(--border);border-radius:var(--radius-sm)}
table{width:100%;border-collapse:collapse;font-size:11px;table-layout:auto}
thead{position:sticky;top:0;z-index:10}
th{text-align:left;padding:11px 12px;color:var(--sub);font-size:9px;text-transform:uppercase;letter-spacing:.7px;font-weight:700;background:var(--card2);border-bottom:2px solid var(--border);cursor:pointer;white-space:nowrap}
th:hover{color:var(--accent2)}
th .si{opacity:.25;font-size:8px;margin-left:2px}th:hover .si{opacity:.6}
td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:top}
tr{transition:background .1s}tr:hover td{background:var(--accent-glow)}tr:last-child td{border-bottom:none}

/* Cell */
.pname{font-weight:700;font-size:12px;line-height:1.35;color:var(--text)}
.plink{display:inline-flex;gap:3px;color:var(--accent2);font-size:9px;text-decoration:none;font-weight:500;opacity:.6;transition:.15s}
.plink:hover{opacity:1}
.score-b{display:inline-flex;align-items:center;justify-content:center;min-width:40px;padding:4px 8px;border-radius:6px;font-weight:800;font-size:12px}
.s-hi{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
.s-md{background:var(--amber-bg);color:var(--amber);border:1px solid var(--amber-border)}
.s-lo{background:var(--red-bg);color:var(--red);border:1px solid var(--red-border)}
.chip{display:inline-flex;align-items:center;gap:3px;padding:4px 12px;border-radius:20px;font-size:9px;font-weight:700;letter-spacing:.3px;text-transform:uppercase;white-space:nowrap}
.ch-new{background:var(--blue-bg);color:var(--blue);border:1px solid var(--blue-border)}
.ch-res{background:var(--accent-glow);color:var(--accent2);border:1px solid rgba(124,92,252,.15)}
.ch-src{background:var(--amber-bg);color:var(--amber);border:1px solid var(--amber-border)}
.ch-tst{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
.ch-kil{background:var(--red-bg);color:var(--red);border:1px solid var(--red-border)}
.ch-scl{background:var(--teal-bg);color:var(--teal);border:1px solid rgba(0,212,170,.15)}
.tag{display:inline-block;padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600}
.tag-n{background:var(--card2);color:var(--text2);border:1px solid var(--border)}
.tag-f{background:var(--accent-glow);color:var(--accent3);border:1px solid rgba(124,92,252,.15)}
.tag-mrr{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border);font-size:8px;font-weight:800;letter-spacing:.3px}
.m-hi{color:var(--green);font-weight:700}.m-md{color:var(--amber);font-weight:700}.m-lo{color:var(--red);font-weight:700}
.money{font-variant-numeric:tabular-nums;font-weight:500}
.notes{max-width:240px;white-space:normal;word-wrap:break-word;color:var(--text2);font-size:10px;line-height:1.45}
.empty{text-align:center;padding:50px 20px;color:var(--dim)}
.empty-icon{font-size:36px;margin-bottom:10px;opacity:.2}
.empty-t{font-size:13px;font-weight:600;color:var(--sub);margin-bottom:3px}
.empty-s{font-size:11px}

/* â•â•â• TOOLTIP CARD â•â•â• */
.tt-card{position:absolute;z-index:100;background:var(--card2);border:1px solid var(--border2);border-radius:var(--radius);padding:18px 20px;width:420px;box-shadow:var(--shadow-lg),0 0 40px rgba(0,0,0,.5);pointer-events:none;opacity:0;transition:opacity .15s;font-size:11px;line-height:1.6}
.tt-card.vis{opacity:1;pointer-events:auto}
.tt-card h4{font-size:13px;font-weight:800;margin-bottom:8px;color:var(--accent2);display:flex;align-items:center;gap:6px}
.tt-card .tt-section{margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.tt-card .tt-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.tt-card .tt-label{font-size:8px;text-transform:uppercase;letter-spacing:.8px;font-weight:700;color:var(--sub);margin-bottom:3px}
.tt-card .tt-row{display:flex;justify-content:space-between;align-items:center;padding:2px 0}
.tt-card .tt-key{color:var(--text2);font-size:10px}
.tt-card .tt-val{font-weight:700;font-size:11px}
.tt-card .tt-verdict{background:var(--accent-glow);border:1px solid rgba(124,92,252,.15);border-radius:var(--radius-xs);padding:10px 12px;margin-top:6px}
.tt-card .tt-verdict .tt-label{color:var(--accent2)}
.tt-card .tt-verdict p{color:var(--text);font-size:10px;line-height:1.5;margin:0}
.tt-card .tt-timeline{display:flex;flex-direction:column;gap:3px}
.tt-card .tt-tl-item{display:flex;align-items:center;gap:6px;font-size:9px;color:var(--text2)}
.tt-card .tt-tl-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.tt-card .tt-tl-date{color:var(--sub);min-width:65px}

/* â•â•â• VERDICT CELL â•â•â• */
.verdict-cell{max-width:180px;font-size:10px;color:var(--text2);line-height:1.4;cursor:pointer}
.verdict-cell:hover{color:var(--accent2)}
.verdict-short{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:160px}

/* â•â•â• TOAST â•â•â• */
.toast{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:var(--radius-sm);font-size:12px;font-weight:600;font-family:'Inter',sans-serif;transform:translateY(80px);opacity:0;transition:all .3s cubic-bezier(.16,1,.3,1);z-index:1000;box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:6px}
.toast.show{transform:translateY(0);opacity:1}
.toast.ok{background:var(--green);color:#000}.toast.err{background:var(--red);color:#fff}

/* â•â•â• FOOTER â•â•â• */
.footer{text-align:center;padding:20px 0;font-size:9px;color:var(--dim);letter-spacing:.3px}

/* â•â•â• ANIM â•â•â• */
@keyframes fi{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.card,.stat{animation:fi .25s ease both}
.stat:nth-child(2){animation-delay:.03s}.stat:nth-child(3){animation-delay:.06s}
.stat:nth-child(4){animation-delay:.09s}.stat:nth-child(5){animation-delay:.12s}
.stat:nth-child(6){animation-delay:.15s}.stat:nth-child(7){animation-delay:.18s}

@media(max-width:768px){.app{padding:12px}.fg{grid-template-columns:1fr 1fr}.sg{grid-template-columns:repeat(4,1fr)}}
</style>
</head>
<body>
<!-- Global Nav Bar -->
<div style="background:rgba(17,17,17,0.95);border-bottom:1px solid #333;padding:6px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)">
  <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
    <a href="../" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ  Home</a>
      <a href="../dashboard/" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ“Š Command Centre</a>
      <a href="../tracker/" style="font-size:10px;text-decoration:none;color:var(--accent);padding:3px 8px;border-radius:4px;background:rgba(124,58,237,0.1);font-weight:700">ğŸ” Tracker</a>
      <a href="../hub/" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ“ SOPs</a>
      <a href="../org/" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ‘¥ Org</a>
      <a href="../memory/" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ§  Memory</a>
      <a href="../personal/" style="font-size:10px;text-decoration:none;color:#999;padding:3px 8px;border-radius:4px;background:#1a1a1a;transition:all .15s" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#999'">ğŸ’ª Personal</a>
  </div>
  <div style="font-size:9px;color:#666">Anton Empire</div>
</div>

<div class="app">

  <!-- â•â•â• TOPBAR â•â•â• -->
  <div class="topbar">
    <div class="brand">
      <div class="brand-icon">ğŸ”±</div>
      <div>
        <h1><em>Product Research</em> Tracker</h1>
        <div class="brand-sub">SOP-Compliant Pipeline Â· Scored & Ranked Â· Anton Empire</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button class="btn-o" onclick="exportCSV()">ğŸ“¥ CSV</button>
      <button class="btn-o" onclick="exportXLSX()">ğŸ“Š XLSX</button>
      <button class="btn-o" onclick="exportJSON()">ğŸ’¾ Backup</button>
      <button class="btn-o" onclick="importJSON()">ğŸ“‚ Import</button>
      <span class="badge" id="cBadge">0</span>
    </div>
  </div>

  <!-- â•â•â• TABS â•â•â• -->
  <div class="tabs">
    <div class="tab active" onclick="switchTab('research',this)">ğŸ“‹ Research</div>
    <div class="tab" onclick="switchTab('pipeline',this)">ğŸ”„ Pipeline</div>
    <div class="tab" onclick="switchTab('scoring',this)">ğŸ¯ Scoring</div>
    <div class="tab" onclick="switchTab('strategy',this)">ğŸ§  Strategy</div>
  </div>

  <!-- â•â•â• STATS â•â•â• -->
  <div class="stats">
    <div class="stat c1"><div class="stat-n" style="color:var(--accent2)" id="s-tot">0</div><div class="stat-l">Total</div></div>
    <div class="stat c2"><div class="stat-n" style="color:var(--green)" id="s-hi">0</div><div class="stat-l">Score 8+</div></div>
    <div class="stat c3"><div class="stat-n" style="color:var(--amber)" id="s-md">0</div><div class="stat-l">Score 5â€“7.9</div></div>
    <div class="stat c4"><div class="stat-n" style="color:var(--red)" id="s-lo">0</div><div class="stat-l">Below 5</div></div>
    <div class="stat c5"><div class="stat-n" style="color:var(--blue)" id="s-td">0</div><div class="stat-l">Today</div></div>
    <div class="stat c6"><div class="stat-n" style="color:var(--teal)" id="s-av">â€”</div><div class="stat-l">Avg Score</div></div>
    <div class="stat c7"><div class="stat-n" style="color:var(--pink)" id="s-mrr">0</div><div class="stat-l">MRR Products</div></div>
  </div>

  <!-- â•â•â• TAB: PRODUCT RESEARCH â•â•â• -->
  <div class="tab-panel active" id="tp-research">

    <!-- Add Product -->
    <div class="card">
      <div class="card-h coll-trigger" onclick="toggleColl(this)">
        <div class="card-t">â• Add Research Entry</div>
        <span class="chev">â–¼</span>
      </div>
      <div class="card-body coll-body show" id="addForm">
        <div class="fg">
          <div class="fi fi-2"><label>1. Product Name</label><input id="f-name" placeholder="e.g. Lymphatic Drainage Patches"></div>
          <div class="fi fi-2"><label>2. What It Does & Why</label><textarea id="f-what" placeholder="Problem solved, why it's worth testing. Be specific."></textarea></div>
          <div class="fi fi-2"><label>3. Additional Notes</label><textarea id="f-notes" placeholder="Angles, market observations, competitor intelligence, MRR potential..."></textarea></div>
          <div class="fi"><label>4. Mutual Link</label><input id="f-mutual" placeholder="https://mutual..."></div>
          <div class="fi"><label>5. Total COGS ($)</label><input type="number" id="f-cogs" step="0.01" placeholder="8.44"></div>
          <div class="fi"><label>6. Competitor Brand</label><input id="f-competitor" placeholder="e.g. Maia, QuietLab"></div>
          <div class="fi"><label>7. Competitor Site</label><input id="f-site" placeholder="https://competitor.com"></div>
          <div class="fi"><label>8. GetHookd Original Ad</label><input id="f-gethookd" placeholder="https://app.gethookd.ai/share/ad/..."></div>
          <div class="fi"><label>9. Competitor Ad Link</label><input id="f-adlink" placeholder="FB Ad Library / GetHookd"></div>
          <div class="fi"><label>10. SimilarWeb Traffic</label><input type="number" id="f-traffic" placeholder="105000"></div>
          <div class="fi"><label>11. Active FB Ads</label><input type="number" id="f-ads" placeholder="240"></div>
          <div class="fi"><label>12. Selling Price ($)</label><input type="number" id="f-price" step="0.01" placeholder="49.00"></div>
          <div class="fi"><label>12. Sufficient Content?</label>
            <select id="f-content"><option value="">â€”</option><option value="Yes">Yes</option><option value="No">No</option><option value="Partial">Partial</option></select>
          </div>
          <div class="fi"><label>Niche</label>
            <select id="f-niche"><option>Health/Wellness</option><option>Beauty</option><option>Supplements</option><option>Pets</option><option>Home/Garden</option><option>Fashion</option><option>Tech</option><option>Other</option></select>
          </div>
          <div class="fi"><label>Format</label>
            <select id="f-format"><option>Stick</option><option>Roll-on</option><option>Patch</option><option>Device</option><option>Drops</option><option>Serum</option><option>Cream</option><option>Spray</option><option>Pen</option><option>Powder</option><option>Mouthpiece</option><option>Other</option></select>
          </div>
          <div class="fi"><label>Target Audience</label><input id="f-target" placeholder="e.g. Women 25-45"></div>
          <div class="fi"><label>MRR Product?</label>
            <select id="f-mrr"><option value="No">No</option><option value="Yes">Yes â€” Monthly Recurring</option><option value="High">High â€” Repeat Buy Natural</option></select>
          </div>
          <div class="fi"><label>Status</label>
            <select id="f-status"><option value="new">ğŸ”µ New</option><option value="research">ğŸŸ£ Researching</option><option value="source">ğŸŸ¡ Sourcing</option><option value="test">ğŸŸ¢ Testing</option><option value="kill">ğŸ”´ Killed</option><option value="scale">ğŸ©µ Scaling</option></select>
          </div>
          <div class="fi"><label>Discovery Method</label>
            <select id="f-method"><option value="gethookd-trending">GetHookd Trending</option><option value="gethookd-niche">GetHookd Niche Filter</option><option value="fb-adlibrary">FB Ad Library Search</option><option value="competitor-analysis">Competitor Analysis</option><option value="coach-rec">Coach Recommendation</option><option value="market-scan">Market/Trend Scan</option><option value="manual">Manual Find</option><option value="other">Other</option></select>
          </div>
          <div class="fi"><label>Filters/Criteria Used</label><input id="f-filters" placeholder="e.g. Health niche, 7+ days, 4+ stars"></div>
        </div>
        <div class="scoring-bar">
          <div class="lbl">ğŸ¯ Scoring Matrix (1â€“10 each)</div>
          <div class="sg">
            <div class="fi"><label>Ad Signal</label><input type="number" id="sc-ad" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Market Size</label><input type="number" id="sc-mkt" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Competition</label><input type="number" id="sc-comp" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Format</label><input type="number" id="sc-fmt" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Margin</label><input type="number" id="sc-mgn" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Audience</label><input type="number" id="sc-aud" min="1" max="10" placeholder="â€”"></div>
            <div class="fi"><label>Dropship</label><input type="number" id="sc-drp" min="1" max="10" placeholder="â€”"></div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:16px">
          <button class="btn-p" id="addBtn" onclick="addProduct()">ï¼‹ Add Product</button>
          <button class="btn-g" onclick="clearForm()">Clear</button>
        </div>
      </div>
    </div>

    <!-- Pipeline Table -->
    <div class="card">
      <div class="card-h">
        <div class="card-t">ğŸ“‹ Research Pipeline</div>
        <div class="search-wrap"><input type="text" id="qSearch" placeholder="Search..." oninput="render()"></div>
      </div>
      <div class="card-body" style="padding:12px 16px">
        <div class="filters">
          <div class="pill on" onclick="setF('all',this)">All</div>
          <div class="pill" onclick="setF('high',this)">ğŸ¯ 8+</div>
          <div class="pill" onclick="setF('mrr',this)">ğŸ”„ MRR</div>
          <div class="pill" onclick="setF('new',this)">ğŸ”µ New</div>
          <div class="pill" onclick="setF('research',this)">ğŸŸ£ Research</div>
          <div class="pill" onclick="setF('source',this)">ğŸŸ¡ Source</div>
          <div class="pill" onclick="setF('test',this)">ğŸŸ¢ Test</div>
          <div class="pill" onclick="setF('kill',this)">ğŸ”´ Killed</div>
          <div class="pill" onclick="setF('scale',this)">ğŸ©µ Scale</div>
        </div>
        <div class="tw">
          <table>
            <thead><tr>
              <th onclick="srt('date')"># <span class="si">â†•</span></th>
              <th onclick="srt('name')">Product <span class="si">â†•</span></th>
              <th>Competitor</th>
              <th>COGS</th>
              <th onclick="srt('price')">Price <span class="si">â†•</span></th>
              <th onclick="srt('beroas')">B/E ROAS <span class="si">â†•</span></th>
              <th onclick="srt('traffic')">Traffic <span class="si">â†•</span></th>
              <th onclick="srt('revenueEstimate')">Est. Revenue <span class="si">â†•</span></th>
              <th onclick="srt('ads')">FB Ads <span class="si">â†•</span></th>
              <th onclick="srt('score')">Score <span class="si">â†•</span></th>
              <th>Status</th>
              <th>MRR</th>
              <th>Creatives</th>
              <th>Verdict</th>
              <th></th>
            </tr></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• TAB: PIPELINE â•â•â• -->
  <div class="tab-panel" id="tp-pipeline">
    <!-- Pipeline Header -->
    <div class="card" style="background:linear-gradient(135deg,rgba(124,92,252,0.05),rgba(15,214,140,0.03));border-top:2px solid var(--accent)">
      <div class="card-body" style="padding:16px 20px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <span style="font-size:20px">ğŸ”„</span>
          <div>
            <div style="font-size:15px;font-weight:800">Product Pipeline</div>
            <div style="font-size:10px;color:var(--sub)">Every product's journey from research to branded empire. Drag-free â€” status updates auto-flow from the Research tab.</div>
          </div>
        </div>
        <!-- Pipeline Flow Diagram -->
        <div style="display:flex;align-items:center;justify-content:center;gap:0;margin:16px 0 8px;flex-wrap:wrap">
          <div style="text-align:center;padding:10px 16px;background:var(--blue-bg);border:1px solid var(--blue-border);border-radius:10px;min-width:100px">
            <div style="font-size:18px">ğŸ“‹</div>
            <div style="font-size:10px;font-weight:800;color:var(--blue);margin-top:2px">RESEARCH</div>
            <div style="font-size:9px;color:var(--sub)">Score & validate</div>
            <div style="font-size:16px;font-weight:900;color:var(--blue);margin-top:4px" id="pipe-research">0</div>
          </div>
          <div style="color:var(--dim);font-size:16px;padding:0 6px">â†’</div>
          <div style="text-align:center;padding:10px 16px;background:var(--amber-bg);border:1px solid var(--amber-border);border-radius:10px;min-width:100px">
            <div style="font-size:18px">ğŸ“¦</div>
            <div style="font-size:10px;font-weight:800;color:var(--amber);margin-top:2px">SOURCING</div>
            <div style="font-size:9px;color:var(--sub)">Mutual COGS</div>
            <div style="font-size:16px;font-weight:900;color:var(--amber);margin-top:4px" id="pipe-source">0</div>
          </div>
          <div style="color:var(--dim);font-size:16px;padding:0 6px">â†’</div>
          <div style="text-align:center;padding:10px 16px;background:var(--green-bg);border:1px solid var(--green-border);border-radius:10px;min-width:100px">
            <div style="font-size:18px">ğŸ§ª</div>
            <div style="font-size:10px;font-weight:800;color:var(--green);margin-top:2px">TESTING</div>
            <div style="font-size:9px;color:var(--sub)">$100/day ads</div>
            <div style="font-size:16px;font-weight:900;color:var(--green);margin-top:4px" id="pipe-test">0</div>
          </div>
          <div style="color:var(--dim);font-size:16px;padding:0 6px">â†’</div>
          <div style="text-align:center;padding:10px 16px;background:var(--teal-bg);border:1px solid rgba(0,212,170,.15);border-radius:10px;min-width:100px">
            <div style="font-size:18px">ğŸš€</div>
            <div style="font-size:10px;font-weight:800;color:var(--teal);margin-top:2px">SCALING</div>
            <div style="font-size:9px;color:var(--sub)">$500+/day</div>
            <div style="font-size:16px;font-weight:900;color:var(--teal);margin-top:4px" id="pipe-scale">0</div>
          </div>
          <div style="color:var(--dim);font-size:16px;padding:0 6px">â†’</div>
          <div style="text-align:center;padding:10px 16px;background:var(--pink-bg);border:1px solid rgba(255,107,170,.15);border-radius:10px;min-width:100px">
            <div style="font-size:18px">ğŸ‘‘</div>
            <div style="font-size:10px;font-weight:800;color:var(--pink);margin-top:2px">BRANDED</div>
            <div style="font-size:9px;color:var(--sub)">Own domain</div>
            <div style="font-size:16px;font-weight:900;color:var(--pink);margin-top:4px" id="pipe-brand">0</div>
          </div>
        </div>
        <div style="display:flex;justify-content:center;gap:12px;margin-top:8px">
          <span style="font-size:9px;color:var(--red)">âŒ Killed: <strong id="pipe-kill">0</strong></span>
          <span style="font-size:9px;color:var(--sub)">|</span>
          <span style="font-size:9px;color:var(--sub)">Total: <strong id="pipe-total">0</strong></span>
          <span style="font-size:9px;color:var(--sub)">|</span>
          <span style="font-size:9px;color:var(--green)">Conversion: <strong id="pipe-conv">0%</strong></span>
        </div>
      </div>
    </div>

    <!-- Pipeline Columns -->
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px" id="pipeline-grid">
      <!-- Research Column -->
      <div class="card" style="border-top:2px solid var(--blue)">
        <div class="card-h" style="padding:10px 14px"><div class="card-t" style="font-size:11px">ğŸ“‹ Research</div></div>
        <div class="card-body" style="padding:8px 10px;min-height:200px" id="col-research"></div>
      </div>
      <!-- Sourcing Column -->
      <div class="card" style="border-top:2px solid var(--amber)">
        <div class="card-h" style="padding:10px 14px"><div class="card-t" style="font-size:11px">ğŸ“¦ Sourcing</div></div>
        <div class="card-body" style="padding:8px 10px;min-height:200px" id="col-source"></div>
      </div>
      <!-- Testing Column -->
      <div class="card" style="border-top:2px solid var(--green)">
        <div class="card-h" style="padding:10px 14px"><div class="card-t" style="font-size:11px">ğŸ§ª Testing</div></div>
        <div class="card-body" style="padding:8px 10px;min-height:200px" id="col-test"></div>
      </div>
      <!-- Scaling Column -->
      <div class="card" style="border-top:2px solid var(--teal)">
        <div class="card-h" style="padding:10px 14px"><div class="card-t" style="font-size:11px">ğŸš€ Scaling</div></div>
        <div class="card-body" style="padding:8px 10px;min-height:200px" id="col-scale"></div>
      </div>
      <!-- Branded Column -->
      <div class="card" style="border-top:2px solid var(--pink)">
        <div class="card-h" style="padding:10px 14px"><div class="card-t" style="font-size:11px">ğŸ‘‘ Branded</div></div>
        <div class="card-body" style="padding:8px 10px;min-height:200px" id="col-brand"></div>
      </div>
    </div>

    <!-- Killed Products -->
    <div class="card" style="margin-top:12px;border-top:2px solid var(--red);opacity:0.7">
      <div class="card-h coll-trigger" onclick="toggleColl(this)" style="padding:10px 14px">
        <div class="card-t" style="font-size:11px">âŒ Killed Products</div>
        <span class="chev">â–¼</span>
      </div>
      <div class="card-body coll-body shut" style="padding:8px 10px" id="col-kill"></div>
    </div>
  </div>

  <!-- â•â•â• TAB: SCORING MATRIX â•â•â• -->
  <div class="tab-panel" id="tp-scoring">
    <div class="card">
      <div class="card-h"><div class="card-t">ğŸ¯ Scoring Matrix â€” All Products Ranked</div></div>
      <div class="card-body" style="padding:12px 16px">
        <div class="tw"><table>
          <thead><tr>
            <th>#</th><th>Product</th><th>Ad Signal</th><th>Market</th><th>Competition</th><th>Format</th><th>Margin</th><th>Audience</th><th>Dropship</th><th onclick="srt('score')">Average <span class="si">â†•</span></th><th>Rank</th><th>Decision</th>
          </tr></thead>
          <tbody id="scoringBody"></tbody>
        </table></div>
      </div>
    </div>
  </div>

  <!-- â•â•â• TAB: STRATEGY â•â•â• -->
  <div class="tab-panel" id="tp-strategy">
    <div class="card">
      <div class="card-h"><div class="card-t">ğŸ§  Strategy Deep Dive â€” Top Products</div></div>
      <div class="card-body" style="padding:12px 16px">
        <div class="tw"><table>
          <thead><tr>
            <th>#</th><th>Product</th><th>Target</th><th>Pain Point</th><th>Ad Angle</th><th>Pricing</th><th>MRR/Repeat</th><th>Competitors</th><th>Risk</th><th>Verdict</th>
          </tr></thead>
          <tbody id="stratBody"></tbody>
        </table></div>
      </div>
    </div>
  </div>

  <div class="footer">ğŸ”± Product Research Tracker v4.2 â€” SOP-Compliant Â· GetHookd Integrated Â· Auto-Synced from Forge</div>
</div>

<input type="file" id="impF" accept=".json" style="display:none" onchange="handleImp(event)">
<div class="toast" id="toast"></div>

<script>
let P=JSON.parse(localStorage.getItem('pr_products')||'[]');
let filt='all',sCol='score',sAsc=false;

function switchTab(id,el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('tp-'+id).classList.add('active');
  render();
}

function toggleColl(trigger){
  const body=trigger.nextElementSibling;
  const isOpen=body.classList.contains('show');
  body.classList.toggle('show',!isOpen);body.classList.toggle('shut',isOpen);
  trigger.classList.toggle('open',!isOpen);
}

let editingId=null;
function editProduct(id){
  const p=P.find(x=>x.id===id);if(!p)return;
  editingId=id;
  document.getElementById('f-name').value=p.name||'';
  document.getElementById('f-what').value=p.what||'';
  document.getElementById('f-notes').value=p.notes||'';
  document.getElementById('f-competitor').value=p.competitor||'';
  document.getElementById('f-site').value=p.competitorSite||p.site||'';
  document.getElementById('f-gethookd').value=p.gethookdOriginalAd||'';
  document.getElementById('f-adlink').value=p.adLink||'';
  document.getElementById('f-mutual').value=p.mutualLink||'';
  document.getElementById('f-cogs').value=p.cogs||'';
  document.getElementById('f-traffic').value=p.traffic||'';
  document.getElementById('f-ads').value=p.ads||'';
  document.getElementById('f-price').value=p.price||'';
  document.getElementById('f-content').value=p.content||'';
  document.getElementById('f-niche').value=p.niche||'Health/Wellness';
  document.getElementById('f-format').value=p.format||'Stick';
  document.getElementById('f-target').value=p.target||'';
  document.getElementById('f-mrr').value=p.mrr||'No';
  document.getElementById('f-status').value=p.status||'new';
  document.getElementById('f-method').value=p.discoveryMethod||'gethookd-trending';
  document.getElementById('f-filters').value=p.filtersUsed||'';
  if(p.scores){
    document.getElementById('sc-ad').value=p.scores.ad||'';
    document.getElementById('sc-mkt').value=p.scores.market||'';
    document.getElementById('sc-comp').value=p.scores.comp||'';
    document.getElementById('sc-fmt').value=p.scores.format||'';
    document.getElementById('sc-mgn').value=p.scores.margin||'';
    document.getElementById('sc-aud').value=p.scores.audience||'';
    document.getElementById('sc-drp').value=p.scores.dropship||'';
  }
  // Open the form if collapsed
  const trigger=document.querySelector('.coll-trigger');
  const body=trigger.nextElementSibling;
  if(body.classList.contains('shut')){body.classList.remove('shut');body.classList.add('show');trigger.classList.add('open');}
  // Scroll to top
  window.scrollTo({top:0,behavior:'smooth'});
  // Change button text
  document.getElementById('addBtn').textContent='ğŸ’¾ Update Product';
  toast('Editing: '+p.name);
}

function addProduct(){
  const n=v('f-name');if(!n){toast('Enter product name',1);return}
  const sc={ad:num('sc-ad'),market:num('sc-mkt'),comp:num('sc-comp'),format:num('sc-fmt'),margin:num('sc-mgn'),audience:num('sc-aud'),dropship:num('sc-drp')};
  const vals=Object.values(sc).filter(x=>x>0);
  const avg=vals.length?vals.reduce((a,b)=>a+b,0)/vals.length:0;
  const cogs=parseFloat(v('f-cogs'))||0;const price=parseFloat(v('f-price'))||0;
  const marginPct=price>0?((price-cogs)/price*100):0;
  const beroas=price>0&&(price-cogs)>0?(price/(price-cogs)):0;
  const traffic=parseInt(v('f-traffic'))||0;
  const revEst=traffic&&price?(traffic*price*0.025):0;

  // If editing, update existing product
  if(editingId){
    const idx=P.findIndex(x=>x.id===editingId);
    if(idx>=0){
      const oldStatus=P[idx].status;
      const newStatus=v('f-status');
      if(oldStatus!==newStatus)logStatusChange(P[idx],oldStatus,newStatus);
      P[idx]={...P[idx],
        name:n,what:v('f-what'),notes:v('f-notes'),
        competitor:v('f-competitor'),competitorSite:v('f-site'),
        gethookdOriginalAd:v('f-gethookd'),
        mutualLink:v('f-mutual'),cogs,adLink:v('f-adlink'),site:v('f-site'),
        traffic,ads:parseInt(v('f-ads'))||0,
        price,revenueEstimate:Math.round(revEst),margin:marginPct,beroas,
        content:v('f-content'),niche:v('f-niche'),format:v('f-format'),
        target:v('f-target'),mrr:v('f-mrr'),status:v('f-status'),
        discoveryMethod:v('f-method'),filtersUsed:v('f-filters'),
        scores:sc,score:Math.round(avg*10)/10
      };
    }
    editingId=null;
    document.getElementById('addBtn').textContent='ï¼‹ Add Product';
    save();render();clearForm();toast('Product updated âœ“');
    return;
  }

  P.push({
    id:Date.now().toString(36)+Math.random().toString(36).slice(2,5),
    date:new Date().toISOString().split('T')[0],
    name:n,what:v('f-what'),notes:v('f-notes'),
    competitor:v('f-competitor'),competitorSite:v('f-site'),
    discoveryMethod:v('f-method'),filtersUsed:v('f-filters'),
    gethookdOriginalAd:v('f-gethookd'),creativeSwipes:[],
    mutualLink:v('f-mutual'),cogs,adLink:v('f-adlink'),site:v('f-site'),
    traffic,ads:parseInt(v('f-ads'))||0,
    price,revenueEstimate:Math.round(revEst),margin:marginPct,beroas,
    content:v('f-content'),niche:v('f-niche'),format:v('f-format'),
    target:v('f-target'),mrr:v('f-mrr'),status:v('f-status'),
    scores:sc,score:Math.round(avg*10)/10,
    approval:'',coachNotes:''
  });
  save();render();clearForm();toast('Product added âœ“');
}

function v(id){return document.getElementById(id).value.trim()}
function num(id){return parseInt(document.getElementById(id).value)||0}
function clearForm(){
  editingId=null;
  document.getElementById('addBtn').textContent='ï¼‹ Add Product';
  ['f-name','f-what','f-notes','f-mutual','f-cogs','f-adlink','f-site','f-traffic','f-ads','f-price','f-target','f-competitor','f-gethookd','f-filters',
   'sc-ad','sc-mkt','sc-comp','sc-fmt','sc-mgn','sc-aud','sc-drp'].forEach(id=>{document.getElementById(id).value=''});
  document.getElementById('f-content').value='';
  document.getElementById('f-mrr').value='No';
}
function del(id){if(!confirm('Remove?'))return;P=P.filter(p=>p.id!==id);save();render();toast('Removed')}
function setF(f,el){filt=f;document.querySelectorAll('.pill').forEach(b=>b.classList.remove('on'));el.classList.add('on');render()}
function srt(col){if(sCol===col)sAsc=!sAsc;else{sCol=col;sAsc=false}render()}
function save(){localStorage.setItem('pr_products',JSON.stringify(P))}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function fN(n){return n>=1e6?(n/1e6).toFixed(1)+'M':n>=1e3?(n/1e3).toFixed(1)+'K':n.toString()}

function render(){
  let items=[...P];
  const q=(document.getElementById('qSearch')?.value||'').toLowerCase();
  if(q)items=items.filter(p=>p.name.toLowerCase().includes(q)||(p.notes||'').toLowerCase().includes(q)||(p.what||'').toLowerCase().includes(q));
  if(filt==='high')items=items.filter(p=>p.score>=8);
  else if(filt==='mrr')items=items.filter(p=>p.mrr&&p.mrr!=='No');
  else if(filt!=='all')items=items.filter(p=>p.status===filt);
  items.sort((a,b)=>{let va=a[sCol]??'',vb=b[sCol]??'';if(typeof va==='string'){va=va.toLowerCase();vb=(vb||'').toLowerCase()}return sAsc?(va>vb?1:va<vb?-1:0):(va<vb?1:va>vb?-1:0)});

  // Main table
  const tb=document.getElementById('tbody');
  if(!items.length){
    tb.innerHTML=`<tr><td colspan="15"><div class="empty"><div class="empty-icon">ğŸ“¦</div><div class="empty-t">${q||filt!=='all'?'No matches':'No products yet'}</div><div class="empty-s">Use the form above to add products</div></div></td></tr>`;
  } else {
    tb.innerHTML=items.map((p,i)=>{
      const sc=p.score>=8?'s-hi':p.score>=5?'s-md':'s-lo';
      const stM={new:'ch-new',research:'ch-res',source:'ch-src',test:'ch-tst',kill:'ch-kil',scale:'ch-scl'};
      const stL={new:'New',research:'Research',source:'Sourcing',test:'Testing',kill:'Killed',scale:'Scaling'};
      const hasCogs=p.cogs&&p.cogs>0;
      const br=hasCogs&&p.beroas>0?p.beroas.toFixed(2):'â€”';
      const brc=hasCogs&&p.beroas>0&&p.beroas<=1.5?'m-hi':p.beroas<=2?'m-md':'m-lo';
      const cogsDisplay=hasCogs?'$'+p.cogs.toFixed(2):'â€”';
      const tc=p.traffic>=30000?'m-hi':p.traffic>=10000?'m-md':'m-lo';
      const revEst=p.traffic&&p.price?(p.traffic*p.price*0.025):0;
      const revDisplay=revEst>0?'$'+fN(revEst):'â€”';
      const revClass=revEst>=100000?'m-hi':revEst>=30000?'m-md':'m-lo';
      const links=[
        p.site||p.competitorSite?`<a href="${esc(p.competitorSite||p.site)}" target="_blank" class="plink">â†— Site</a>`:'',
        p.adLink?`<a href="${esc(p.adLink)}" target="_blank" class="plink">ğŸ“£ Ads</a>`:'',
        p.mutualLink&&!p.mutualLink.startsWith('PENDING')?`<a href="${esc(p.mutualLink)}" target="_blank" class="plink">ğŸ“¦ Mutual</a>`:''
      ].filter(Boolean).join(' ');
      const mrrTag=p.mrr&&p.mrr!=='No'?`<span class="tag tag-mrr">ğŸ”„ MRR</span>`:'';
      const compName=p.competitor||'â€”';
      const compLink=p.competitorSite?`<a href="${esc(p.competitorSite)}" target="_blank" class="plink">â†— ${esc(compName)}</a>`:esc(compName);
      const ghLink=p.gethookdOriginalAd&&!p.gethookdOriginalAd.startsWith('PENDING')?`<a href="${esc(p.gethookdOriginalAd)}" target="_blank" class="plink">ğŸ¬ Original</a>`:'';
      const swipes=p.creativeSwipes||[];
      const swipeCount=swipes.length;
      const swipeHtml=swipeCount>0?`<span class="tag tag-mrr" style="cursor:pointer" onclick="toggleSwipes('${p.id}')">${swipeCount} swipe${swipeCount>1?'s':''}</span>`:`<button class="btn-g" style="font-size:9px" onclick="addSwipe('${p.id}')">+ Add</button>`;
      const verdict=p.verdict||autoVerdict(p);
      const verdictShort=verdict.length>30?verdict.slice(0,30)+'â€¦':verdict;
      return`<tr onmouseenter="showTT(event,'${p.id}')" onmouseleave="hideTT()">
        <td style="color:var(--sub);font-size:10px;white-space:nowrap">${i+1}<br><span style="font-size:9px">${p.date}</span></td>
        <td><div class="pname">${esc(p.name)}</div><div style="margin-top:3px;display:flex;gap:6px;flex-wrap:wrap"><span class="tag tag-n">${esc(p.niche)}</span><span class="tag tag-f">${esc(p.format)}</span></div><div style="margin-top:3px">${links}</div></td>
        <td><div style="font-weight:600;font-size:11px">${compLink}</div>${ghLink}</td>
        <td class="money">${cogsDisplay}${!hasCogs&&p.price?'<br><span style="font-size:8px;color:var(--amber)">Pending COGS</span>':''}</td>
        <td class="money" style="font-weight:700">${p.price?'$'+p.price.toFixed(2):'â€”'}</td>
        <td class="${brc}" style="font-weight:700">${br}${!hasCogs&&p.price?'<br><span style="font-size:8px;color:var(--amber)">Pending</span>':''}</td>
        <td class="${tc}" style="font-weight:600">${p.traffic?fN(p.traffic):'â€”'}</td>
        <td class="${revClass}" style="font-weight:700">${revDisplay}</td>
        <td style="font-weight:700">${p.ads||'â€”'}${p.gethookdVerified?'<br><span style="font-size:8px;color:var(--green)">âœ… GetHookd</span>':''}</td>
        <td><span class="score-b ${sc}">${p.score.toFixed(1)}</span></td>
        <td><span class="chip ${stM[p.status]||'ch-new'}">${stL[p.status]||p.status}</span></td>
        <td>${mrrTag||'â€”'}</td>
        <td>${swipeHtml}</td>
        <td class="verdict-cell" onclick="editVerdict('${p.id}')"><div class="verdict-short" title="${esc(verdict)}">${verdict?'ğŸ”± '+esc(verdictShort):'<span style="color:var(--dim)">+ verdict</span>'}</div></td>
        <td style="white-space:nowrap"><button class="btn-o" style="font-size:9px;padding:4px 8px;margin-right:3px" onclick="editProduct('${p.id}')">âœï¸</button><button class="btn-d" onclick="del('${p.id}')">âœ•</button></td>
      </tr>`}).join('');
  }

  // Scoring tab
  const sb=document.getElementById('scoringBody');
  const ranked=[...P].sort((a,b)=>b.score-a.score);
  sb.innerHTML=ranked.map((p,i)=>{
    const sc=p.score>=8?'s-hi':p.score>=5?'s-md':'s-lo';
    const s=p.scores||{};
    const dec=p.status==='kill'?'âŒ Killed':p.status==='test'?'ğŸŸ¢ Testing':p.status==='scale'?'ğŸš€ Scaling':p.score>=8?'â­ Strong candidate':p.score>=6?'ğŸ” Worth investigating':'âš ï¸ Weak';
    return`<tr>
      <td>${i+1}</td><td class="pname">${esc(p.name)}</td>
      <td>${s.ad||'â€”'}</td><td>${s.market||'â€”'}</td><td>${s.comp||'â€”'}</td><td>${s.format||'â€”'}</td>
      <td>${s.margin||'â€”'}</td><td>${s.audience||'â€”'}</td><td>${s.dropship||'â€”'}</td>
      <td><span class="score-b ${sc}">${p.score.toFixed(1)}</span></td>
      <td style="font-weight:800;color:var(--accent2)">#${i+1}</td>
      <td style="font-size:10px">${dec}</td>
    </tr>`}).join('');

  // Strategy tab
  const stb=document.getElementById('stratBody');
  stb.innerHTML=ranked.filter(p=>p.score>=5).map((p,i)=>{
    const mrr=p.mrr&&p.mrr!=='No'?'âœ… '+p.mrr:'âŒ One-time';
    return`<tr>
      <td>${i+1}</td><td class="pname">${esc(p.name)}</td>
      <td style="font-size:10px">${esc(p.target||'â€”')}</td>
      <td class="notes">${esc(p.what||'â€”')}</td>
      <td class="notes">${esc(p.notes||'â€”')}</td>
      <td class="money">${p.price?'$'+p.price.toFixed(2):'â€”'}</td>
      <td>${mrr}</td>
      <td><a href="${esc(p.site||'#')}" target="_blank" class="plink">â†— View</a></td>
      <td style="font-size:10px">${p.niche==='Health/Wellness'||p.niche==='Supplements'?'âš ï¸ Compliance':'âœ… Low'}</td>
      <td>${p.approval||'â³ Pending'}</td>
    </tr>`}).join('');

  // Stats
  const today=new Date().toISOString().split('T')[0];const tot=P.length;
  document.getElementById('s-tot').textContent=tot;
  document.getElementById('s-hi').textContent=P.filter(p=>p.score>=8).length;
  document.getElementById('s-md').textContent=P.filter(p=>p.score>=5&&p.score<8).length;
  document.getElementById('s-lo').textContent=P.filter(p=>p.score<5).length;
  document.getElementById('s-td').textContent=P.filter(p=>p.date===today).length;
  document.getElementById('s-av').textContent=tot?(P.reduce((s,p)=>s+p.score,0)/tot).toFixed(1):'â€”';
  document.getElementById('s-mrr').textContent=P.filter(p=>p.mrr&&p.mrr!=='No').length;
  document.getElementById('cBadge').textContent=tot+' product'+(tot===1?'':'s');
}

// Export
function exportCSV(){
  if(!P.length){toast('No data',1);return}
  const h=['#','Product Name','What It Does & Why','Additional Notes','Mutual Link','Total COGS','Competitor Ad Link','Competitor Site','SimilarWeb Traffic','Active FB Ads','Selling Price','B/E ROAS','Sufficient Content','Coach Approval','Coach Comments','Niche','Format','Target','MRR','Status','Ad Signal','Market','Competition','Format Score','Margin','Audience','Dropship','Overall Score'];
  let c=h.join(',')+'\n';
  P.forEach((p,i)=>{c+=`${i+1},"${p.name}","${(p.what||'').replace(/"/g,'""')}","${(p.notes||'').replace(/"/g,'""')}","${p.mutualLink||''}",${p.cogs||''},"${p.adLink||''}","${p.site||''}",${p.traffic||''},${p.ads||''},${p.price||''},${(p.beroas||0).toFixed(2)},"${p.content||''}","${p.approval||''}","${p.coachNotes||''}","${p.niche}","${p.format}","${p.target||''}","${p.mrr||''}","${p.status}",${p.scores?.ad||''},${p.scores?.market||''},${p.scores?.comp||''},${p.scores?.format||''},${p.scores?.margin||''},${p.scores?.audience||''},${p.scores?.dropship||''},${p.score}\n`});
  dl('Product Research Export.csv',c,'text/csv');toast('CSV exported âœ“');
}
function exportXLSX(){toast('Use Forge to generate .xlsx â€” run: "update tracker xlsx"',0)}
function exportJSON(){dl('product-research-backup.json',JSON.stringify(P,null,2),'application/json');toast('Backup saved âœ“')}
function importJSON(){document.getElementById('impF').click()}
function handleImp(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(ev){try{const d=JSON.parse(ev.target.result);if(Array.isArray(d)){P=d;save();render();toast('Imported '+d.length+' products âœ“')}}catch(e){toast('Bad file',1)}};r.readAsText(f);e.target.value=''}
function dl(n,c,t){const b=new Blob([c],{type:t});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=n;a.click()}
function toast(m,e){const t=document.getElementById('toast');t.textContent=m;t.className='toast '+(e?'err':'ok')+' show';setTimeout(()=>t.classList.remove('show'),2800)}

function addSwipe(id){
  const url=prompt('GetHookd Ad Swipe URL:');if(!url)return;
  const label=prompt('Label (optional):','');
  const p=P.find(x=>x.id===id);if(!p)return;
  if(!p.creativeSwipes)p.creativeSwipes=[];
  p.creativeSwipes.push({url,label:label||'Ad Swipe'});
  save();render();toast('Swipe added âœ“');
}
function toggleSwipes(id){
  const p=P.find(x=>x.id===id);if(!p||!p.creativeSwipes?.length)return;
  const list=p.creativeSwipes.map((s,i)=>`${i+1}. ${s.label}: ${s.url}`).join('\n');
  const action=prompt('Creative Swipes for '+p.name+':\n\n'+list+'\n\nType "add" to add new, or "clear" to remove all:');
  if(action==='add')addSwipe(id);
  else if(action==='clear'){p.creativeSwipes=[];save();render();toast('Swipes cleared');}
}

function mapForgeProduct(np){
  return{
    id:np.id,date:np.date||'',
    name:np.productName||np.name||'',
    what:np.whatItDoes||np.what||'',
    notes:np.notes||'',
    competitor:np.competitor||np.gethookdBrands?.[0]?.name||'',
    competitorSite:np.competitorSiteLink||np.competitorSite||np.site||'',
    site:np.competitorSiteLink||np.site||'',
    adLink:np.competitorAdLink||np.adLink||'',
    mutualLink:np.mutualDropshipping||np.mutualLink||'',
    cogs:parseFloat(np.cogsTotal||'')||parseFloat(np.cogs||'')||0,
    traffic:np.similarwebTraffic||np.traffic||0,
    ads:parseInt(String(np.activeFBads||'').match(/\d+/)?.[0])||np.ads||0,
    price:np.sellingPrice||np.price||0,
    beroas:np.beRoas||np.beroas||0,
    content:np.sufficientContent?np.sufficientContent.split('â€”')[0].trim():np.content||'',
    niche:'Health/Wellness',
    format:np.format||(function(n){n=(n||'').toLowerCase();if(n.includes('stick'))return'Stick';if(n.includes('patch'))return'Patch';if(n.includes('drop'))return'Drops';if(n.includes('mask'))return'Device';if(n.includes('gumm'))return'Other';if(n.includes('tea'))return'Other';return'Device'})(np.productName||np.name),
    target:np.targetDemographic||np.target||'',
    mrr:np.mrr||'No',
    status:np.status||(np.coachApproval==='Approved'?'test':'research'),
    score:np.score||0,
    verdict:np.verdict||'',
    approval:np.coachApproval||np.approval||'',
    coachNotes:np.coachComments||np.coachNotes||'',
    scores:np.scores||{ad:0,market:0,comp:0,format:0,margin:0,audience:0,dropship:0},
    gethookdVerified:np.gethookdVerified||false,
    gethookdDate:np.gethookdDate||'',
    gethookdBrands:np.gethookdBrands||[],
    upsellPotential:np.upsellPotential||'',
    complianceRisk:np.complianceRisk||'',
    discoveryMethod:np.discoveryMethod||np.session||'gethookd-trending',
    filtersUsed:np.filtersUsed||'',
    creativeSwipes:np.creativeSwipes||[],
    margin:(function(){const p=np.sellingPrice||np.price||0;const c=parseFloat(np.cogsTotal||'')||parseFloat(np.cogs||'')||0;return p&&c?((p-c)/p*100):0})(),
    revenueEstimate:(function(){const t=np.similarwebTraffic||np.traffic||0;const p=np.sellingPrice||np.price||0;return t&&p?Math.round(t*p*0.025):0})()
  };
}
async function loadJSON(){try{const r=await fetch('research-data.json?t='+Date.now());if(!r.ok)return;const d=await r.json();if(Array.isArray(d)&&d.length>0){let a=0,u=0;d.forEach(np=>{const mapped=mapForgeProduct(np);const idx=P.findIndex(p=>p.id===np.id);if(idx===-1){P.push(mapped);a++}else{
  // Always update with latest mapped data from Forge, preserve local-only fields
  const local=P[idx];
  const preserve={creativeSwipes:local.creativeSwipes||[],timeline:local.timeline||[]};
  Object.assign(P[idx],mapped,preserve);u++
}});if(a||u){save();render();toast((a?'Synced '+a+' new':'')+(a&&u?' + ':'')+(u?'Updated '+u:'')+ ' from Forge âœ“')}}}catch(e){}}

// â•â•â• AUTO-VERDICT â•â•â•
function autoVerdict(p){
  if(!p.score)return'';
  const parts=[];
  if(p.score>=8)parts.push('Strong candidate.');
  else if(p.score>=6)parts.push('Worth testing.');
  else if(p.score>=4)parts.push('Borderline â€” needs stronger signal.');
  else parts.push('Weak â€” skip unless angle found.');
  if(p.traffic>=50000)parts.push('High traffic validates demand.');
  else if(p.traffic>=15000)parts.push('Decent traffic.');
  else if(p.traffic>0)parts.push('Low traffic â€” early market or weak demand.');
  if(p.beroas>0&&p.beroas<=1.5)parts.push('Tight margins â€” need high CVR.');
  else if(p.beroas>0&&p.beroas<=2)parts.push('Healthy margins.');
  else if(p.beroas>2)parts.push('Wide margins â€” good room for ad spend.');
  if(p.mrr&&p.mrr!=='No')parts.push('MRR potential = compounding revenue.');
  if(p.content==='No')parts.push('âš ï¸ Content gap â€” sourcing needed.');
  return parts.join(' ');
}

// â•â•â• EDIT VERDICT â•â•â•
function editVerdict(id){
  const p=P.find(x=>x.id===id);if(!p)return;
  const current=p.verdict||autoVerdict(p);
  const v=prompt('ğŸ”± Forge Verdict for '+p.name+':\n\n(Current: '+current+')\n\nEdit or leave blank for auto:',p.verdict||'');
  if(v===null)return;
  p.verdict=v;save();render();toast('Verdict updated âœ“');
}

// â•â•â• STATUS TIMELINE â•â•â•
function logStatusChange(p,oldStatus,newStatus){
  if(!p.timeline)p.timeline=[];
  p.timeline.push({from:oldStatus,to:newStatus,date:new Date().toISOString().split('T')[0],ts:Date.now()});
}

// â•â•â• HOVER TOOLTIP â•â•â•
let ttEl=null;
function showTT(ev,id){
  const p=P.find(x=>x.id===id);if(!p)return;
  if(!ttEl){ttEl=document.createElement('div');ttEl.className='tt-card';document.body.appendChild(ttEl)}
  const s=p.scores||{};
  const scoreLabels={ad:'Ad Signal â€” How strong is the paid ad presence?',market:'Market Size â€” Is the TAM big enough?',comp:'Competition â€” How crowded is the space?',format:'Format â€” Is it a convenience format (stick/patch/roll-on)?',margin:'Margin â€” Room for profit after COGS + ads?',audience:'Audience â€” Does it hit women 25-45?',dropship:'Dropship â€” Easy to source & ship via Mutual?'};
  const scoreRows=Object.entries(scoreLabels).map(([k,label])=>{
    const key=k==='comp'?'comp':k==='format'?'format':k;
    const val=s[key]||0;
    const color=val>=8?'var(--green)':val>=5?'var(--amber)':'var(--red)';
    return`<div class="tt-row"><span class="tt-key" title="${label}">${label.split('â€”')[0].trim()}</span><span class="tt-val" style="color:${color}">${val||'â€”'}/10</span></div>`;
  }).join('');

  const stColors={new:'var(--blue)',research:'var(--accent2)',source:'var(--amber)',test:'var(--green)',kill:'var(--red)',scale:'var(--teal)'};
  const stNames={new:'New',research:'Researching',source:'Sourcing',test:'Testing',kill:'Killed',scale:'Scaling'};
  const tl=p.timeline||[];
  const tlHtml=tl.length?tl.map(t=>`<div class="tt-tl-item"><span class="tt-tl-dot" style="background:${stColors[t.to]||'var(--sub)'}"></span><span class="tt-tl-date">${t.date}</span><span>${stNames[t.from]||t.from} â†’ <strong>${stNames[t.to]||t.to}</strong></span></div>`).join(''):`<div class="tt-tl-item" style="color:var(--dim)"><span class="tt-tl-dot" style="background:${stColors[p.status]}"></span><span class="tt-tl-date">${p.date}</span><span>Added as <strong>${stNames[p.status]||p.status}</strong></span></div>`;

  const verdict=p.verdict||autoVerdict(p);
  const revEst=p.traffic&&p.price?(p.traffic*p.price*0.025):0;

  ttEl.innerHTML=`
    <h4><span style="font-size:16px">ğŸ“¦</span> ${esc(p.name)}</h4>
    <div class="tt-section">
      <div class="tt-label">ğŸ“Š What the numbers mean</div>
      <div class="tt-row"><span class="tt-key">Traffic</span><span class="tt-val">${p.traffic?fN(p.traffic):'â€”'} <span style="font-size:8px;color:var(--sub)">monthly visitors (SimilarWeb)</span></span></div>
      <div class="tt-row"><span class="tt-key">FB Ads</span><span class="tt-val">${p.ads||'â€”'} <span style="font-size:8px;color:var(--sub)">active ads = demand signal</span></span></div>
      <div class="tt-row"><span class="tt-key">B/E ROAS</span><span class="tt-val">${p.beroas?p.beroas.toFixed(2):'â€”'} <span style="font-size:8px;color:var(--sub)">break-even return on ad spend</span></span></div>
      <div class="tt-row"><span class="tt-key">Est. Revenue</span><span class="tt-val">${revEst?'$'+fN(revEst):'â€”'} <span style="font-size:8px;color:var(--sub)">traffic Ã— price Ã— 2.5% CVR</span></span></div>
      <div class="tt-row"><span class="tt-key">COGS</span><span class="tt-val">${p.cogs?'$'+p.cogs.toFixed(2):'Pending'} <span style="font-size:8px;color:var(--sub)">cost from Mutual</span></span></div>
    </div>
    <div class="tt-section">
      <div class="tt-label">ğŸ¯ Scoring breakdown</div>
      ${scoreRows}
      <div class="tt-row" style="margin-top:4px;padding-top:4px;border-top:1px solid var(--border)"><span class="tt-key" style="font-weight:700">Overall</span><span class="tt-val" style="font-size:14px;color:${p.score>=8?'var(--green)':p.score>=5?'var(--amber)':'var(--red)'}">${p.score.toFixed(1)}/10</span></div>
    </div>
    <div class="tt-section">
      <div class="tt-label">ğŸ“… Timeline</div>
      <div class="tt-timeline">${tlHtml}</div>
      <div style="margin-top:4px;font-size:9px;color:var(--dim)">Kill = no traction after test Â· Scale = profitable at $100+/day</div>
    </div>
    <div class="tt-verdict">
      <div class="tt-label">ğŸ”± Forge's Verdict</div>
      <p>${verdict?esc(verdict):'<em style="color:var(--dim)">No verdict yet â€” add one by clicking the verdict column</em>'}</p>
    </div>
  `;
  // Position
  const rect=ev.currentTarget.getBoundingClientRect();
  const top=rect.top+window.scrollY;
  const left=Math.min(rect.right+12,window.innerWidth-440);
  ttEl.style.top=top+'px';
  ttEl.style.left=left+'px';
  ttEl.classList.add('vis');
}
function hideTT(){if(ttEl)ttEl.classList.remove('vis')}

// â•â•â• PATCH: track status changes on save â•â•â•
const _origAddProduct=addProduct;

function renderPipeline(){
  const stages={new:'research',research:'research',source:'source',test:'test',scale:'scale',brand:'brand',kill:'kill'};
  const cols={research:[],source:[],test:[],scale:[],brand:[],kill:[]};
  P.forEach(p=>{const s=stages[p.status]||'research';cols[s].push(p)});

  // Sort each column by score descending
  Object.values(cols).forEach(arr=>arr.sort((a,b)=>b.score-a.score));

  const stColors={research:'var(--blue)',source:'var(--amber)',test:'var(--green)',scale:'var(--teal)',brand:'var(--pink)',kill:'var(--red)'};

  function pipeCard(p,stage){
    const sc=p.score>=8?'var(--green)':p.score>=5?'var(--amber)':'var(--red)';
    const ghBadge=p.gethookdVerified?'<span style="font-size:7px;background:var(--green-bg);color:var(--green);padding:1px 4px;border-radius:3px;border:1px solid var(--green-border)">âœ… GH</span>':'';
    const adCount=p.ads?`<span style="font-size:9px;color:var(--sub)">${p.ads} ads</span>`:'';
    const trafficStr=p.traffic?`<span style="font-size:9px;color:var(--sub)">${fN(p.traffic)} visits</span>`:'';
    return`<div style="background:var(--bg2);border:1px solid var(--border);border-left:3px solid ${stColors[stage]};border-radius:8px;padding:10px 12px;margin-bottom:6px;cursor:pointer;transition:all .15s" onmouseover="this.style.borderColor='${stColors[stage]}'" onmouseout="this.style.borderColor='var(--border)'" onclick="editProduct('${p.id}')">
      <div style="display:flex;justify-content:space-between;align-items:start">
        <div style="font-size:11px;font-weight:700;line-height:1.3;flex:1">${esc(p.name)}</div>
        <span style="font-size:12px;font-weight:800;color:${sc};margin-left:6px">${p.score.toFixed(1)}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:4px;align-items:center">
        ${ghBadge}${adCount}${trafficStr}
        ${p.price?'<span style="font-size:9px;font-weight:600;color:var(--text2)">$'+p.price.toFixed(0)+'</span>':''}
      </div>
      ${p.verdict?'<div style="font-size:8px;color:var(--sub);margin-top:4px;line-height:1.3">'+esc(p.verdict.slice(0,60))+(p.verdict.length>60?'â€¦':'')+'</div>':''}
    </div>`;
  }

  ['research','source','test','scale','brand'].forEach(s=>{
    const el=document.getElementById('col-'+s);
    if(cols[s].length){el.innerHTML=cols[s].map(p=>pipeCard(p,s)).join('')}
    else{el.innerHTML='<div style="text-align:center;padding:20px 8px;color:var(--dim);font-size:10px">No products</div>'}
  });
  const killEl=document.getElementById('col-kill');
  if(cols.kill.length){killEl.innerHTML=cols.kill.map(p=>pipeCard(p,'kill')).join('')}
  else{killEl.innerHTML='<div style="text-align:center;padding:12px;color:var(--dim);font-size:10px">None killed yet</div>'}

  // Pipeline counts
  document.getElementById('pipe-research').textContent=cols.research.length;
  document.getElementById('pipe-source').textContent=cols.source.length;
  document.getElementById('pipe-test').textContent=cols.test.length;
  document.getElementById('pipe-scale').textContent=cols.scale.length;
  document.getElementById('pipe-brand').textContent=cols.brand.length;
  document.getElementById('pipe-kill').textContent=cols.kill.length;
  document.getElementById('pipe-total').textContent=P.length;
  const active=cols.test.length+cols.scale.length+cols.brand.length;
  document.getElementById('pipe-conv').textContent=P.length?(Math.round(active/P.length*100))+'%':'0%';
}

// Patch render to also update pipeline
const _origRender=render;
const _patchedRender=function(){_origRender();renderPipeline()};
render=_patchedRender;

render();loadJSON();
</script>
</body>
</html>
