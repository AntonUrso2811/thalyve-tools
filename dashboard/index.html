<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Anton Empire â€” Command Centre</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:#12121a;--border:#1e1e2e;--text:#e4e4e7;--muted:#71717a;--accent:#8b5cf6;--accent2:#a78bfa;--green:#22c55e;--red:#ef4444;--amber:#f59e0b;--blue:#3b82f6;--teal:#14b8a6}
body{font-family:-apple-system,'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.ctr{max-width:1300px;margin:0 auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:8px}
h1{font-size:20px;font-weight:700}h1 span{color:var(--accent)}
.badge{font-size:10px;padding:3px 9px;border-radius:16px;font-weight:600;background:var(--accent);color:#fff}
.tabs{display:flex;gap:4px;margin-bottom:16px;flex-wrap:wrap}
.tab{padding:7px 15px;border-radius:7px;font-size:12px;cursor:pointer;border:1px solid var(--border);color:var(--muted);background:transparent;font-weight:500;transition:.2s}
.tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.tab:hover:not(.active){border-color:var(--accent);color:var(--text)}
.page{display:none}.page.active{display:block}
.grid{display:grid;gap:12px;margin-bottom:16px}
.g6{grid-template-columns:repeat(auto-fit,minmax(170px,1fr))}
.g2{grid-template-columns:1fr 1fr}
@media(max-width:768px){.g2{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:15px}
.card h2{font-size:13px;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.sl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px}
.sv{font-size:22px;font-weight:700}
.ss{font-size:10px;margin-top:2px}
.green{color:var(--green)}.red{color:var(--red)}.amber{color:var(--amber)}.blue{color:var(--blue)}.purple{color:var(--accent2)}.teal{color:var(--teal)}
.hl{border-radius:10px;padding:16px;margin-bottom:16px}
.hl-p{background:linear-gradient(135deg,rgba(139,92,246,.1),rgba(59,130,246,.07));border:1px solid rgba(139,92,246,.25)}
.hl-g{background:linear-gradient(135deg,rgba(34,197,94,.08),rgba(20,184,166,.06));border:1px solid rgba(34,197,94,.2)}
.hl-r{background:linear-gradient(135deg,rgba(239,68,68,.08),rgba(245,158,11,.06));border:1px solid rgba(239,68,68,.2)}
.pl{display:grid;grid-template-columns:1fr auto;gap:3px 18px;max-width:450px;font-size:12px}
.pl-sep{border-top:1px solid var(--border);padding-top:4px;font-weight:600}
.pl-total{border-top:2px solid var(--accent);padding-top:5px;font-weight:700;font-size:14px}
.fg{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px}
.fg-item{display:flex;flex-direction:column;gap:3px}
.fg-item label{font-size:10px;color:var(--muted);text-transform:uppercase}
.fg-item input,.fg-item select{background:var(--bg);border:1px solid var(--border);color:var(--text);padding:8px;border-radius:7px;font-size:12px;outline:none}
.fg-item input:focus{border-color:var(--accent)}
.fw{grid-column:1/-1}
button{background:var(--accent);color:#fff;border:none;padding:9px 18px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;transition:.2s}
button:hover{background:var(--accent2)}
.btn-s{padding:4px 10px;font-size:10px}
.btn-o{background:transparent;border:1px solid var(--border);color:var(--muted)}
.btn-o:hover{border-color:var(--accent);color:var(--text);background:transparent}
.btn-r{background:var(--red)}.btn-r:hover{background:#dc2626}
table{width:100%;border-collapse:collapse;font-size:11px}
th{text-align:left;padding:7px 5px;color:var(--muted);font-size:10px;text-transform:uppercase;border-bottom:1px solid var(--border)}
td{padding:7px 5px;border-bottom:1px solid var(--border)}
tr:hover td{background:rgba(139,92,246,.03)}
.empty{text-align:center;padding:25px;color:var(--muted);font-size:11px}
.chart-row{display:flex;align-items:center;gap:7px;margin-bottom:5px}
.chart-lbl{font-size:10px;color:var(--muted);width:50px;text-align:right;flex-shrink:0}
.chart-bg{flex:1;height:22px;background:var(--bg);border-radius:5px;overflow:hidden}
.chart-bar{height:100%;border-radius:5px;display:flex;align-items:center;padding-left:6px;font-size:10px;font-weight:600;color:#fff;transition:width .4s}
.toast{position:fixed;bottom:16px;right:16px;background:var(--green);color:#fff;padding:9px 16px;border-radius:7px;font-size:11px;font-weight:600;transform:translateY(80px);opacity:0;transition:.3s;z-index:100}
.toast.show{transform:translateY(0);opacity:1}
.wm{text-align:center;color:#333;font-size:9px;margin-top:25px;padding:12px}
.brand-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid var(--accent)}
.brand-header h2{font-size:16px;margin:0}
.brand-badge{font-size:10px;background:var(--green);color:#fff;padding:2px 8px;border-radius:10px}
</style>
</head>
<body>
<!-- Global Nav Bar -->
<div style="background:rgba(17,17,17,0.95);border-bottom:1px solid var(--border);padding:6px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)">
  <div style="display:flex;align-items:center;gap:12px">
    <a href="../" style="display:flex;align-items:center;gap:6px;text-decoration:none;color:var(--text);font-weight:700;font-size:13px;padding:4px 10px;background:var(--bg);border-radius:6px;border:1px solid var(--border);transition:all .2s" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">ğŸ  Home</a>
    <div style="display:flex;gap:4px">
      <a href="../tracker/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ” Tracker</a>
      <a href="../ads/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ“ˆ Ads</a>
      <a href="../hub/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ“ SOPs</a>
      <a href="../funnel/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ”„ Funnel</a>
      <a href="../org/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ‘¥ Org</a>
      <a href="../memory/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ§  Memory</a>
      <a href="../personal/" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ’ª Personal</a>
      <a href="../guides/master-strategy.html" style="font-size:10px;text-decoration:none;color:var(--muted);padding:3px 8px;border-radius:4px;background:var(--bg);transition:all .15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">ğŸ—ºï¸ Strategy</a>
    </div>
  </div>
  <div style="font-size:9px;color:var(--muted)">Anton Empire Â· v3.3 Â· <span id="last-updated" style="color:var(--green)"></span></div>
</div>

<div class="ctr">
  <header>
    <div><h1>ğŸ”± <span>Anton Empire</span> â€” Command Centre</h1><p style="font-size:10px;color:var(--muted);margin-top:2px">Company P&L â€¢ Brand Performance â€¢ Expenses â€¢ Tax Provisioning</p></div>
    <div style="display:flex;gap:5px;align-items:center">
      <button class="btn-s btn-o" onclick="forceRefresh()" style="background:var(--green);color:#000;font-weight:700;border-color:var(--green)">ğŸ”„ Refresh Data</button>
      <button class="btn-s btn-o" onclick="exportAll()">ğŸ“¥ Export</button>
      <button class="btn-s btn-o" onclick="exportJSON()">ğŸ’¾ Backup</button>
      <span class="badge" id="lastSync">â€”</span>
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="nav('overview',this)">ğŸ“Š Company Overview</div>
    <div class="tab" onclick="nav('brand',this)">ğŸ· THALYVEâ„¢</div>
    <div class="tab" onclick="nav('expenses',this)">ğŸ’° Company Expenses</div>
    <div class="tab" onclick="nav('log',this)">ğŸ“… Daily Log</div>
    <div class="tab" onclick="nav('tasks',this)">ğŸ¯ 5 Critical Tasks</div>
    <div class="tab" onclick="nav('team',this)">ğŸ‘¥ Team</div>
    <div class="tab" onclick="nav('kpi',this)">ğŸ¯ KPI Targets</div>
    <div class="tab" onclick="nav('roadmap',this)">ğŸ—º Roadmap</div>
    <div class="tab" onclick="nav('tasklog',this)">âš¡ Task Log</div>
    <div class="tab" onclick="nav('cron',this)">ğŸ¤– Cron Monitor</div>
    <div class="tab" onclick="nav('engine',this)">âš¡ AI Engine</div>
    <div class="tab" onclick="nav('calendar',this)">ğŸ“… Calendar</div>
    <div class="tab" onclick="nav('settings',this)">âš™ï¸ Settings</div>
    <div class="tab" onclick="nav('backup',this)" style="border-color:var(--red);color:var(--red)">ğŸ†˜ Backup & Recovery</div>
  </div>

  <!-- ===== COMPANY OVERVIEW ===== -->
  <div class="page active" id="p-overview">
    <!-- Hero Header -->
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:20px">
      <div style="width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;box-shadow:0 4px 16px rgba(124,58,237,.3)">ğŸ”±</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:20px;font-weight:800">Empire Overview</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">Real-time P&L Â· All brands combined Â· Auto-updated daily</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:1px">Status</div>
        <div style="display:flex;align-items:center;gap:4px;margin-top:2px"><span style="width:7px;height:7px;border-radius:50%;background:#0fd68c;display:inline-block;animation:pulse 2s infinite"></span><span style="font-size:12px;font-weight:700;color:#0fd68c">LIVE</span></div>
      </div>
    </div>
    <style>@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}</style>

    <!-- Time Period Filter -->
    <div style="display:flex;align-items:center;gap:6px;margin-bottom:12px;flex-wrap:wrap" id="period-filter">
      <span style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-right:4px">Period:</span>
      <button class="pfb active" onclick="setPeriod('today',this)">Today</button>
      <button class="pfb" onclick="setPeriod('7d',this)">7 Days</button>
      <button class="pfb" onclick="setPeriod('30d',this)">30 Days</button>
      <button class="pfb" onclick="setPeriod('mtd',this)">This Month</button>
      <button class="pfb" onclick="setPeriod('qtd',this)">This Quarter</button>
      <button class="pfb" onclick="setPeriod('all',this)">All Time</button>
      <div style="margin-left:auto;display:flex;align-items:center;gap:6px">
        <input type="date" id="pf-from" style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:4px 8px;color:var(--text);font-size:10px;font-family:inherit" onchange="setPeriod('custom')">
        <span style="font-size:10px;color:var(--muted)">to</span>
        <input type="date" id="pf-to" style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:4px 8px;color:var(--text);font-size:10px;font-family:inherit" onchange="setPeriod('custom')">
      </div>
    </div>
    <style>.pfb{font-size:10px;padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--muted);cursor:pointer;font-family:inherit;transition:all .15s}.pfb:hover{border-color:var(--accent);color:var(--text)}.pfb.active{background:var(--accent);color:#fff;border-color:var(--accent)}</style>

    <!-- Hero Net Profit Card -->
    <div style="background:linear-gradient(135deg,rgba(124,58,237,.12),rgba(168,85,247,.06));border:1px solid rgba(124,58,237,.25);border-radius:16px;padding:24px;text-align:center;margin-bottom:16px">
      <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:6px">Net Company Profit <span id="o-period-label" style="color:var(--accent2)">(All Time)</span></div>
      <div style="font-size:36px;font-weight:900;letter-spacing:-1px" id="o-net">$0</div>
      <div style="font-size:11px;color:var(--muted);margin-top:4px" id="o-netm">â€”</div>
    </div>

    <!-- KPI Cards â€” 2 rows of 3 -->
    <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--green)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Total Revenue</div>
        <div style="font-size:24px;font-weight:800;color:var(--green);margin-top:6px" id="o-rev">$0</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px" id="o-orders">0 orders</div>
      </div>
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--red)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Ad Spend</div>
        <div style="font-size:24px;font-weight:800;color:var(--red);margin-top:6px" id="o-ads">$0</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px" id="o-adpct">â€”</div>
      </div>
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--amber)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">COGS</div>
        <div style="font-size:24px;font-weight:800;color:var(--amber);margin-top:6px" id="o-cogs">$0</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px" id="o-cogspct">â€”</div>
      </div>
    </div>
    <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--blue)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Company Expenses</div>
        <div style="font-size:24px;font-weight:800;color:var(--blue);margin-top:6px" id="o-opex">$0</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px" id="o-opexn">â€”</div>
      </div>
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--teal)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Tax Provision (est.)</div>
        <div style="font-size:24px;font-weight:800;color:var(--teal);margin-top:6px" id="o-tax">$0</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px" id="o-taxr">19% of pre-tax profit</div>
      </div>
      <div class="card" style="text-align:center;padding:14px;border-top:3px solid var(--purple)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Active Brands</div>
        <div style="font-size:24px;font-weight:800;color:var(--purple);margin-top:6px" id="o-brands-count">1</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px">THALYVEâ„¢ testing</div>
      </div>
    </div>

    <!-- P&L Waterfall â€” redesigned -->
    <div class="card" style="background:linear-gradient(135deg,rgba(15,214,140,.03),rgba(124,58,237,.03));margin-bottom:12px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <span style="font-size:18px">ğŸ“‹</span>
        <h3 style="font-size:14px;margin:0;font-weight:700">Company P&L Statement</h3>
      </div>
      <div class="pl" id="o-pl">
        <span>ğŸ’° Gross Revenue (Shopify sales, all brands)</span><span class="green" id="pl-rev">$0</span>
        <span>ğŸ“¦ âˆ’ Cost of Goods Sold (supplier + shipping per unit)</span><span class="red" id="pl-cogs">$0</span>
        <span class="pl-sep">Gross Profit (revenue âˆ’ COGS)</span><span class="pl-sep green" id="pl-gross">$0</span>
        <span>ğŸ“£ âˆ’ Meta Ad Spend (via Ad Rail, incl. 3% agency fee)</span><span class="red" id="pl-ads">$0</span>
        <span style="font-weight:700;color:var(--accent2);padding-top:6px">ğŸ¢ Operating Expenses Breakdown:</span><span></span>
        <div id="pl-opex-items" style="grid-column:1/-1;display:flex;flex-direction:column;gap:2px;padding:4px 0 4px 20px;border-left:2px solid var(--border);margin:2px 0"></div>
        <span style="font-weight:600">ã€€ã€€Total Operating Expenses</span><span class="red" style="font-weight:600" id="pl-opex">$0</span>
        <div style="grid-column:1/-1;text-align:right;padding:2px 0">
          <button onclick="showExpenseEditor()" style="background:var(--accent);color:#fff;border:none;border-radius:4px;padding:3px 10px;font-size:9px;cursor:pointer;font-family:inherit">âœï¸ Edit Expenses</button>
        </div>
        <span class="pl-sep">Pre-Tax Profit (EBIT)</span><span class="pl-sep" id="pl-pretax">$0</span>
        <span>ğŸ›ï¸ âˆ’ Corporation Tax Provision (19% small profits rate)</span><span class="red" id="pl-tax">$0</span>
        <span class="pl-total">Net Profit After Tax (Est.)</span><span class="pl-total" id="pl-net">$0</span>
      </div>
    </div>

    <!-- Two-column: Brand Performance + Quick Stats -->
    <div class="grid" style="grid-template-columns:1fr 300px;gap:12px">
      <!-- Brand Summary -->
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
          <span style="font-size:16px">ğŸ·</span>
          <h2 style="margin:0;font-size:14px;font-weight:700">Brand Performance</h2>
        </div>
        <table>
          <thead><tr><th>Brand</th><th>Revenue</th><th>Orders</th><th>Ad Spend</th><th>COGS</th><th>Profit</th><th>ROAS</th><th>Margin</th></tr></thead>
          <tbody id="o-brands"><tr><td colspan="8" class="empty">No brand data yet â€” updates when ad data flows in</td></tr></tbody>
        </table>
      </div>

      <!-- Quick Stats Sidebar -->
      <div>
        <div class="card" style="margin-bottom:10px">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:10px">
            <span style="font-size:14px">âš¡</span>
            <h3 style="font-size:12px;margin:0;font-weight:700">Quick Stats</h3>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">War Chest</span><span style="font-weight:700;color:var(--amber)">Â£5,000</span></div>
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">Monthly Burn</span><span style="font-weight:700;color:var(--red)" id="qs-burn">â€”</span></div>
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">Runway</span><span style="font-weight:700;color:var(--blue)" id="qs-runway">â€”</span></div>
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">Break-Even Target</span><span style="font-weight:700;color:var(--green)">Â£2K/mo rev</span></div>
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">Team Size</span><span style="font-weight:700">3 (Anton + Forge + Quill)</span></div>
            <div style="display:flex;justify-content:space-between;font-size:11px"><span style="color:var(--muted)">Products Testing</span><span style="font-weight:700;color:var(--purple)">1 live Â· 5 research</span></div>
          </div>
        </div>
        <div class="card" style="background:linear-gradient(135deg,rgba(239,68,68,.05),rgba(249,115,22,.03))">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px">
            <span style="font-size:14px">ğŸ¯</span>
            <h3 style="font-size:12px;margin:0;font-weight:700">Target: Â£10K/mo Net</h3>
          </div>
          <div style="font-size:10px;color:var(--muted);line-height:1.5">
            = Â£40-50K revenue at 20-25% margin<br>
            = 27-33 orders/day at Â£50 AOV<br>
            = 3.0x ROAS minimum
          </div>
        </div>
      </div>
    </div>

    <!-- 7-day chart -->
    <div class="card" style="margin-top:12px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <span style="font-size:16px">ğŸ“ˆ</span>
        <h2 style="margin:0;font-size:14px;font-weight:700">Last 7 Days</h2>
      </div>
      <div id="o-chart"><div class="empty">Add daily entries to see trends</div></div>
    </div>

    <!-- Expense Breakdown Chart -->
    <div class="card" style="margin-top:12px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <span style="font-size:16px">ğŸ’°</span>
        <h2 style="margin:0;font-size:14px;font-weight:700">Expense Breakdown</h2>
      </div>
      <div id="o-expense-chart"></div>
    </div>

    <!-- Financial Advisor Panel -->
    <div class="card" style="margin-top:12px;background:linear-gradient(135deg,rgba(20,184,166,.04),rgba(59,130,246,.04))">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <span style="font-size:18px">ğŸ§®</span>
        <div>
          <h2 style="margin:0;font-size:14px;font-weight:700">Financial Advisor</h2>
          <div style="font-size:10px;color:var(--muted)">Auto-calculated from your real numbers Â· UK Ltd tax rules</div>
        </div>
      </div>
      <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px">
        <div style="background:var(--bg);border-radius:10px;padding:12px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Gross Margin</div>
          <div style="font-size:20px;font-weight:800;margin-top:4px" id="fa-gm">â€”</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Target: 60%+</div>
        </div>
        <div style="background:var(--bg);border-radius:10px;padding:12px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Net Margin</div>
          <div style="font-size:20px;font-weight:800;margin-top:4px" id="fa-nm">â€”</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Target: 20-25%</div>
        </div>
        <div style="background:var(--bg);border-radius:10px;padding:12px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Ad:Revenue Ratio</div>
          <div style="font-size:20px;font-weight:800;margin-top:4px" id="fa-ar">â€”</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Ideal: 30-40%</div>
        </div>
        <div style="background:var(--bg);border-radius:10px;padding:12px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:.5px">Opex:Revenue Ratio</div>
          <div style="font-size:20px;font-weight:800;margin-top:4px" id="fa-or">â€”</div>
          <div style="font-size:9px;color:var(--muted);margin-top:2px">Ideal: <10%</div>
        </div>
      </div>

      <!-- Salary Calculator -->
      <div style="background:var(--bg);border-radius:10px;padding:14px;border:1px solid var(--border);margin-bottom:12px">
        <div style="font-size:11px;font-weight:700;margin-bottom:10px;color:var(--teal)">ğŸ’· What Can You Pay Yourself?</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
          <div>
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);margin-bottom:2px">Pre-Tax Profit</div>
            <div style="font-size:16px;font-weight:800" id="fa-pretax">$0</div>
          </div>
          <div>
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);margin-bottom:2px">Corporation Tax (19%)</div>
            <div style="font-size:16px;font-weight:800;color:var(--red)" id="fa-tax">$0</div>
          </div>
          <div>
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);margin-bottom:2px">Available to Draw</div>
            <div style="font-size:16px;font-weight:800;color:var(--green)" id="fa-draw">$0</div>
          </div>
        </div>
        <div style="margin-top:10px;padding:8px;border-radius:6px;background:rgba(20,184,166,.06);border:1px solid rgba(20,184,166,.15);font-size:10px;color:var(--muted);line-height:1.5" id="fa-advice">
          ğŸ“Š No revenue data yet â€” financial ratios will calculate once ad performance data flows in.
        </div>
      </div>

      <!-- 30-Day Forecast -->
      <div style="background:var(--bg);border-radius:10px;padding:14px;border:1px solid var(--border)">
        <div style="font-size:11px;font-weight:700;margin-bottom:10px;color:var(--accent2)">ğŸ”® 30-Day Forecast (Projected)</div>
        <div id="fa-forecast" style="font-size:10px;color:var(--muted);line-height:1.6">Calculating...</div>
      </div>

      <!-- Expense Verification -->
      <div id="fa-expense-warn" style="background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.2);border-radius:10px;padding:10px;font-size:10px;color:var(--amber);line-height:1.5;display:none">
        âš ï¸ <strong>Some expenses are estimated.</strong> Tell Forge your actual monthly costs to get accurate projections. Unverified items are marked with *.
      </div>

      <!-- Recommended Splits -->
      <div style="background:var(--bg);border-radius:10px;padding:14px;border:1px solid var(--border)">
        <div style="font-size:11px;font-weight:700;margin-bottom:10px;color:var(--accent2)">ğŸ“ Recommended Profit Allocation</div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:100%;height:18px;background:var(--card);border-radius:4px;overflow:hidden;display:flex">
              <div style="width:50%;background:var(--green);display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff">50% Reinvest</div>
              <div style="width:20%;background:var(--blue);display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff">20% Cash</div>
              <div style="width:19%;background:var(--amber);display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff">19% Tax</div>
              <div style="width:11%;background:var(--purple);display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff">11% Draw</div>
            </div>
          </div>
          <div style="display:flex;gap:12px;font-size:9px;color:var(--muted);flex-wrap:wrap">
            <span>ğŸŸ¢ 50% â†’ Ad spend & inventory (growth)</span>
            <span>ğŸ”µ 20% â†’ Cash reserve (3-month runway)</span>
            <span>ğŸŸ¡ 19% â†’ Tax provision (set aside)</span>
            <span>ğŸŸ£ 11% â†’ Owner's draw (your pay)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== BRAND PAGE ===== -->
  <div class="page" id="p-brand">
    <!-- Brand Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">ğŸ·</div>
      <div style="flex:1">
        <div style="display:flex;align-items:center;gap:8px"><h2 style="margin:0;font-size:20px">THALYVEâ„¢</h2><span class="brand-badge">TESTING</span></div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">Universal Testing Brand Â· Health & Wellness Â· Winners get dedicated domains</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px;color:var(--muted)">Ads Status</div>
        <div style="font-size:13px;font-weight:700;color:var(--green)" id="b-launch-status">ğŸŸ¢ LIVE</div>
      </div>
    </div>

    <!-- Hero KPIs â€” 3 big cards -->
    <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:12px">
      <div class="card" style="text-align:center;border-top:3px solid var(--green);padding:16px">
        <div class="sl" style="margin-bottom:6px">Revenue</div>
        <div style="font-size:28px;font-weight:800;color:var(--green)" id="b-rev">$0.00</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px" id="b-orders">0 orders</div>
      </div>
      <div class="card" style="text-align:center;border-top:3px solid var(--red);padding:16px">
        <div class="sl" style="margin-bottom:6px">Ad Spend</div>
        <div style="font-size:28px;font-weight:800;color:var(--red)" id="b-ads">$0.00</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px" id="b-daily">$100/day budget</div>
      </div>
      <div class="card" style="text-align:center;border-top:3px solid var(--blue);padding:16px">
        <div class="sl" style="margin-bottom:6px">Net Profit</div>
        <div style="font-size:28px;font-weight:800" id="b-profit">$0.00</div>
        <div style="font-size:11px;margin-top:4px" id="b-margin">â€”</div>
      </div>
    </div>

    <!-- Secondary KPIs â€” compact row -->
    <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:10px">
        <div style="font-size:10px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">COGS</div>
        <div style="font-size:18px;font-weight:700;color:var(--amber);margin-top:2px" id="b-cogs">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:10px">
        <div style="font-size:10px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">ROAS</div>
        <div style="font-size:18px;font-weight:700;color:var(--purple);margin-top:2px" id="b-roas">0.00x</div>
        <div style="font-size:9px;margin-top:1px" id="b-roast">â€”</div>
      </div>
      <div class="card" style="text-align:center;padding:10px">
        <div style="font-size:10px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">CPA</div>
        <div style="font-size:18px;font-weight:700;color:var(--amber);margin-top:2px" id="b-cpa">$0</div>
        <div style="font-size:9px;margin-top:1px" id="b-cpat">â€”</div>
      </div>
      <div class="card" style="text-align:center;padding:10px">
        <div style="font-size:10px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Balance</div>
        <div style="font-size:18px;font-weight:700;color:var(--green);margin-top:2px" id="b-adleft">$1,000</div>
      </div>
    </div>

    <!-- Two-column: Products + Media Buying -->
    <div class="grid" style="grid-template-columns:1fr 300px;gap:12px;margin-bottom:12px">
      <!-- Product Breakdown -->
      <div class="card">
        <h2 style="font-size:13px;margin-bottom:10px">ğŸ“¦ Products</h2>
        <div id="b-prods-cards"></div>
        <table style="display:none"><tbody id="b-prods"></tbody></table>
      </div>

      <!-- Media Buying Sidebar -->
      <div class="card" style="background:linear-gradient(135deg,rgba(59,130,246,0.06),rgba(124,58,237,0.06))">
        <h2 style="font-size:13px;margin-bottom:12px">ğŸ“¡ Media Buying</h2>
        <div style="display:flex;flex-direction:column;gap:10px">
          <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px">
            <span style="font-size:11px;color:var(--muted)">Platform</span>
            <span style="font-size:13px;font-weight:700;color:var(--blue)">Meta Ads</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px">
            <span style="font-size:11px;color:var(--muted)">Agency</span>
            <span style="font-size:13px;font-weight:700">Ad Rail <span style="font-size:9px;color:var(--muted)">(3%)</span></span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px">
            <span style="font-size:11px;color:var(--muted)">Test Budget</span>
            <span style="font-size:13px;font-weight:700;color:var(--amber)">$100/day</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px">
            <span style="font-size:11px;color:var(--muted)">Structure</span>
            <span style="font-size:11px;font-weight:600">3 BMs Â· 1 Pixel</span>
          </div>
          <div style="margin-top:4px;padding:8px;border-radius:8px;background:rgba(15,214,140,0.08);border:1px solid rgba(15,214,140,0.2);text-align:center">
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Campaign Status</div>
            <div style="font-size:12px;font-weight:700;color:var(--green);margin-top:2px;display:flex;align-items:center;justify-content:center;gap:4px" id="b-warmup"><span style="width:6px;height:6px;border-radius:50%;background:#0fd68c;display:inline-block;animation:pulse 2s infinite"></span> LIVE Â· $100/day CBO</div>
          </div>
          <div style="margin-top:6px;padding:8px;border-radius:8px;background:var(--bg);text-align:center">
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Campaign</div>
            <div style="font-size:11px;font-weight:700;color:var(--text);margin-top:2px">THALYVE-SMS-TEST-01</div>
            <div style="font-size:9px;color:var(--muted);margin-top:1px">9 ads Â· Advantage+ Sales Â· Fully broad</div>
          </div>
          <div style="margin-top:6px;padding:8px;border-radius:8px;background:var(--bg);text-align:center">
            <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Launched</div>
            <div style="font-size:11px;font-weight:700;color:var(--amber);margin-top:2px">Feb 27, 2026</div>
            <div style="font-size:9px;color:var(--muted);margin-top:1px">48hr no-touch Â· Kill/scale Mar 1</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Daily Performance Chart -->
    <div class="card">
      <h2 style="font-size:13px;margin-bottom:8px">ğŸ“ˆ Daily Performance</h2>
      <div id="b-chart"><div class="empty" style="padding:24px;font-size:12px;color:var(--muted)">ğŸ“Š Ads LIVE since Feb 27 â€” data populates as daily entries are added (screenshot â†’ Forge â†’ here)</div></div>
    </div>
  </div>

  <!-- ===== EXPENSES ===== -->
  <div class="page" id="p-expenses">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#ef4444,#f97316);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ’°</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:18px">Company Expenses & Invoices</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">Track expenses Â· Store invoices Â· Auto-log recurring costs</div>
      </div>
    </div>

    <!-- Burn Rate Summary -->
    <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--red)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Monthly Recurring</div>
        <div style="font-size:22px;font-weight:800;color:var(--red);margin-top:4px" id="e-recur">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--amber)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">One-Time Costs</div>
        <div style="font-size:22px;font-weight:800;color:var(--amber);margin-top:4px" id="e-once">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--blue)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Total Burn / Month</div>
        <div style="font-size:22px;font-weight:800;color:var(--blue);margin-top:4px" id="e-burn">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--purple)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Invoices Stored</div>
        <div style="font-size:22px;font-weight:800;color:var(--purple);margin-top:4px" id="e-invoices">0</div>
      </div>
    </div>

    <div class="grid" style="grid-template-columns:320px 1fr;gap:12px">
      <!-- Add Expense Form -->
      <div>
        <div class="card" style="background:linear-gradient(135deg,rgba(239,68,68,0.04),rgba(249,115,22,0.04))">
          <h2 style="font-size:13px;margin-bottom:12px">â• Add Expense</h2>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Description</label><input id="e-name" placeholder="e.g. Shopify" style="width:100%"></div>
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Category</label>
              <select id="e-cat" style="width:100%"><option>Subscriptions</option><option>AI/API Costs</option><option>Domain/Hosting</option><option>Media Buying</option><option>Design/Creative</option><option>Legal/Compliance</option><option>Samples/Testing</option><option>Software/Tools</option><option>Tax</option><option>Other</option></select>
            </div>
            <div class="grid g2">
              <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Amount ($)</label><input type="number" id="e-amt" step="0.01" style="width:100%"></div>
              <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Frequency</label><select id="e-freq" style="width:100%"><option value="monthly">Monthly</option><option value="annual">Annual</option><option value="one-time">One-time</option></select></div>
            </div>
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Date</label><input type="date" id="e-date" style="width:100%"></div>
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Notes</label><input id="e-notes" style="width:100%"></div>
            <button onclick="addExpense()" style="margin-top:4px;width:100%;padding:10px;font-weight:700">+ Add Expense</button>
          </div>
        </div>

        <!-- Invoice Upload Info -->
        <div class="card" style="margin-top:12px">
          <h2 style="font-size:13px;margin-bottom:8px">ğŸ§¾ Invoice Manager</h2>
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px">How to store invoices:</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <div style="padding:8px 10px;background:var(--bg);border-radius:8px;font-size:10px">
              <strong style="color:var(--green)">ğŸ“± Via Telegram:</strong> Send receipt photo/PDF to Forge â†’ auto-logged & stored
            </div>
            <div style="padding:8px 10px;background:var(--bg);border-radius:8px;font-size:10px">
              <strong style="color:var(--amber)">ğŸ”„ Auto-Recurring:</strong> Shopify, AI subscriptions, domains â†’ logged automatically 1st of each month
            </div>
            <div style="padding:8px 10px;background:var(--bg);border-radius:8px;font-size:10px">
              <strong style="color:var(--blue)">ğŸ“Š Ad Spend:</strong> Daily cron pulls from ad platform when ads go live
            </div>
          </div>
          <div style="margin-top:8px;padding:8px;background:rgba(76,175,80,0.05);border:1px solid rgba(76,175,80,0.15);border-radius:8px;font-size:10px;color:var(--muted)">
            ğŸ’¡ <strong>Goal:</strong> Zero manual expense entry. Everything automated or captured via Telegram photo.
          </div>
        </div>
      </div>

      <!-- Expenses Table -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h2 style="font-size:13px;margin:0">ğŸ“‹ All Expenses</h2>
          <span style="font-size:10px;color:var(--muted)" id="e-count">0 expenses</span>
        </div>
        <table>
          <thead><tr><th>Description</th><th>Category</th><th>Amount</th><th>Freq</th><th>Date</th><th></th></tr></thead>
          <tbody id="e-table"><tr><td colspan="6" class="empty">No expenses yet â€” add your first or let Forge auto-log recurring costs</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== DAILY LOG ===== -->
  <div class="page" id="p-log">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ“Š</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:18px">Daily P&L Log</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">Revenue Â· Ad Spend Â· Orders Â· Profit â€” tracked daily per product</div>
      </div>
      <div style="padding:6px 12px;border-radius:8px;background:rgba(15,214,140,0.08);border:1px solid rgba(15,214,140,0.2)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Data Flow</div>
        <div style="font-size:11px;font-weight:700;color:var(--green)">Forge-synced from ad-data.json</div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid" style="grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--green)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Total Revenue</div>
        <div style="font-size:20px;font-weight:800;color:var(--green);margin-top:4px" id="dl-rev">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--red)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Total Ad Spend</div>
        <div style="font-size:20px;font-weight:800;color:var(--red);margin-top:4px" id="dl-ads">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--blue)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Net Profit</div>
        <div style="font-size:20px;font-weight:800;margin-top:4px" id="dl-profit">$0</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--purple)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Avg ROAS</div>
        <div style="font-size:20px;font-weight:800;color:var(--purple);margin-top:4px" id="dl-roas">0.00x</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--amber)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Total Orders</div>
        <div style="font-size:20px;font-weight:800;color:var(--amber);margin-top:4px" id="dl-orders">0</div>
      </div>
    </div>

    <!-- Metric Key -->
    <div style="padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:16px;display:flex;flex-wrap:wrap;gap:16px;font-size:10px;color:var(--muted)">
      <span>ğŸ“¦ <strong style="color:var(--text)">Orders</strong> = units sold</span>
      <span>ğŸ’° <strong style="color:var(--green)">Revenue</strong> = orders Ã— price</span>
      <span>ğŸ“¢ <strong style="color:var(--red)">Ad Spend</strong> = Meta ads cost</span>
      <span>ğŸ­ <strong style="color:var(--amber)">COGS</strong> = supplier cost per unit Ã— orders</span>
      <span>ğŸ“Š <strong style="color:var(--blue)">Profit</strong> = revenue âˆ’ ad spend âˆ’ COGS</span>
      <span>ğŸ¯ <strong style="color:var(--purple)">ROAS</strong> = revenue Ã· ad spend (2x+ = strong)</span>
    </div>

    <!-- Mini Chart -->
    <div class="card" style="margin-bottom:16px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h2 style="font-size:13px;margin:0">ğŸ“ˆ 7-Day Trend</h2>
        <span style="font-size:10px;color:var(--muted)" id="dl-period">â€”</span>
      </div>
      <div id="dl-chart"><div class="empty" style="padding:20px;font-size:12px;color:var(--muted)">Chart populates with first entry</div></div>
    </div>

    <!-- Two column: Log form + Entries -->
    <div class="grid" style="grid-template-columns:320px 1fr;gap:12px">
      <!-- Log Form -->
      <div class="card" style="background:linear-gradient(135deg,rgba(59,130,246,0.04),rgba(124,58,237,0.04))">
        <h2 style="font-size:13px;margin-bottom:12px">â• Log Entry</h2>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Date</label><input type="date" id="d-date" style="width:100%"></div>
          <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Brand</label><select id="d-brand" style="width:100%"></select></div>
          <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Product</label><select id="d-prod" style="width:100%"></select></div>
          <div class="grid g2">
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Orders</label><input type="number" id="d-orders" value="0" min="0" style="width:100%"></div>
            <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Ad Spend ($)</label><input type="number" id="d-ads" step="0.01" value="0" style="width:100%"></div>
          </div>
          <div><label style="font-size:10px;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:3px">Revenue ($)</label><input type="number" id="d-rev" step="0.01" placeholder="Auto-calculated from orders" style="width:100%"></div>
          <button onclick="addDaily()" style="margin-top:4px;width:100%;padding:10px;font-weight:700">+ Add Entry</button>
        </div>
        <div style="margin-top:12px;padding:8px;background:rgba(15,214,140,0.05);border:1px solid rgba(15,214,140,0.15);border-radius:8px;font-size:10px;color:var(--muted)">
          âœ… <strong>Automated:</strong> Forge logs entries from screenshots â†’ ad-data.json â†’ syncs here on refresh. Manual entry available as backup.
        </div>
      </div>

      <!-- Entries Table -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h2 style="font-size:13px;margin:0">ğŸ“… All Entries</h2>
          <span style="font-size:10px;color:var(--muted)" id="dl-count">0 entries</span>
        </div>
        <table>
          <thead><tr><th title="Date the data was recorded">Date</th><th title="Which brand this entry belongs to">Brand</th><th title="Specific product sold">Product</th><th title="Number of units sold that day">Orders</th><th title="Total money received from sales (orders Ã— price)">Revenue</th><th title="Money spent on Meta ads that day">Ad Spend</th><th title="Cost of goods sold â€” what you paid the supplier per unit Ã— orders">COGS</th><th title="Revenue minus Ad Spend minus COGS = your actual take-home">Profit</th><th title="Return on Ad Spend â€” Revenue Ã· Ad Spend. Above 2x = strong, 1x = break-even">ROAS</th><th></th></tr></thead>
          <tbody id="d-table"><tr><td colspan="10" class="empty">No entries yet â€” log your first day or wait for automation ğŸš€</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== 5 CRITICAL TASKS ===== -->
  <div class="page" id="p-tasks">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#ef4444,#f97316);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ¯</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:18px">Critical Tasks</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">5 daily tasks per member that move the needle. Auto-generated 6AM.</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:10px;color:var(--muted)">Today</div>
        <div style="font-size:14px;font-weight:700;color:var(--accent)" id="ct-date">â€”</div>
      </div>
    </div>

    <!-- Overall Progress Ring + Stats -->
    <div class="grid" style="grid-template-columns:200px 1fr 1fr;gap:12px;margin-bottom:16px">
      <!-- Progress Ring -->
      <div class="card" style="text-align:center;padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div style="position:relative;width:100px;height:100px">
          <svg width="100" height="100" style="transform:rotate(-90deg)">
            <circle cx="50" cy="50" r="42" fill="none" stroke="var(--bg)" stroke-width="8"/>
            <circle id="ct-ring" cx="50" cy="50" r="42" fill="none" stroke="var(--green)" stroke-width="8" stroke-dasharray="264" stroke-dashoffset="264" stroke-linecap="round" style="transition:stroke-dashoffset .6s"/>
          </svg>
          <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:800" id="ct-overall">0%</div>
        </div>
        <div style="font-size:10px;color:var(--muted);margin-top:8px">Overall Today</div>
      </div>

      <!-- ROI Tracker -->
      <div class="card" style="background:linear-gradient(135deg,rgba(76,175,80,0.05),rgba(59,130,246,0.05))">
        <h2 style="font-size:12px;margin-bottom:10px">ğŸ’° ROI Tracker <span style="font-size:9px;color:var(--muted);font-weight:400" id="roi-since">since â€”</span></h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div style="padding:8px;background:var(--bg);border-radius:8px;text-align:center">
            <div style="font-size:18px;font-weight:800;color:var(--green)" id="roi-equiv">$0</div>
            <div style="font-size:8px;text-transform:uppercase;color:var(--muted);margin-top:2px">Human Equiv. Cost Saved</div>
          </div>
          <div style="padding:8px;background:var(--bg);border-radius:8px;text-align:center">
            <div style="font-size:18px;font-weight:800;color:var(--purple)" id="roi-hours">0h</div>
            <div style="font-size:8px;text-transform:uppercase;color:var(--muted);margin-top:2px">Forge Hours Worked</div>
          </div>
          <div style="padding:8px;background:var(--bg);border-radius:8px;text-align:center">
            <div style="font-size:18px;font-weight:800;color:var(--amber)" id="roi-hequiv">0h</div>
            <div style="font-size:8px;text-transform:uppercase;color:var(--muted);margin-top:2px">Human Equiv. Hours</div>
          </div>
          <div style="padding:8px;background:var(--bg);border-radius:8px;text-align:center">
            <div style="font-size:18px;font-weight:800;color:var(--blue)" id="roi-tasks">0</div>
            <div style="font-size:8px;text-transform:uppercase;color:var(--muted);margin-top:2px">Tasks Completed</div>
          </div>
        </div>
        <div style="margin-top:8px;font-size:9px;color:var(--muted);text-align:center" id="roi-note">Based on $25/hr human VA equivalent</div>
      </div>

      <!-- Completion Analytics -->
      <div class="card">
        <h2 style="font-size:12px;margin-bottom:10px">ğŸ“Š Completion History</h2>
        <div id="ct-history"><div class="empty" style="font-size:11px">Loading...</div></div>
      </div>
    </div>

    <!-- Time Split Bar -->
    <div style="padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:16px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <span style="font-size:10px;font-weight:700;color:var(--muted)">TIME SPLIT TODAY</span>
        <span style="font-size:10px;color:var(--muted)" id="ct-split-label">â€”</span>
      </div>
      <div style="display:flex;height:10px;border-radius:5px;overflow:hidden;background:var(--bg)">
        <div id="ct-split-anton" style="height:100%;background:var(--amber);transition:width .4s" title="Anton's input time"></div>
        <div id="ct-split-forge" style="height:100%;background:var(--green);transition:width .4s" title="Forge's work time"></div>
      </div>
      <div style="display:flex;gap:12px;margin-top:4px;font-size:9px;color:var(--muted)">
        <span>ğŸŸ¡ Anton's input</span><span>ğŸŸ¢ Forge's output</span><span>â¬› Human equivalent saved</span>
      </div>
    </div>

    <!-- Task Lists -->
    <div id="ct-members"></div>
  </div>

  <!-- ===== TEAM ===== -->
  <div class="page" id="p-team">
    <div class="hl hl-p" style="margin-bottom:16px">
      <h3 style="font-size:14px;margin-bottom:4px">ğŸ‘¥ Team Roster</h3>
      <p style="font-size:11px;color:var(--muted)">Current team + planned hires. Updates automatically when Forge onboards new agents.</p>
    </div>
    <div class="grid g2" style="margin-bottom:16px">
      <div class="card" style="text-align:center"><div class="sl">Active Members</div><div class="sv green" id="tm-active">0</div></div>
      <div class="card" style="text-align:center"><div class="sl">Planned Hires</div><div class="sv amber" id="tm-planned">0</div></div>
    </div>

    <!-- ORG TREE DIAGRAM -->
    <div class="card" style="margin-bottom:16px;overflow-x:auto">
      <h2>ğŸŒ³ Organisation Tree</h2>
      <div id="org-tree" style="display:flex;flex-direction:column;align-items:center;gap:0;padding:20px 0;min-width:600px"></div>
    </div>

    <!-- Profile Cards -->
    <div id="tm-profiles" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px"></div>

    <!-- Job Monitor -->
    <div class="card" style="margin-top:16px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:16px">ğŸ“‹</span>
          <h2 style="margin:0;font-size:14px;font-weight:700">Job Monitor â€” Task History</h2>
        </div>
        <select id="jm-filter" onchange="filterJobMonitor()" style="background:var(--card);border:1px solid var(--border);border-radius:6px;padding:4px 10px;color:var(--text);font-size:10px;font-family:inherit">
          <option value="all">All Members</option>
        </select>
      </div>
      <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px">
        <div style="background:var(--bg);border-radius:8px;padding:10px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Total Tasks</div>
          <div style="font-size:18px;font-weight:800;color:var(--accent2);margin-top:2px" id="jm-total">0</div>
        </div>
        <div style="background:var(--bg);border-radius:8px;padding:10px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Completed</div>
          <div style="font-size:18px;font-weight:800;color:var(--green);margin-top:2px" id="jm-done">0</div>
        </div>
        <div style="background:var(--bg);border-radius:8px;padding:10px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Avg Duration</div>
          <div style="font-size:18px;font-weight:800;color:var(--blue);margin-top:2px" id="jm-avgtime">â€”</div>
        </div>
        <div style="background:var(--bg);border-radius:8px;padding:10px;text-align:center;border:1px solid var(--border)">
          <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Resources Used</div>
          <div style="font-size:18px;font-weight:800;color:var(--amber);margin-top:2px" id="jm-resources">â€”</div>
        </div>
      </div>
      <table>
        <thead><tr><th>Member</th><th>Task</th><th>Status</th><th>Started</th><th>Duration</th><th>Model</th></tr></thead>
        <tbody id="jm-table"><tr><td colspan="6" class="empty">No task history yet</td></tr></tbody>
      </table>
    </div>

    <!-- Legacy table (hidden) -->
    <table style="display:none"><tbody id="tm-table"></tbody></table>
  </div>

  <!-- ===== KPI TARGETS ===== -->
  <div class="page" id="p-kpi">
    <div class="hl hl-p" style="margin-bottom:16px">
      <h3 style="font-size:14px;margin-bottom:4px">ğŸ¯ Weekly KPI Targets</h3>
      <p style="font-size:11px;color:var(--muted)" id="kpi-week">Week of â€”</p>
    </div>
    <div id="kpi-departments"></div>
  </div>

  <!-- ===== ROADMAP ===== -->
  <div class="page" id="p-roadmap">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#8b5cf6,#6366f1);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ—ºï¸</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:18px">Roadmap to Â£10K/month</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">4-phase plan Â· Infrastructure â†’ Testing â†’ Scaling â†’ Empire</div>
      </div>
      <div id="rm-phase-badge" style="padding:6px 14px;border-radius:8px;background:rgba(76,175,80,0.1);border:1px solid rgba(76,175,80,0.2)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Current Phase</div>
        <div style="font-size:13px;font-weight:700;color:var(--green)">Phase 1 Â· Foundation</div>
      </div>
    </div>

    <!-- Milestone Timeline -->
    <div class="card" style="margin-bottom:16px;overflow-x:auto">
      <div style="display:flex;align-items:center;gap:0;min-width:700px;padding:10px 0">
        <div style="flex:1;text-align:center">
          <div style="font-size:20px">ğŸ—ï¸</div>
          <div style="font-size:10px;font-weight:700;margin-top:4px;color:var(--green)">Phase 1</div>
          <div style="font-size:8px;color:var(--muted)">Foundation</div>
          <div style="font-size:8px;color:var(--green);font-weight:600">Week 1 Â· NOW</div>
        </div>
        <div style="flex:2;height:4px;background:linear-gradient(90deg,var(--green),var(--amber));border-radius:2px;position:relative">
          <div style="position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:8px;color:var(--muted);white-space:nowrap">First Sale â†’</div>
        </div>
        <div style="flex:1;text-align:center">
          <div style="font-size:20px">ğŸ§ª</div>
          <div style="font-size:10px;font-weight:700;margin-top:4px;color:var(--amber)">Phase 2</div>
          <div style="font-size:8px;color:var(--muted)">Product Testing</div>
          <div style="font-size:8px;color:var(--muted)">Week 2-4</div>
        </div>
        <div style="flex:2;height:4px;background:linear-gradient(90deg,var(--amber),var(--purple));border-radius:2px;position:relative">
          <div style="position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:8px;color:var(--muted);white-space:nowrap">Â£1K Month â†’</div>
        </div>
        <div style="flex:1;text-align:center">
          <div style="font-size:20px">ğŸš€</div>
          <div style="font-size:10px;font-weight:700;margin-top:4px;color:var(--purple)">Phase 3</div>
          <div style="font-size:8px;color:var(--muted)">Scale Winners</div>
          <div style="font-size:8px;color:var(--muted)">Week 5-8</div>
        </div>
        <div style="flex:2;height:4px;background:linear-gradient(90deg,var(--purple),var(--blue));border-radius:2px;position:relative">
          <div style="position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:8px;color:var(--muted);white-space:nowrap">Â£5K Month â†’</div>
        </div>
        <div style="flex:1;text-align:center">
          <div style="font-size:20px">ğŸ‘‘</div>
          <div style="font-size:10px;font-weight:700;margin-top:4px;color:var(--blue)">Phase 4</div>
          <div style="font-size:8px;color:var(--muted)">Empire</div>
          <div style="font-size:8px;color:var(--muted)">Month 3+</div>
        </div>
      </div>
    </div>

    <!-- Financial Model -->
    <div class="card" style="margin-bottom:16px;background:linear-gradient(135deg,rgba(76,175,80,0.04),rgba(59,130,246,0.04))">
      <h2 style="font-size:13px;margin-bottom:10px">ğŸ’° Financial Model <span style="font-size:9px;color:var(--muted);font-weight:400">20-25% net margin (realistic ecom)</span></h2>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center;margin-bottom:12px">
        <div style="padding:8px;background:var(--bg);border-radius:8px">
          <div style="font-size:8px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Target Profit</div>
          <div style="font-size:18px;font-weight:800;color:var(--green);margin-top:2px">Â£10K/mo</div>
        </div>
        <div style="padding:8px;background:var(--bg);border-radius:8px">
          <div style="font-size:8px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Revenue Needed</div>
          <div style="font-size:18px;font-weight:800;color:var(--blue);margin-top:2px">Â£40-50K</div>
        </div>
        <div style="padding:8px;background:var(--bg);border-radius:8px">
          <div style="font-size:8px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Daily Orders</div>
          <div style="font-size:18px;font-weight:800;color:var(--purple);margin-top:2px">27-33</div>
        </div>
        <div style="padding:8px;background:var(--bg);border-radius:8px">
          <div style="font-size:8px;text-transform:uppercase;color:var(--muted);letter-spacing:0.5px">Target ROAS</div>
          <div style="font-size:18px;font-weight:800;color:var(--amber);margin-top:2px">3.0x</div>
        </div>
      </div>
      <div style="font-size:10px;color:var(--muted);padding:6px 10px;background:var(--bg);border-radius:6px">
        ğŸ“ <strong>Math:</strong> Â£50 AOV Ã— 27-33 orders/day = Â£40-50K revenue â†’ 20-25% net margin after ad spend (Â£3-5K/mo), COGS, platform fees, returns = <strong style="color:var(--green)">Â£10K profit</strong>
      </div>
    </div>

    <!-- Key Milestones -->
    <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px">
      <div style="padding:12px;background:var(--card);border:1px solid var(--border);border-radius:10px;text-align:center;border-top:3px solid var(--green)">
        <div style="font-size:16px">ğŸ’·</div>
        <div style="font-size:11px;font-weight:700;margin-top:4px">First Sale</div>
        <div style="font-size:9px;color:var(--green);margin-top:2px">Rev: Â£40-200</div>
        <div style="font-size:9px;color:var(--muted)">Target: Week 2</div>
        <div style="font-size:9px;color:var(--amber);font-weight:600;margin-top:2px">PENDING</div>
      </div>
      <div style="padding:12px;background:var(--card);border:1px solid var(--border);border-radius:10px;text-align:center;border-top:3px solid var(--amber)">
        <div style="font-size:16px">ğŸ“ˆ</div>
        <div style="font-size:11px;font-weight:700;margin-top:4px">Â£1K Profit</div>
        <div style="font-size:9px;color:var(--green);margin-top:2px">Rev: Â£4-5K/mo</div>
        <div style="font-size:9px;color:var(--muted)">Target: Week 4-6</div>
        <div style="font-size:9px;color:var(--muted);font-weight:600;margin-top:2px">â€”</div>
      </div>
      <div style="padding:12px;background:var(--card);border:1px solid var(--border);border-radius:10px;text-align:center;border-top:3px solid var(--purple)">
        <div style="font-size:16px">ğŸ”¥</div>
        <div style="font-size:11px;font-weight:700;margin-top:4px">Â£5K Profit</div>
        <div style="font-size:9px;color:var(--green);margin-top:2px">Rev: Â£20-25K/mo</div>
        <div style="font-size:9px;color:var(--muted)">Target: Month 2-3</div>
        <div style="font-size:9px;color:var(--muted);font-weight:600;margin-top:2px">â€”</div>
      </div>
      <div style="padding:12px;background:var(--card);border:1px solid var(--border);border-radius:10px;text-align:center;border-top:3px solid var(--blue)">
        <div style="font-size:16px">ğŸ‘‘</div>
        <div style="font-size:11px;font-weight:700;margin-top:4px">Â£10K Profit</div>
        <div style="font-size:9px;color:var(--green);margin-top:2px">Rev: Â£40-50K/mo</div>
        <div style="font-size:9px;color:var(--muted)">Target: Month 3-4</div>
        <div style="font-size:9px;color:var(--muted);font-weight:600;margin-top:2px">â€”</div>
      </div>
    </div>

    <!-- This Week / Next Week -->
    <div class="grid g2">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h2 style="margin:0;font-size:13px">ğŸ“Œ This Week</h2>
          <div style="display:flex;align-items:center;gap:6px"><span style="font-size:10px;color:var(--muted)" id="rm-thisweek">â€”</span><span style="font-size:11px;font-weight:700" id="rm-this-pct"></span></div>
        </div>
        <div id="rm-this-bar" style="height:4px;background:var(--bg);border-radius:2px;overflow:hidden;margin-bottom:10px"><div id="rm-this-fill" style="height:100%;border-radius:2px;transition:width .3s"></div></div>
        <div id="rm-this"></div>
      </div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h2 style="margin:0;font-size:13px">ğŸ”® Next Week</h2>
          <span style="font-size:10px;color:var(--muted)" id="rm-nextweek">â€”</span>
        </div>
        <div id="rm-next"></div>
      </div>
    </div>

    <!-- Key Deadlines -->
    <div class="card" style="margin-top:12px;background:linear-gradient(135deg,rgba(239,68,68,0.04),rgba(249,115,22,0.04))">
      <h2 style="font-size:13px;margin-bottom:10px">â° Key Deadlines</h2>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid var(--red)">
          <div><span style="font-size:11px;font-weight:700">Ad Testing Launch</span><span style="font-size:10px;color:var(--muted);margin-left:8px">$100/day on Meta</span></div>
          <span style="font-size:11px;font-weight:700;color:var(--red)">Feb 28</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid var(--amber)">
          <div><span style="font-size:11px;font-weight:700">Shopify Downgrade</span><span style="font-size:10px;color:var(--muted);margin-left:8px">Before promo expires</span></div>
          <span style="font-size:11px;font-weight:700;color:var(--amber)">Mar 12</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid var(--amber)">
          <div><span style="font-size:11px;font-weight:700">GitHub PAT Rotation</span><span style="font-size:10px;color:var(--muted);margin-left:8px">forge-deploy token</span></div>
          <span style="font-size:11px;font-weight:700;color:var(--amber)">Mar 27</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid var(--purple)">
          <div><span style="font-size:11px;font-weight:700">First Winner Decision</span><span style="font-size:10px;color:var(--muted);margin-left:8px">Scale or kill after 5-7 days data</span></div>
          <span style="font-size:11px;font-weight:700;color:var(--purple)">~Mar 7</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== TASK LOG ===== -->
  <div class="page" id="p-tasklog">
    <div class="card">
      <h2>âš¡ Forge Activity Feed</h2>
      <p style="font-size:10px;color:var(--muted);margin-bottom:12px">Real-time log of what Forge is working on. Most recent first.</p>
      <table>
        <thead><tr><th>Status</th><th>Task</th><th>Owner</th><th>Started</th><th>Finished</th><th>Duration</th></tr></thead>
        <tbody id="tl-table"><tr><td colspan="6" class="empty">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

  <!-- ===== CRON MONITOR ===== -->
  <div class="page" id="p-cron">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#22c55e,#14b8a6);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ¤–</div>
      <div style="flex:1">
        <h2 style="margin:0;font-size:18px">Cron Job Monitor</h2>
        <div style="font-size:11px;color:var(--muted);margin-top:2px">All scheduled automations Â· Model routing Â· Status Â· Last run</div>
      </div>
      <div style="padding:6px 14px;border-radius:8px;background:rgba(76,175,80,0.08);border:1px solid rgba(76,175,80,0.2)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Active Jobs</div>
        <div style="font-size:13px;font-weight:700;color:var(--green)" id="cron-count">8</div>
      </div>
    </div>

    <!-- Summary -->
    <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--green)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Last 24h Runs</div>
        <div style="font-size:22px;font-weight:800;color:var(--green);margin-top:4px" id="cron-runs">4 âœ…</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--amber)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Opus Tasks</div>
        <div style="font-size:22px;font-weight:800;color:var(--amber);margin-top:4px" id="cron-opus">1</div>
      </div>
      <div class="card" style="text-align:center;padding:12px;border-top:3px solid var(--purple)">
        <div style="font-size:9px;text-transform:uppercase;color:var(--muted)">Sonnet Tasks</div>
        <div style="font-size:22px;font-weight:800;color:var(--purple);margin-top:4px" id="cron-sonnet">7</div>
      </div>
    </div>

    <!-- Model Routing Key -->
    <div style="padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:16px;display:flex;flex-wrap:wrap;gap:16px;font-size:10px;color:var(--muted)">
      <span>ğŸŸ£ <strong style="color:var(--amber)">Opus</strong> = complex reasoning, QC, creative</span>
      <span>ğŸ”µ <strong style="color:var(--purple)">Sonnet</strong> = structured tasks, research, maintenance</span>
      <span>ğŸŸ¢ <strong style="color:var(--green)">OK</strong> = last run succeeded</span>
      <span>ğŸ”´ <strong style="color:var(--red)">Error</strong> = last run failed</span>
      <span>âšª <strong>Idle</strong> = hasn't run yet</span>
    </div>

    <!-- Jobs Table -->
    <div class="card">
      <h2 style="font-size:13px;margin-bottom:10px">ğŸ“‹ All Scheduled Jobs</h2>
      <div id="cron-jobs" style="display:flex;flex-direction:column;gap:8px">

        <!-- Product Research -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(76,175,80,0.1);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ”</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Product Research Pipeline</div>
            <div style="font-size:10px;color:var(--muted)">Mon & Thu at 3:00 AM Â· Scans health/wellness market, scores 3-5 products against BBA criteria (pain point, 3Ã— COGS, $20+ margin), checks SimilarWeb traffic & FB Ad Library for validation. Delivers ranked shortlist to Telegram.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--green)">ğŸŸ¢ OK</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Last Run</div>
            <div style="font-size:10px;font-weight:600">Thu 3AM</div>
          </div>
        </div>

        <!-- Morning Briefing -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(76,175,80,0.1);display:flex;align-items:center;justify-content:center;font-size:16px">â˜€ï¸</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Morning Briefing</div>
            <div style="font-size:10px;color:var(--muted)">Daily at 7:00 AM Â· Compiles overnight activity, 75 Hard day count, ad campaign status, upcoming deadlines, and today's priorities into a single Telegram briefing. Your daily "state of the empire" report.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--green)">ğŸŸ¢ OK</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Last Run</div>
            <div style="font-size:10px;font-weight:600">Today 7AM</div>
          </div>
        </div>

        <!-- Daily Critical Tasks -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(76,175,80,0.1);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ¯</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Daily Critical Tasks</div>
            <div style="font-size:10px;color:var(--muted)">Daily at 6:00 AM Â· Generates 5 high-impact tasks each for Anton (CEO decisions, approvals, supplier comms) and Forge (research, tool updates, memory, systems). Delivered to Telegram before morning walk.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--green)">ğŸŸ¢ OK</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Last Run</div>
            <div style="font-size:10px;font-weight:600">Today 6AM</div>
          </div>
        </div>

        <!-- Memory Maintenance -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ§ </div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Memory Maintenance</div>
            <div style="font-size:10px;color:var(--muted)">Sunday at 2:00 AM Â· Reviews all daily log files from the past week, extracts key decisions/lessons/insights, updates MEMORY.md with curated long-term knowledge, and cleans outdated entries. Keeps Forge's brain sharp.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--muted)">âšª Idle</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Next Run</div>
            <div style="font-size:10px;font-weight:600">Sun 2AM</div>
          </div>
        </div>

        <!-- Dashboard Refresh -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(76,175,80,0.1);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ”„</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Dashboard Auto-Refresh</div>
            <div style="font-size:10px;color:var(--muted)">Daily at 5:00 AM Â· Updates company-data.json with current dates, statuses, and metrics. Ensures dashboard never shows stale data. Prevents the "not updated" problem permanently.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--green)">ğŸŸ¢ OK</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Last Run</div>
            <div style="font-size:10px;font-weight:600">Today 5AM</div>
          </div>
        </div>

        <!-- Weekly Forge Report -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ“</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Weekly COO Report</div>
            <div style="font-size:10px;color:var(--muted)">Monday at 7:00 AM Â· Forge's weekly brief to Anton: what was improved, new hires, system health, next week's plan, and one strategic insight. The CEO gets a report from his COO every Monday.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--muted)">âšª New</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Next Run</div>
            <div style="font-size:10px;font-weight:600">Mon 7AM</div>
          </div>
        </div>

        <!-- Deep Work Summary -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ§˜</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Deep Work Summary</div>
            <div style="font-size:10px;color:var(--muted)">Daily at 11:15 AM Â· End-of-deep-work recap. Summarizes what was accomplished during the 4hr morning focus block, logs completion to daily memory file, and flags any carry-over tasks for the afternoon.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--muted)">âšª Idle</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Next Run</div>
            <div style="font-size:10px;font-weight:600">Today 11:15</div>
          </div>
        </div>

        <!-- Security Audit -->
        <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="flex-shrink:0;width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸ›¡ï¸</div>
          <div style="flex:1">
            <div style="font-size:13px;font-weight:700">Security Audit</div>
            <div style="font-size:10px;color:var(--muted)">1st of every month at 3:00 AM Â· Full infrastructure scan â€” checks macOS firewall status, FileVault encryption, open ports, SSH config, GitHub PAT expiry dates, OpenClaw version updates, and credential rotation schedule. Flags any vulnerabilities to Telegram.</div>
          </div>
          <div style="text-align:center;padding:4px 10px;border-radius:6px;background:rgba(139,92,246,0.1)">
            <div style="font-size:9px;color:var(--muted)">Model</div>
            <div style="font-size:11px;font-weight:700;color:var(--purple)">Sonnet</div>
          </div>
          <div style="text-align:center;min-width:60px">
            <div style="font-size:9px;color:var(--muted)">Status</div>
            <div style="font-size:11px;font-weight:700;color:var(--muted)">âšª Idle</div>
          </div>
          <div style="text-align:right;min-width:80px">
            <div style="font-size:9px;color:var(--muted)">Next Run</div>
            <div style="font-size:10px;font-weight:600">Mar 1</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Planned Automations -->
    <div class="card" style="margin-top:12px;background:linear-gradient(135deg,rgba(255,193,7,0.04),rgba(249,115,22,0.04))">
      <h2 style="font-size:13px;margin-bottom:10px">ğŸ”® Planned Automations (Enable When Triggered)</h2>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ“Š</span>
            <div><div style="font-size:12px;font-weight:700">Daily Ad Performance Sync</div><div style="font-size:10px;color:var(--muted)">9PM daily Â· Screenshot â†’ extract â†’ update dashboard + ad tracker</div></div>
          </div>
          <span style="font-size:10px;font-weight:700;padding:3px 10px;border-radius:6px;background:rgba(76,175,80,0.1);color:var(--green);border:1px solid rgba(76,175,80,0.2)">ğŸŸ¢ READY â€” Ads LIVE</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--green)">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ§¾</span>
            <div><div style="font-size:12px;font-weight:700">Auto-Log Recurring Expenses</div><div style="font-size:10px;color:var(--muted)">1st of month Â· Auto-enters Shopify, Claude, domains, Ad Rail fees</div></div>
          </div>
          <span style="font-size:10px;font-weight:700;padding:3px 10px;border-radius:6px;background:rgba(76,175,80,0.1);color:var(--green);border:1px solid rgba(76,175,80,0.2)">ğŸŸ¢ READY â€” Mar 1</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--amber)">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ“§</span>
            <div><div style="font-size:12px;font-weight:700">Email Sequence Automation</div><div style="font-size:10px;color:var(--muted)">Klaviyo flows Â· Welcome, abandoned cart, post-purchase</div></div>
          </div>
          <span style="font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;background:rgba(255,193,7,0.08);color:var(--amber);border:1px solid rgba(255,193,7,0.2)">â³ Trigger: First 10 orders</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ¦…</span>
            <div><div style="font-size:12px;font-weight:700">Hawk Intelligence Brief</div><div style="font-size:10px;color:var(--muted)">Weekly Â· Market trends, competitor moves, opportunity alerts</div></div>
          </div>
          <span style="font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;background:rgba(255,255,255,0.04);color:var(--muted);border:1px solid var(--border)">âšª Trigger: Hawk hired (Phase 2)</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:10px;border-left:3px solid var(--muted)">
          <div style="display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ›¡ï¸</span>
            <div><div style="font-size:12px;font-weight:700">QC Agent Auto-Review</div><div style="font-size:10px;color:var(--muted)">Every output Â· Independent quality check before delivery</div></div>
          </div>
          <span style="font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;background:rgba(255,255,255,0.04);color:var(--muted);border:1px solid var(--border)">âšª Trigger: 4+ agents active</span>
        </div>
      </div>
    </div>

    <!-- Model Routing Strategy -->
    <div class="card" style="margin-top:12px;background:linear-gradient(135deg,rgba(124,58,237,.03),rgba(59,130,246,.03))">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <span style="font-size:18px">âš¡</span>
        <div>
          <h2 style="font-size:14px;margin:0;font-weight:700">Model Routing Strategy</h2>
          <div style="font-size:10px;color:var(--muted)">Forge dynamically routes each task to the right model â€” quality where it matters, efficiency everywhere else</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div style="background:rgba(255,193,7,0.06);border:1px solid rgba(255,193,7,0.15);border-radius:10px;padding:12px">
          <div style="font-size:12px;font-weight:800;color:var(--amber);margin-bottom:8px">ğŸŸ£ Opus â€” Deep Work</div>
          <div style="font-size:10px;color:var(--muted);line-height:1.8">
            â€¢ Live chat with Anton<br>
            â€¢ App/tool building (multi-file)<br>
            â€¢ SOP writing (long-form, nuanced)<br>
            â€¢ QC reviews (needs deep reasoning)<br>
            â€¢ Ad strategy & kill/scale decisions<br>
            â€¢ Copywriting (brand voice critical)
          </div>
        </div>
        <div style="background:rgba(139,92,246,0.06);border:1px solid rgba(139,92,246,0.15);border-radius:10px;padding:12px">
          <div style="font-size:12px;font-weight:800;color:var(--purple);margin-bottom:8px">ğŸ”µ Sonnet â€” Structured Tasks</div>
          <div style="font-size:10px;color:var(--muted);line-height:1.8">
            â€¢ Product research pipeline (cron)<br>
            â€¢ Memory maintenance (file ops)<br>
            â€¢ Daily briefings (templated)<br>
            â€¢ Dashboard refresh (data updates)<br>
            â€¢ Security audits (checklist-based)<br>
            â€¢ Data entry / git operations
          </div>
        </div>
      </div>
      <div style="padding:8px 12px;background:var(--bg);border-radius:8px;font-size:10px;color:var(--muted);display:flex;align-items:center;gap:8px">
        <span style="font-size:14px">ğŸ’¡</span>
        <span><strong style="color:var(--text)">Why:</strong> Anton is on Claude Max subscription (flat fee, usage allowance). Opus for live chat preserves quality where it matters. Sonnet for crons saves allowance. No silent downgrades â€” Anton always knows which model is running.</span>
      </div>
    </div>

    <!-- Legacy table hidden -->
    <div style="display:none">
      <table style="font-size:11px">
        <thead><tr><th>Task Type</th><th>Model</th><th>Why</th></tr></thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== AI ENGINE MONITOR ===== -->
  <div class="page" id="p-engine">
    <div class="grid g2">
      <div class="card" style="grid-column:1/-1">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
          <span style="font-size:18px">âš¡</span>
          <div>
            <h2 style="margin:0;font-size:16px">AI Engine Monitor</h2>
            <div style="font-size:10px;color:var(--muted)">Live model status, usage tracking, and efficiency metrics</div>
          </div>
        </div>
        <div id="engine-status">Loading...</div>
      </div>
      <div class="card">
        <h3 style="font-size:13px;margin:0 0 12px">ğŸ“Š Model Routing Policy</h3>
        <div style="font-size:10px;line-height:1.8;color:var(--muted)">
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ’¬ Live chat with Anton</span><span style="color:var(--green);font-weight:700">OPUS</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ” Product research (cron)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ§  Memory maintenance (cron)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ”’ Security audit (cron)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ“Š Dashboard refresh (cron)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ—ï¸ App/tool building</span><span style="color:var(--green);font-weight:700">OPUS</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>ğŸ“ SOP writing</span><span style="color:var(--green);font-weight:700">OPUS</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)"><span>âœï¸ Copywriting (Quill)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
          <div style="display:flex;justify-content:space-between;padding:4px 0"><span>ğŸ¤– Sub-agents (default)</span><span style="color:var(--blue);font-weight:700">SONNET</span></div>
        </div>
        <div style="margin-top:10px;padding:8px;border-radius:6px;background:rgba(124,58,237,.06);border:1px solid rgba(124,58,237,.15);font-size:9px;color:var(--muted)">
          Strategy: Opus reserved for human-facing interactions & complex builds. Sonnet handles all automated/background work to preserve Opus allowance.
        </div>
      </div>
      <div class="card">
        <h3 style="font-size:13px;margin:0 0 12px">ğŸ”„ Failover Chain</h3>
        <div style="font-size:10px;line-height:2;color:var(--muted)">
          <div style="display:flex;align-items:center;gap:8px;padding:4px 0;border-bottom:1px solid var(--border)">
            <span style="background:var(--green);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:4px">PRIMARY</span>
            <span>Claude Opus 4.6 (Anthropic)</span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;padding:4px 0;border-bottom:1px solid var(--border)">
            <span style="background:var(--amber);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:4px">FALLBACK</span>
            <span>Claude Sonnet (Anthropic)</span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;padding:4px 0">
            <span style="background:var(--red);color:#fff;font-size:8px;font-weight:700;padding:2px 6px;border-radius:4px">EMERGENCY</span>
            <span>Manual token swap (saved in Keychain)</span>
          </div>
        </div>
        <div style="margin-top:12px">
          <h4 style="font-size:11px;margin:0 0 8px;color:var(--accent2)">âš ï¸ Alerts & Reminders</h4>
          <div id="engine-alerts" style="font-size:10px;color:var(--muted);line-height:1.6">Loading...</div>
        </div>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="font-size:13px;margin:0 0 12px">ğŸ“ˆ Session History</h3>
      <div id="engine-history" style="font-size:10px;color:var(--muted)">Loading...</div>
    </div>
  </div>

  <!-- ===== CALENDAR ===== -->
  <div class="page" id="p-calendar">
    <div class="grid" style="grid-template-columns:1fr 320px;gap:12px">
      <!-- Calendar Grid -->
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:18px">ğŸ“…</span>
            <h2 style="margin:0;font-size:16px">Anton's Calendar</h2>
          </div>
          <div style="display:flex;gap:6px;align-items:center">
            <button onclick="calNav(-1)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 10px;color:var(--text);cursor:pointer;font-family:inherit">â—€</button>
            <span id="cal-month" style="font-size:13px;font-weight:700;min-width:140px;text-align:center"></span>
            <button onclick="calNav(1)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 10px;color:var(--text);cursor:pointer;font-family:inherit">â–¶</button>
            <button onclick="calToday()" style="background:var(--accent);color:#fff;border:none;border-radius:4px;padding:4px 10px;font-size:10px;cursor:pointer;font-family:inherit">Today</button>
          </div>
        </div>
        <div id="cal-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px"></div>
      </div>

      <!-- Day Detail + Add Event -->
      <div>
        <div class="card" style="margin-bottom:12px">
          <h3 style="font-size:13px;margin:0 0 10px">ğŸ“‹ <span id="cal-day-title">Select a Day</span></h3>
          <div id="cal-day-events" style="font-size:10px;color:var(--muted);line-height:1.6">Click a day to see events</div>
        </div>
        <div class="card" style="margin-bottom:12px">
          <h3 style="font-size:13px;margin:0 0 10px">â• Add Event</h3>
          <div style="display:flex;flex-direction:column;gap:6px;font-size:10px">
            <input id="cal-new-date" type="date" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 8px;color:var(--text);font-family:inherit;font-size:10px">
            <input id="cal-new-time" type="time" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 8px;color:var(--text);font-family:inherit;font-size:10px">
            <input id="cal-new-title" type="text" placeholder="Event title..." style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 8px;color:var(--text);font-family:inherit;font-size:10px">
            <select id="cal-new-cat" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 8px;color:var(--text);font-family:inherit;font-size:10px">
              <option value="business">ğŸ¢ Business</option>
              <option value="health">ğŸ’ª Health</option>
              <option value="personal">ğŸ§˜ Personal</option>
              <option value="deadline">ğŸ”´ Deadline</option>
              <option value="reminder">ğŸ”” Reminder</option>
            </select>
            <textarea id="cal-new-notes" placeholder="Notes (optional)..." rows="2" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:4px 8px;color:var(--text);font-family:inherit;font-size:10px;resize:vertical"></textarea>
            <button onclick="calAddEvent()" style="background:var(--green);color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:10px;cursor:pointer;font-family:inherit;font-weight:600">+ Add Event</button>
          </div>
        </div>
        <div class="card">
          <h3 style="font-size:13px;margin:0 0 10px">ğŸ“Œ Upcoming</h3>
          <div id="cal-upcoming" style="font-size:10px;color:var(--muted);line-height:1.6">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Daily Routine Template -->
    <div class="card" style="margin-top:12px">
      <h3 style="font-size:13px;margin:0 0 10px">ğŸ• Daily Routine Template</h3>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:6px;font-size:10px" id="cal-routine"></div>
    </div>
  </div>

  <!-- ===== SETTINGS ===== -->
  <div class="page" id="p-settings">
    <div class="grid g2">
      <div class="card">
        <h2>âš™ï¸ Company Settings</h2>
        <div class="fg">
          <div class="fg-item"><label>Company</label><input id="s-company" value="Anton Empire"></div>
          <div class="fg-item"><label>Currency</label><select id="s-cur"><option value="$">USD ($)</option><option value="Â£">GBP (Â£)</option><option value="â‚¬">EUR (â‚¬)</option></select></div>
          <div class="fg-item"><label>Tax Rate (%)</label><input type="number" id="s-tax" value="20"></div>
          <div class="fg-item"><label>Target Margin (%)</label><input type="number" id="s-margin" value="20"></div>
          <div class="fg-item fw"><button onclick="saveSettings()">Save</button></div>
        </div>
      </div>
      <div class="card">
        <h2>ğŸ—„ Data</h2>
        <p style="font-size:11px;color:var(--muted);margin-bottom:10px">Data auto-syncs from company-data.json (maintained by Forge). Manual entries also saved locally.</p>
        <div style="display:flex;gap:5px;flex-wrap:wrap">
          <button class="btn-s btn-o" onclick="exportAll()">ğŸ“¥ CSV</button>
          <button class="btn-s btn-o" onclick="exportJSON()">ğŸ’¾ JSON</button>
          <button class="btn-s btn-o" onclick="importJSON()">ğŸ“‚ Import</button>
          <button class="btn-s btn-o" onclick="loadFromJSON()">ğŸ”„ Re-sync</button>
          <button class="btn-s btn-r" onclick="resetAll()">ğŸ—‘ Reset</button>
        </div>
        <input type="file" id="impFile" accept=".json" style="display:none" onchange="handleImport(event)">
      </div>
    </div>
  </div>

  <!-- ===== BACKUP & RECOVERY ===== -->
  <div class="page" id="p-backup">
    <div class="alert" style="background:rgba(255,77,106,.06);border:1px solid rgba(255,77,106,.2);border-radius:12px;padding:20px;margin-bottom:16px">
      <h3 style="color:#ff4d6a;margin-bottom:8px">ğŸ†˜ Emergency Recovery â€” If Forge Goes Down</h3>
      <p style="font-size:12px;color:var(--muted)">Download these files, follow the steps below, and Forge comes back online in 15 minutes. <strong>No coding knowledge needed.</strong></p>
    </div>

    <div class="grid g2">
      <div class="card">
        <h2>ğŸ“¥ Core Identity Files</h2>
        <p style="font-size:11px;color:var(--muted);margin-bottom:12px">These are Forge's brain. Download and keep a copy on your phone/laptop.</p>
        <div id="backup-files" style="display:flex;flex-direction:column;gap:6px"></div>
        <button style="margin-top:12px;width:100%" onclick="downloadAllBackup()">ğŸ“¦ Download All as ZIP</button>
      </div>
      <div class="card">
        <h2>ğŸ”— Backup Locations</h2>
        <p style="font-size:11px;color:var(--muted);margin-bottom:12px">Forge exists in 3 places. If one dies, use another.</p>
        <table>
          <tr><td>ğŸŸ¢ <strong>GitHub (Primary)</strong></td><td><a href="https://github.com/AntonUrso2811/forge-workspace" style="color:var(--accent2)" target="_blank">forge-workspace</a></td></tr>
          <tr><td>ğŸŸ¢ <strong>GitHub (Tools)</strong></td><td><a href="https://github.com/AntonUrso2811/thalyve-tools" style="color:var(--accent2)" target="_blank">thalyve-tools</a></td></tr>
          <tr><td>ğŸŸ¢ <strong>Mac (Live)</strong></td><td><code>~/.openclaw/workspace/</code></td></tr>
          <tr><td>ğŸŸ¡ <strong>This Page</strong></td><td>Download files above â†‘</td></tr>
        </table>
        <p style="font-size:10px;color:var(--muted);margin-top:8px">Auto-backup runs every 6 hours â†’ GitHub. Last backup check the <a href="https://github.com/AntonUrso2811/forge-workspace/commits/main" style="color:var(--accent2)" target="_blank">commit history</a>.</p>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h2>ğŸ”§ Step-by-Step Recovery (Dummified)</h2>
      <div style="font-size:12px;line-height:1.8">
        <p><strong style="color:var(--accent2)">Scenario 1: Forge not responding but Mac is on</strong></p>
        <ol style="margin-left:16px;margin-bottom:16px">
          <li>Open <strong>Terminal</strong> (Cmd+Space â†’ type "Terminal" â†’ Enter)</li>
          <li>Paste: <code style="background:var(--bg);padding:2px 8px;border-radius:4px">openclaw gateway restart</code> â†’ press Enter</li>
          <li>Wait 30 seconds â†’ send message on Telegram</li>
          <li>If still nothing â†’ type <code>/restart</code> in Telegram</li>
        </ol>

        <p><strong style="color:var(--accent2)">Scenario 2: "Provider in cooldown" error</strong></p>
        <ol style="margin-left:16px;margin-bottom:16px">
          <li>In Terminal: <code style="background:var(--bg);padding:2px 8px;border-radius:4px">openclaw gateway stop</code></li>
          <li>Then: <code style="background:var(--bg);padding:2px 8px;border-radius:4px">nano ~/.openclaw/auth-profiles.json</code></li>
          <li>Find <code>cooldownUntil</code> â†’ delete that line</li>
          <li>Find <code>errorCount</code> â†’ change to <code>0</code></li>
          <li>Save: <strong>Ctrl+O â†’ Enter â†’ Ctrl+X</strong></li>
          <li>Then: <code style="background:var(--bg);padding:2px 8px;border-radius:4px">openclaw gateway start</code></li>
        </ol>

        <p><strong style="color:var(--accent2)">Scenario 3: Everything is broken â€” full rebuild</strong></p>
        <ol style="margin-left:16px;margin-bottom:16px">
          <li><code style="background:var(--bg);padding:2px 8px;border-radius:4px">npm uninstall -g openclaw</code></li>
          <li><code style="background:var(--bg);padding:2px 8px;border-radius:4px">npm install -g openclaw</code></li>
          <li><code style="background:var(--bg);padding:2px 8px;border-radius:4px">openclaw onboard</code> â†’ follow the wizard</li>
          <li><code style="background:var(--bg);padding:2px 8px;border-radius:4px">cd ~/.openclaw && git clone https://github.com/AntonUrso2811/forge-workspace.git workspace</code></li>
          <li><code style="background:var(--bg);padding:2px 8px;border-radius:4px">openclaw gateway start</code></li>
          <li>Forge is back. All memory restored. ~15 minutes total.</li>
        </ol>

        <p><strong style="color:var(--accent2)">Scenario 4: Forge responds but lost memory</strong></p>
        <ol style="margin-left:16px;margin-bottom:16px">
          <li>Tell Forge: <em>"Read SOUL.md, USER.md, MEMORY.md, and memory/2026-02-26.md"</em></li>
          <li>Forge reloads everything from files. Full context restored.</li>
        </ol>

        <p><strong style="color:var(--accent2)">Scenario 5: Usage cap hit â€” Forge goes silent</strong></p>
        <ol style="margin-left:16px;margin-bottom:16px">
          <li>Check: <a href="https://console.anthropic.com" style="color:var(--accent2)" target="_blank">console.anthropic.com</a></li>
          <li>If usage is at limit â†’ wait for reset OR upgrade plan</li>
          <li>This is NOT a bug â€” just the subscription allowance running out</li>
        </ol>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h2>ğŸ“‹ Incident Log</h2>
      <table>
        <tr><th>Date</th><th>Issue</th><th>Cause</th><th>Fix</th></tr>
        <tr><td>Feb 25</td><td>Gateway crash loop + workspace wiped</td><td>OAuth 403 â†’ cooldown loop</td><td>Reinstall + rebuild from Telegram</td></tr>
        <tr><td>Feb 25</td><td>Telegram not receiving replies</td><td>Webchat hijacking routing</td><td>Close webchat tabs + dmScope fix</td></tr>
        <tr><td>Feb 26</td><td>"Typing" but no response</td><td>Session too long (20+ voice notes)</td><td>/restart in Telegram</td></tr>
      </table>
      <p style="font-size:10px;color:var(--muted);margin-top:8px">This log is updated by Forge every time an incident occurs.</p>
    </div>
  </div>

  <div class="wm">ğŸ”± Anton Empire Command Centre v3.2 â€¢ Data: company-data.json (Forge-maintained) + local edits â€¢ Built by Forge</div>
</div>
<div class="toast" id="toast"></div>

<script>
const D={
  company: JSON.parse(localStorage.getItem('ae2_company')||'{"name":"Anton Empire","currency":"$","taxRate":20,"targetNetMargin":20}'),
  companyExpenses: JSON.parse(localStorage.getItem('ae2_companyExpenses')||'[]'),
  brands: JSON.parse(localStorage.getItem('ae2_brands')||'[]'),
  daily: JSON.parse(localStorage.getItem('ae2_daily')||'[]')
};
function sv(k){if(k)localStorage.setItem('ae2_'+k,JSON.stringify(D[k]));else['company','companyExpenses','brands','daily'].forEach(k=>localStorage.setItem('ae2_'+k,JSON.stringify(D[k])))}

function nav(id,el){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById('p-'+id).classList.add('active');el.classList.add('active');history.replaceState(null,null,'#'+id)}
// Restore tab from URL hash on load
(function(){const h=location.hash.replace('#','');if(h){const page=document.getElementById('p-'+h);if(page){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));page.classList.add('active');const tabs=document.querySelectorAll('.tab');tabs.forEach(t=>{if(t.getAttribute('onclick')&&t.getAttribute('onclick').includes("'"+h+"'"))t.classList.add('active');});}}})();

// ===== EXPENSES =====
function addExpense(){
  const n=document.getElementById('e-name').value.trim();const a=parseFloat(document.getElementById('e-amt').value)||0;
  if(!n||!a){toast('Fill name & amount',1);return}
  D.companyExpenses.push({id:Date.now().toString(36),name:n,category:document.getElementById('e-cat').value,amount:a,frequency:document.getElementById('e-freq').value,date:document.getElementById('e-date').value||new Date().toISOString().split('T')[0],notes:document.getElementById('e-notes').value});
  sv('companyExpenses');render();document.getElementById('e-name').value='';document.getElementById('e-amt').value='';document.getElementById('e-notes').value='';toast('Expense added');
}
function delExp(id){D.companyExpenses=D.companyExpenses.filter(e=>e.id!==id);sv('companyExpenses');render()}

// ===== DAILY =====
function addDaily(){
  const date=document.getElementById('d-date').value;if(!date){toast('Pick date',1);return}
  const brandId=document.getElementById('d-brand').value;
  const prodId=document.getElementById('d-prod').value;
  const orders=parseInt(document.getElementById('d-orders').value)||0;
  const adSpend=parseFloat(document.getElementById('d-ads').value)||0;
  const brand=D.brands.find(b=>b.id===brandId);
  const prod=brand?brand.products.find(p=>p.id===prodId):null;
  let rev=parseFloat(document.getElementById('d-rev').value);
  if(isNaN(rev)&&prod)rev=prod.price*orders;else if(isNaN(rev))rev=0;
  const cogs=prod?(prod.cogs+prod.shipping)*orders:0;
  D.daily.push({id:Date.now().toString(36),date,brandId,brandName:brand?brand.name:'?',productId:prodId,productName:prod?prod.name:'?',orders,revenue:rev,adSpend,cogs});
  D.daily.sort((a,b)=>a.date.localeCompare(b.date));
  sv('daily');render();
  document.getElementById('d-orders').value='0';document.getElementById('d-ads').value='0';document.getElementById('d-rev').value='';
  toast('Entry added');
}
function delDaily(id){D.daily=D.daily.filter(e=>e.id!==id);sv('daily');render()}

// ===== SETTINGS =====
function saveSettings(){
  D.company={name:document.getElementById('s-company').value,currency:document.getElementById('s-cur').value,taxRate:parseFloat(document.getElementById('s-tax').value)||20,targetNetMargin:parseFloat(document.getElementById('s-margin').value)||20};
  sv('company');render();toast('Saved');
}

// ===== RENDER =====
// Period filter state
let _period = 'all';
function setPeriod(p, btn) {
  _period = p;
  if (btn) {
    document.querySelectorAll('.pfb').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  render();
}
function getFilteredDaily() {
  const now = new Date();
  const todayStr = now.toISOString().slice(0, 10);
  let from = null, to = null;
  const labels = { today: 'Today', '7d': 'Last 7 Days', '30d': 'Last 30 Days', mtd: 'This Month', qtd: 'This Quarter', all: 'All Time', custom: 'Custom Range' };
  const lbl = document.getElementById('o-period-label');
  if (lbl) lbl.textContent = '(' + (labels[_period] || 'All Time') + ')';

  if (_period === 'today') {
    from = to = todayStr;
  } else if (_period === '7d') {
    const d = new Date(now); d.setDate(d.getDate() - 6);
    from = d.toISOString().slice(0, 10); to = todayStr;
  } else if (_period === '30d') {
    const d = new Date(now); d.setDate(d.getDate() - 29);
    from = d.toISOString().slice(0, 10); to = todayStr;
  } else if (_period === 'mtd') {
    from = todayStr.slice(0, 8) + '01'; to = todayStr;
  } else if (_period === 'qtd') {
    const q = Math.floor(now.getMonth() / 3) * 3;
    from = now.getFullYear() + '-' + String(q + 1).padStart(2, '0') + '-01'; to = todayStr;
  } else if (_period === 'custom') {
    from = document.getElementById('pf-from').value || null;
    to = document.getElementById('pf-to').value || null;
  }
  // 'all' â†’ return all daily but still provide from/to for expense consistency
  if (!from && !to) {
    // Derive range from earliest daily entry (or earliest expense date) to today
    let earliest = todayStr;
    D.daily.forEach(d => { if (d.date < earliest) earliest = d.date; });
    D.companyExpenses.forEach(e => { if (e.date && e.date < earliest) earliest = e.date; });
    return { daily: D.daily, from: earliest, to: todayStr };
  }
  const filtered = D.daily.filter(e => {
    if (from && e.date < from) return false;
    if (to && e.date > to) return false;
    return true;
  });
  return { daily: filtered, from, to };
}
function getFilteredExpenseTotal(from, to) {
  if (!from && !to) {
    // All time: monthly as-is, annual /12, one-time full
    const m = D.companyExpenses.filter(e => e.frequency === 'monthly').reduce((s, e) => s + e.amount, 0);
    const a = D.companyExpenses.filter(e => e.frequency === 'annual').reduce((s, e) => s + e.amount / 12, 0);
    const o = D.companyExpenses.filter(e => e.frequency === 'one-time').reduce((s, e) => s + e.amount, 0);
    return m + a + o;
  }
  const f = new Date(from + 'T00:00:00');
  const t = new Date(to + 'T23:59:59');
  const days = Math.max(1, Math.round((t - f) / 86400000) + 1);
  let total = 0;
  D.companyExpenses.forEach(e => {
    if (e.frequency === 'monthly') {
      total += e.amount * (days / 30.44); // pro-rate monthly
    } else if (e.frequency === 'annual') {
      total += e.amount * (days / 365.25); // pro-rate annual
    } else if (e.frequency === 'one-time') {
      // Only count if expense date falls in range
      if (e.date && e.date >= from && e.date <= to) total += e.amount;
      else if (!e.date) total += e.amount; // no date = include always
    }
  });
  return total;
}

function render(){
  const c=D.company.currency||'$';
  const f=n=>(n>=0?c:'-'+c)+Math.abs(n).toFixed(2);
  // Last updated indicator
  const luEl=document.getElementById('last-updated');
  if(luEl&&D.lastUpdated){const d=new Date(D.lastUpdated);const ago=Math.round((Date.now()-d.getTime())/60000);luEl.textContent=ago<60?ago+'m ago':ago<1440?Math.round(ago/60)+'h ago':Math.round(ago/1440)+'d ago';luEl.style.color=ago<120?'var(--green)':ago<720?'var(--amber)':'var(--red)';}

  // Daily totals (filtered by period)
  const _fResult=getFilteredDaily();
  const _fd=_fResult.daily;
  const _from=_fResult.from;
  const _to=_fResult.to;
  const totRev=_fd.reduce((s,e)=>s+e.revenue,0);
  const totAds=_fd.reduce((s,e)=>s+e.adSpend,0);
  const totCogs=_fd.reduce((s,e)=>s+e.cogs,0);
  const totOrders=_fd.reduce((s,e)=>s+e.orders,0);

  // Expense calcs (pro-rated to period)
  const totalOpex=getFilteredExpenseTotal(_from,_to);
  const grossProfit=totRev-totCogs;
  const preTax=grossProfit-totAds-totalOpex;
  const taxEst=preTax>0?preTax*(D.company.taxRate||20)/100:0;
  const netProfit=preTax-taxEst;
  const roas=totAds>0?totRev/totAds:0;

  // Overview KPIs
  document.getElementById('o-rev').textContent=f(totRev);
  document.getElementById('o-orders').textContent=totOrders+' orders';
  document.getElementById('o-ads').textContent=f(totAds);
  document.getElementById('o-adpct').textContent=totRev>0?(totAds/totRev*100).toFixed(1)+'% of revenue':'â€”';
  document.getElementById('o-cogs').textContent=f(totCogs);
  document.getElementById('o-cogspct').textContent=totRev>0?(totCogs/totRev*100).toFixed(1)+'% of revenue':'â€”';
  document.getElementById('o-opex').textContent=f(totalOpex);
  if(_from&&_to){const days=Math.max(1,Math.round((new Date(_to+'T23:59:59')-new Date(_from+'T00:00:00'))/86400000)+1);document.getElementById('o-opexn').textContent=(_period==='all'?'All time: ':'Pro-rated: ')+days+' day'+(days>1?'s':'');}
  else{document.getElementById('o-opexn').textContent=D.companyExpenses.length+' items (monthly)';}
  document.getElementById('o-tax').textContent=f(taxEst);
  document.getElementById('o-taxr').textContent=(D.company.taxRate||20)+'% of pre-tax profit';
  const onEl=document.getElementById('o-net');onEl.textContent=f(netProfit);onEl.className='sv '+(netProfit>=0?'green':'red');
  document.getElementById('o-netm').textContent=totRev>0?(netProfit/totRev*100).toFixed(1)+'% net margin':'â€”';
  document.getElementById('o-netm').className='ss '+(netProfit>=0?'green':'red');

  // P&L
  document.getElementById('pl-rev').textContent=f(totRev);
  document.getElementById('pl-cogs').textContent=f(totCogs);
  document.getElementById('pl-gross').textContent=f(grossProfit);document.getElementById('pl-gross').className='pl-sep '+(grossProfit>=0?'green':'red');
  document.getElementById('pl-ads').textContent=f(totAds);
  // Itemized expense breakdown in P&L
  const plItems=document.getElementById('pl-opex-items');
  if(plItems){
    const periodDays=(_from&&_to)?Math.max(1,Math.round((new Date(_to+'T23:59:59')-new Date(_from+'T00:00:00'))/86400000)+1):30;
    plItems.innerHTML=D.companyExpenses.filter(e=>e.amount!==0).map(e=>{
      let amt=0;
      if(e.frequency==='monthly')amt=e.amount*(periodDays/30.44);
      else if(e.frequency==='annual')amt=e.amount*(periodDays/365.25);
      else amt=e.amount; // one-time
      const vFlag=e.verified?'':'<span title="Unverified â€” tell Forge the real amount" style="color:var(--amber)">*</span>';
      const freq=e.frequency==='monthly'?'/mo':e.frequency==='annual'?'/yr':'one-time';
      return'<div style="display:flex;justify-content:space-between;font-size:10px;padding:1px 0"><span style="color:var(--muted)">'+e.name+' <span style="opacity:.5">('+freq+')</span> '+vFlag+'</span><span class="red">'+f(Math.abs(amt))+'</span></div>';
    }).join('');
  }
  document.getElementById('pl-opex').textContent=f(totalOpex);
  document.getElementById('pl-pretax').textContent=f(preTax);document.getElementById('pl-pretax').className='pl-sep '+(preTax>=0?'green':'red');
  document.getElementById('pl-tax').textContent=f(taxEst);
  const plN=document.getElementById('pl-net');plN.textContent=f(netProfit);plN.className='pl-total '+(netProfit>=0?'green':'red');
  const monthlyBurn=getFilteredExpenseTotal(null,null);
  const qsBurn=document.getElementById('qs-burn');if(qsBurn)qsBurn.textContent='$'+monthlyBurn.toFixed(0)+'/mo';
  const qsRun=document.getElementById('qs-runway');if(qsRun){const months=monthlyBurn>0?Math.floor(5000/monthlyBurn*0.77):99;qsRun.textContent=months>12?'12+ months':months+' months';}

  // Brand summary table
  const obr=document.getElementById('o-brands');
  if(D.brands.length===0){obr.innerHTML='<tr><td colspan="8" class="empty">No brands</td></tr>';}
  else{
    obr.innerHTML=D.brands.map(b=>{
      const bd=_fd.filter(d=>d.brandId===b.id);
      const br=bd.reduce((s,d)=>s+d.revenue,0),bo=bd.reduce((s,d)=>s+d.orders,0),ba=bd.reduce((s,d)=>s+d.adSpend,0),bc=bd.reduce((s,d)=>s+d.cogs,0);
      const bp=br-ba-bc,bm=br>0?(bp/br*100).toFixed(1):'0',broas=ba>0?(br/ba).toFixed(2):'â€”';
      return`<tr><td><strong>${b.name}</strong></td><td class="green">${f(br)}</td><td>${bo}</td><td class="red">${f(ba)}</td><td>${f(bc)}</td><td class="${bp>=0?'green':'red'}">${f(bp)}</td><td>${broas}x</td><td class="${parseFloat(bm)>=0?'green':'red'}">${bm}%</td></tr>`;
    }).join('');
  }

  // 7-day chart (filtered)
  const dates=[...new Set(_fd.map(d=>d.date))].sort().slice(-7);
  const oc=document.getElementById('o-chart');
  if(!dates.length){oc.innerHTML='<div class="empty">Add daily entries to see trends</div>';}
  else{
    const dd=dates.map(dt=>{const e=_fd.filter(d=>d.date===dt);return{date:dt,rev:e.reduce((s,d)=>s+d.revenue,0),prof:e.reduce((s,d)=>s+(d.revenue-d.adSpend-d.cogs),0)};});
    const mx=Math.max(...dd.map(d=>d.rev),1);
    oc.innerHTML=dd.map(d=>{const dt=new Date(d.date+'T12:00:00');const l=dt.toLocaleDateString('en-GB',{day:'numeric',month:'short'});return`<div class="chart-row"><div class="chart-lbl">${l}</div><div class="chart-bg"><div class="chart-bar" style="width:${(d.rev/mx*100).toFixed(1)}%;background:linear-gradient(90deg,var(--accent),var(--accent2))">${f(d.rev)}</div></div><div style="width:50px;text-align:right;font-size:10px;font-weight:600" class="${d.prof>=0?'green':'red'}">${d.prof>=0?'+':''}${f(d.prof)}</div></div>`;}).join('');
  }

  // ===== EXPENSE BREAKDOWN CHART =====
  const ecEl=document.getElementById('o-expense-chart');
  if(D.companyExpenses.length){
    const cats={};D.companyExpenses.forEach(e=>{const c=e.category||'Other';if(!cats[c])cats[c]=0;cats[c]+=e.frequency==='annual'?e.amount/12:e.amount;});
    const catArr=Object.entries(cats).sort((a,b)=>b[1]-a[1]);
    const mxE=Math.max(...catArr.map(c=>c[1]),1);
    const catColors={'Subscriptions':'var(--purple)','AI/API Costs':'var(--blue)','Domain/Hosting':'var(--teal)','Media Buying':'var(--red)','Software/Tools':'var(--amber)','Other':'var(--muted)'};
    ecEl.innerHTML=catArr.map(([cat,amt])=>{
      const col=catColors[cat]||'var(--accent)';
      return`<div class="chart-row"><div class="chart-lbl" style="min-width:100px">${cat}</div><div class="chart-bg"><div class="chart-bar" style="width:${(amt/mxE*100).toFixed(1)}%;background:${col}">${f(amt)}/mo</div></div></div>`;
    }).join('')+'<div style="text-align:right;font-size:10px;color:var(--muted);margin-top:6px">Total: <strong style="color:var(--red)">'+f(getFilteredExpenseTotal(null,null))+'/mo</strong></div>';
  }else{ecEl.innerHTML='<div class="empty">No expenses logged</div>';}

  // ===== FINANCIAL ADVISOR =====
  const faGM=document.getElementById('fa-gm');
  const faNM=document.getElementById('fa-nm');
  const faAR=document.getElementById('fa-ar');
  const faOR=document.getElementById('fa-or');
  const faPT=document.getElementById('fa-pretax');
  const faTX=document.getElementById('fa-tax');
  const faDR=document.getElementById('fa-draw');
  const faAdv=document.getElementById('fa-advice');
  if(totRev>0){
    const gm=((totRev-totCogs)/totRev*100);
    faGM.textContent=gm.toFixed(1)+'%';faGM.style.color=gm>=60?'var(--green)':gm>=40?'var(--amber)':'var(--red)';
    const nm=(netProfit/totRev*100);
    faNM.textContent=nm.toFixed(1)+'%';faNM.style.color=nm>=20?'var(--green)':nm>=10?'var(--amber)':'var(--red)';
    const ar=(totAds/totRev*100);
    faAR.textContent=ar.toFixed(1)+'%';faAR.style.color=ar<=40?'var(--green)':ar<=60?'var(--amber)':'var(--red)';
    const or=(totalOpex/totRev*100);
    faOR.textContent=or.toFixed(1)+'%';faOR.style.color=or<=10?'var(--green)':or<=20?'var(--amber)':'var(--red)';
    faPT.textContent=f(preTax);faPT.style.color=preTax>=0?'var(--text)':'var(--red)';
    faTX.textContent=f(taxEst);
    const draw=netProfit>0?netProfit*0.11:0;
    faDR.textContent=f(netProfit>0?netProfit:0);
    // Advice
    const advParts=[];
    if(nm>=20)advParts.push('âœ… Net margin is healthy ('+nm.toFixed(1)+'%). You\'re in the zone.');
    else if(nm>=10)advParts.push('âš ï¸ Net margin is '+nm.toFixed(1)+'% â€” aim for 20%+ by cutting CPA or increasing AOV.');
    else advParts.push('ğŸ”´ Net margin is low ('+nm.toFixed(1)+'%). Focus on reducing ad spend or increasing conversion rate.');
    if(ar>50)advParts.push('ğŸ”´ Ad spend is '+ar.toFixed(0)+'% of revenue â€” too high. Need better ROAS or cut underperformers.');
    if(netProfit>0)advParts.push('ğŸ’· At current rate, you can draw ~'+f(draw)+'/mo (11% of net profit). Reinvest the rest for growth.');
    else advParts.push('ğŸ’· Not profitable yet â€” reinvest everything until ROAS exceeds 1.31Ã—.');
    faAdv.innerHTML=advParts.join('<br>');
  }else{
    faGM.textContent='â€”';faNM.textContent='â€”';faAR.textContent='â€”';faOR.textContent='â€”';
    faPT.textContent=f(preTax);faTX.textContent=f(taxEst);faDR.textContent='$0';
    faAdv.innerHTML='ğŸ“Š No revenue yet â€” ratios calculate once sales data flows in. Currently tracking: <strong style="color:var(--red)">'+f(totAds)+'</strong> ad spend + <strong style="color:var(--blue)">'+f(totalOpex)+'</strong> expenses = <strong style="color:var(--red)">'+f(totAds+totalOpex)+'</strong> total costs.';
  }

  // ===== 30-DAY FORECAST =====
  const fcEl=document.getElementById('fa-forecast');
  if(fcEl){
    const daysData=_fd.length;
    const daySpan=daysData>1?Math.max(1,Math.round((new Date(_fd[_fd.length-1].date+'T12:00:00')-new Date(_fd[0].date+'T12:00:00'))/86400000)+1):1;
    const dailyRev=daySpan>0?totRev/daySpan:0;
    const dailyAds=daySpan>0?totAds/daySpan:0;
    const dailyCogs=daySpan>0?totCogs/daySpan:0;
    const dailyOrders=daySpan>0?totOrders/daySpan:0;
    const monthlyExpenses=getFilteredExpenseTotal(null,null); // true monthly
    const fc30Rev=dailyRev*30;
    const fc30Ads=dailyAds*30;
    const fc30Cogs=dailyCogs*30;
    const fc30Gross=fc30Rev-fc30Cogs;
    const fc30Net=fc30Gross-fc30Ads-monthlyExpenses;
    const fc30Tax=fc30Net>0?fc30Net*(D.company.taxRate||20)/100:0;
    const fc30After=fc30Net-fc30Tax;
    const rows=[
      {l:'ğŸ“ˆ Projected Revenue',v:f(fc30Rev),cls:fc30Rev>0?'green':'muted'},
      {l:'ğŸ›’ Projected Orders',v:Math.round(dailyOrders*30)+' orders',cls:'muted'},
      {l:'ğŸ“¦ Projected COGS',v:f(fc30Cogs),cls:'red'},
      {l:'ğŸ“£ Projected Ad Spend',v:f(fc30Ads),cls:'red'},
      {l:'ğŸ¢ Monthly Expenses',v:f(monthlyExpenses),cls:'red'},
      {l:'<strong>Projected Gross Profit</strong>',v:'<strong>'+f(fc30Gross)+'</strong>',cls:fc30Gross>=0?'green':'red'},
      {l:'<strong>Projected Net (after tax)</strong>',v:'<strong>'+f(fc30After)+'</strong>',cls:fc30After>=0?'green':'red'},
    ];
    const brkEvenRev=fc30Ads+monthlyExpenses+fc30Cogs;
    const brkEvenDaily=brkEvenRev/30;
    rows.push({l:'ğŸ¯ Break-Even Revenue',v:f(brkEvenRev)+'/mo ('+f(brkEvenDaily)+'/day)',cls:'amber'});
    if(daysData<3)rows.push({l:'âš ï¸',v:'<em>Low data ('+daysData+' day'+(daysData>1?'s':'')+') â€” forecast accuracy improves with more data</em>',cls:'muted'});
    fcEl.innerHTML='<table style="width:100%;border-collapse:collapse">'+rows.map(r=>'<tr><td style="padding:3px 0">'+r.l+'</td><td style="padding:3px 0;text-align:right;font-weight:600" class="'+r.cls+'">'+r.v+'</td></tr>').join('')+'</table>';
  }

  // Show expense warning if any expenses lack 'verified' flag
  const ewEl=document.getElementById('fa-expense-warn');
  if(ewEl){const hasUnverified=D.companyExpenses.some(e=>!e.verified);ewEl.style.display=hasUnverified?'block':'none';}

  // ===== BRAND PAGE (THALYVE) =====
  const tb=D.brands.find(b=>b.id==='thalyve');
  if(tb){
    const td=D.daily.filter(d=>d.brandId==='thalyve');
    const tr=td.reduce((s,d)=>s+d.revenue,0),to=td.reduce((s,d)=>s+d.orders,0),ta=td.reduce((s,d)=>s+d.adSpend,0),tc=td.reduce((s,d)=>s+d.cogs,0);
    const tp=tr-ta-tc;
    document.getElementById('b-rev').textContent=f(tr);document.getElementById('b-orders').textContent=to+' orders';
    document.getElementById('b-ads').textContent=f(ta);
    document.getElementById('b-cogs').textContent=f(tc);
    const bpEl=document.getElementById('b-profit');bpEl.textContent=f(tp);bpEl.className='sv '+(tp>=0?'green':'red');
    document.getElementById('b-margin').textContent=tr>0?(tp/tr*100).toFixed(1)+'% margin':'â€”';
    document.getElementById('b-margin').className='ss '+(tp>=0?'green':'red');
    const br=ta>0?(tr/ta):0;document.getElementById('b-roas').textContent=br.toFixed(2)+'x';
    document.getElementById('b-roast').textContent=br>=2?'ğŸŸ¢ Strong':br>=1?'ğŸŸ¡ Break-even':td.length?'ğŸ”´ Below BE':'â€”';
    const bcpa=to>0?ta/to:0;document.getElementById('b-cpa').textContent=f(bcpa);
    document.getElementById('b-cpat').textContent=bcpa>0?(bcpa<20?'ğŸŸ¢ Strong':bcpa<30?'ğŸŸ¡ Watch':'ğŸ”´ High'):'â€”';
    document.getElementById('b-adleft').textContent=f(1000-ta);

    // Product cards
    const bpt=document.getElementById('b-prods');
    const bpc=document.getElementById('b-prods-cards');
    bpt.innerHTML=tb.products.map(p=>{
      const fee=p.price*p.txnFee/100;const m=p.price-p.cogs-p.shipping-fee;const pct=p.price>0?(m/p.price*100):0;
      const pd=td.filter(d=>d.productId===p.id);const po=pd.reduce((s,d)=>s+d.orders,0);const pr=pd.reduce((s,d)=>s+d.revenue,0);
      return`<tr><td>${p.name}<br><span style="color:var(--muted);font-size:9px">${p.sku}</span></td><td>${c}${p.price}</td><td>${c}${p.cogs}</td><td class="${pct>=0?'green':'red'}">${pct.toFixed(1)}%</td><td class="amber">${f(m)}</td><td>${po}</td><td class="green">${f(pr)}</td></tr>`;
    }).join('');
    if(bpc){
      bpc.innerHTML=tb.products.map(p=>{
        const fee=p.price*p.txnFee/100;const m=p.price-p.cogs-p.shipping-fee;const pct=p.price>0?(m/p.price*100):0;
        const pd=td.filter(d=>d.productId===p.id);const po=pd.reduce((s,d)=>s+d.orders,0);const pr=pd.reduce((s,d)=>s+d.revenue,0);
        const marginColor=pct>=70?'var(--green)':pct>=50?'var(--amber)':'var(--red)';
        return`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--bg);border-radius:8px;margin-bottom:6px">
          <div style="flex:1">
            <div style="font-size:12px;font-weight:700">${p.name}</div>
            <div style="font-size:9px;color:var(--muted)">${p.sku}</div>
          </div>
          <div style="display:flex;gap:16px;align-items:center;text-align:center">
            <div><div style="font-size:12px;font-weight:700">${c}${p.price}</div><div style="font-size:8px;color:var(--muted)">PRICE</div></div>
            <div><div style="font-size:12px;font-weight:700">${c}${p.cogs}</div><div style="font-size:8px;color:var(--muted)">COGS</div></div>
            <div><div style="font-size:12px;font-weight:700;color:${marginColor}">${pct.toFixed(0)}%</div><div style="font-size:8px;color:var(--muted)">MARGIN</div></div>
            <div><div style="font-size:12px;font-weight:700;color:var(--amber)">${f(m)}</div><div style="font-size:8px;color:var(--muted)">MAX CPA</div></div>
            <div><div style="font-size:12px;font-weight:700">${po}</div><div style="font-size:8px;color:var(--muted)">ORDERS</div></div>
          </div>
        </div>`;
      }).join('');
    }

    // Brand chart
    const bc2=document.getElementById('b-chart');
    const bdates=[...new Set(td.map(d=>d.date))].sort().slice(-7);
    if(!bdates.length){bc2.innerHTML='<div class="empty">No data yet</div>';}
    else{
      const bdd=bdates.map(dt=>{const e=td.filter(d=>d.date===dt);return{date:dt,rev:e.reduce((s,d)=>s+d.revenue,0),prof:e.reduce((s,d)=>s+(d.revenue-d.adSpend-d.cogs),0)};});
      const bmx=Math.max(...bdd.map(d=>d.rev),1);
      bc2.innerHTML=bdd.map(d=>{const dt=new Date(d.date+'T12:00:00');const l=dt.toLocaleDateString('en-GB',{day:'numeric',month:'short'});return`<div class="chart-row"><div class="chart-lbl">${l}</div><div class="chart-bg"><div class="chart-bar" style="width:${(d.rev/bmx*100).toFixed(1)}%;background:linear-gradient(90deg,var(--green),var(--teal))">${f(d.rev)}</div></div><div style="width:50px;text-align:right;font-size:10px;font-weight:600" class="${d.prof>=0?'green':'red'}">${d.prof>=0?'+':''}${f(d.prof)}</div></div>`;}).join('');
    }
  }

  // ===== EXPENSES TABLE =====
  const et=document.getElementById('e-table');
  if(!D.companyExpenses.length){et.innerHTML='<tr><td colspan="6" class="empty">No expenses yet â€” add your first or let Forge auto-log recurring costs</td></tr>';}
  else{et.innerHTML=D.companyExpenses.map(e=>`<tr><td style="font-weight:600">${e.name}</td><td style="font-size:10px">${e.category}</td><td style="font-weight:700">${c}${e.amount.toFixed(2)}</td><td style="font-size:10px">${e.frequency}</td><td style="font-size:10px">${e.date||'â€”'}</td><td><button class="btn-s btn-r" onclick="delExp('${e.id}')">âœ•</button></td></tr>`).join('');}
  const eCt=document.getElementById('e-count');if(eCt)eCt.textContent=D.companyExpenses.length+' expenses';
  const eInv=document.getElementById('e-invoices');if(eInv)eInv.textContent=D.companyExpenses.filter(e=>e.invoice).length;
  document.getElementById('e-recur').textContent=f(mRecur+aRecur);
  document.getElementById('e-once').textContent=f(once);
  document.getElementById('e-burn').textContent=f(totalOpex);

  // ===== DAILY TABLE + SUMMARY =====
  const dt2=document.getElementById('d-table');
  if(!D.daily.length){dt2.innerHTML='<tr><td colspan="10" class="empty">No entries yet â€” log your first day or wait for automation ğŸš€</td></tr>';}
  else{dt2.innerHTML=D.daily.sort((a,b)=>b.date.localeCompare(a.date)).map(e=>{const p=e.revenue-e.adSpend-e.cogs;const r=e.adSpend>0?(e.revenue/e.adSpend).toFixed(2):'â€”';return`<tr><td>${new Date(e.date+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short'})}</td><td>${e.brandName}</td><td>${e.productName}</td><td>${e.orders}</td><td class="green">${f(e.revenue)}</td><td class="red">${f(e.adSpend)}</td><td>${f(e.cogs)}</td><td class="${p>=0?'green':'red'}">${f(p)}</td><td>${r}x</td><td><button class="btn-s btn-r" onclick="delDaily('${e.id}')">âœ•</button></td></tr>`;}).join('');}
  // Daily log summary cards
  const dlRev=D.daily.reduce((s,d)=>s+d.revenue,0);
  const dlAds=D.daily.reduce((s,d)=>s+d.adSpend,0);
  const dlCogs=D.daily.reduce((s,d)=>s+d.cogs,0);
  const dlOrd=D.daily.reduce((s,d)=>s+d.orders,0);
  const dlProf=dlRev-dlAds-dlCogs;
  const dlEl=id=>document.getElementById(id);
  if(dlEl('dl-rev'))dlEl('dl-rev').textContent=f(dlRev);
  if(dlEl('dl-ads'))dlEl('dl-ads').textContent=f(dlAds);
  if(dlEl('dl-profit')){dlEl('dl-profit').textContent=f(dlProf);dlEl('dl-profit').style.color=dlProf>=0?'var(--green)':'var(--red)';}
  if(dlEl('dl-roas'))dlEl('dl-roas').textContent=(dlAds>0?(dlRev/dlAds):0).toFixed(2)+'x';
  if(dlEl('dl-orders'))dlEl('dl-orders').textContent=dlOrd;
  if(dlEl('dl-count'))dlEl('dl-count').textContent=D.daily.length+' entries';
  // Daily log mini chart
  const dlChart=dlEl('dl-chart');
  if(dlChart&&D.daily.length){
    const dates=[...new Set(D.daily.map(d=>d.date))].sort().slice(-7);
    if(dlEl('dl-period'))dlEl('dl-period').textContent=dates.length>1?new Date(dates[0]+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short'})+' â€” '+new Date(dates[dates.length-1]+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short'}):'';
    const dd=dates.map(dt=>{const e=D.daily.filter(d=>d.date===dt);return{date:dt,rev:e.reduce((s,d)=>s+d.revenue,0),spend:e.reduce((s,d)=>s+d.adSpend,0),prof:e.reduce((s,d)=>s+(d.revenue-d.adSpend-d.cogs),0)};});
    const mx=Math.max(...dd.map(d=>Math.max(d.rev,d.spend)),1);
    dlChart.innerHTML=dd.map(d=>{const l=new Date(d.date+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short'});return`<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
      <div style="width:50px;font-size:10px;color:var(--muted);text-align:right;flex-shrink:0">${l}</div>
      <div style="flex:1;display:flex;flex-direction:column;gap:2px">
        <div style="height:12px;background:var(--bg);border-radius:3px;overflow:hidden"><div style="height:100%;width:${(d.rev/mx*100).toFixed(1)}%;background:linear-gradient(90deg,var(--green),var(--teal));border-radius:3px;display:flex;align-items:center;padding-left:4px;font-size:8px;font-weight:700;color:#fff">${d.rev>0?f(d.rev):''}</div></div>
        <div style="height:8px;background:var(--bg);border-radius:3px;overflow:hidden"><div style="height:100%;width:${(d.spend/mx*100).toFixed(1)}%;background:linear-gradient(90deg,var(--red),#ef4444);border-radius:3px"></div></div>
      </div>
      <div style="width:55px;text-align:right;font-size:10px;font-weight:700;flex-shrink:0" class="${d.prof>=0?'green':'red'}">${d.prof>=0?'+':''}${f(d.prof)}</div>
    </div>`;}).join('')+'<div style="display:flex;gap:12px;justify-content:center;margin-top:8px;font-size:9px;color:var(--muted)"><span>ğŸŸ¢ Revenue</span><span>ğŸ”´ Ad Spend</span><span>Â± Net Profit</span></div>';
  }

  // Dropdowns
  const bs=document.getElementById('d-brand');
  bs.innerHTML=D.brands.map(b=>`<option value="${b.id}">${b.name}</option>`).join('')||'<option>No brands</option>';
  updateProdDropdown();
}

function updateProdDropdown(){
  const bid=document.getElementById('d-brand').value;
  const b=D.brands.find(br=>br.id===bid);
  const ps=document.getElementById('d-prod');
  ps.innerHTML=b?b.products.map(p=>`<option value="${p.id}">${p.name} â€” ${D.company.currency}${p.price}</option>`).join(''):'<option>â€”</option>';
}

// ===== JSON SYNC =====
async function loadFromJSON(){
  try{
    const r=await fetch('company-data.json?t='+Date.now());if(!r.ok)return;
    const j=await r.json();
    if(j.company)D.company={...D.company,...j.company};
    if(j.companyExpenses){
      // JSON ALWAYS overrides localStorage for expenses â€” no merging
      D.companyExpenses=j.companyExpenses.map(ne=>{if(!ne.id)ne.id='json_'+ne.name.replace(/\s+/g,'_').toLowerCase();return ne;});
      localStorage.setItem('ae2_companyExpenses',JSON.stringify(D.companyExpenses));
    }
    if(j.brands&&j.brands.length){
      j.brands.forEach(nb=>{
        const ex=D.brands.find(b=>b.id===nb.id);
        if(ex){ex.products=nb.products;ex.mediaBuying=nb.mediaBuying;ex.status=nb.status;}
        else D.brands.push(nb);
        if(nb.daily&&nb.daily.length){nb.daily.forEach(nd=>{if(!D.daily.find(d=>d.id===nd.id)){nd.brandId=nb.id;nd.brandName=nb.name;D.daily.push(nd);}});}
      });
    }
    if(j.taxes)D.company.taxRate=j.taxes.estimatedRate||D.company.taxRate;
    if(j.aiEngine)D.aiEngine=j.aiEngine;
    if(j.calendar){D.calendar=j.calendar;const lsCal=JSON.parse(localStorage.getItem('calendar')||'null');if(lsCal&&lsCal.events){lsCal.events.forEach(le=>{if(!D.calendar.events.find(e=>e.id===le.id))D.calendar.events.push(le);});}}
    if(j.lastUpdated)D.lastUpdated=j.lastUpdated;
    sv();
    document.getElementById('s-company').value=D.company.name;
    document.getElementById('s-cur').value=D.company.currency;
    document.getElementById('s-tax').value=D.company.taxRate;
    document.getElementById('s-margin').value=D.company.targetNetMargin;
    document.getElementById('lastSync').textContent='Synced '+ new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
    _jsonData=j;
    // Merge localStorage task completions
    const savedTasks=JSON.parse(localStorage.getItem('ae2_criticalTasks')||'null');
    if(savedTasks&&savedTasks.date===j.dailyCriticalTasks?.date&&savedTasks.members){j.dailyCriticalTasks=savedTasks;}
    try{renderCriticalTasks(j);}catch(e){console.error('Critical Tasks:',e);}
    try{renderTeam(j);}catch(e){console.error('Team:',e);}
    try{renderKPI(j);}catch(e){console.error('KPI:',e);}
    try{renderRoadmap(j);}catch(e){console.error('Roadmap:',e);}
    try{renderTaskLog(j);}catch(e){console.error('TaskLog:',e);}
    try{renderEngine();}catch(e){console.error('Engine:',e);}
    try{renderCalendar();}catch(e){console.error('Calendar:',e);}
    render();toast('Synced from Forge');
  }catch(e){console.error('loadFromJSON error:',e);}
}

// ===== CALENDAR =====
let _calMonth=new Date().getMonth(),_calYear=new Date().getFullYear(),_calSel=new Date().toISOString().slice(0,10);
const _catIcons={business:'ğŸ¢',health:'ğŸ’ª',personal:'ğŸ§˜',deadline:'ğŸ”´',reminder:'ğŸ””'};
const _catCols={business:'var(--blue)',health:'var(--green)',personal:'var(--purple)',deadline:'var(--red)',reminder:'var(--amber)'};

function calNav(d){_calMonth+=d;if(_calMonth>11){_calMonth=0;_calYear++;}if(_calMonth<0){_calMonth=11;_calYear--;}renderCalendar();}
function calToday(){const n=new Date();_calMonth=n.getMonth();_calYear=n.getFullYear();_calSel=n.toISOString().slice(0,10);renderCalendar();}

function renderCalendar(){
  if(!D.calendar)return;
  const evts=D.calendar.events||[];
  const mNames=['January','February','March','April','May','June','July','August','September','October','November','December'];
  document.getElementById('cal-month').textContent=mNames[_calMonth]+' '+_calYear;
  
  const grid=document.getElementById('cal-grid');
  const firstDay=new Date(_calYear,_calMonth,1).getDay();
  const daysInMonth=new Date(_calYear,_calMonth+1,0).getDate();
  const todayStr=new Date().toISOString().slice(0,10);
  const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  
  let html=dayNames.map(d=>'<div style="text-align:center;font-size:9px;font-weight:700;color:var(--muted);padding:4px;text-transform:uppercase;letter-spacing:1px">'+d+'</div>').join('');
  
  for(let i=0;i<firstDay;i++)html+='<div></div>';
  
  for(let d=1;d<=daysInMonth;d++){
    const ds=_calYear+'-'+String(_calMonth+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
    const dayEvts=evts.filter(e=>e.date===ds);
    const isToday=ds===todayStr;
    const isSel=ds===_calSel;
    const hasDeadline=dayEvts.some(e=>e.category==='deadline');
    const bg=isSel?'var(--accent)':isToday?'rgba(15,214,140,.15)':'var(--bg)';
    const border=isToday?'1px solid var(--green)':isSel?'1px solid var(--accent)':'1px solid var(--border)';
    const txtCol=isSel?'#fff':'var(--text)';
    html+='<div onclick="calSelectDay(\''+ds+'\')" style="background:'+bg+';border:'+border+';border-radius:6px;padding:4px;text-align:center;cursor:pointer;min-height:42px;transition:all .15s;position:relative" onmouseover="this.style.borderColor=\'var(--accent)\'" onmouseout="this.style.borderColor=\''+(isToday?'var(--green)':isSel?'var(--accent)':'var(--border)')+'\'"><div style="font-size:11px;font-weight:'+(isToday||isSel?'700':'500')+';color:'+txtCol+'">'+d+'</div>';
    if(dayEvts.length){
      html+='<div style="display:flex;gap:1px;justify-content:center;margin-top:2px;flex-wrap:wrap">'+dayEvts.slice(0,3).map(e=>'<div style="width:5px;height:5px;border-radius:50%;background:'+(_catCols[e.category]||'var(--muted)')+'"></div>').join('')+(dayEvts.length>3?'<div style="font-size:6px;color:var(--muted)">+</div>':'')+'</div>';
    }
    html+='</div>';
  }
  grid.innerHTML=html;
  calSelectDay(_calSel);
  renderUpcoming();
  renderRoutine();
}

function calSelectDay(ds){
  _calSel=ds;
  const evts=(D.calendar.events||[]).filter(e=>e.date===ds);
  const d=new Date(ds+'T12:00:00');
  document.getElementById('cal-day-title').textContent=d.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('cal-new-date').value=ds;
  const el=document.getElementById('cal-day-events');
  if(!evts.length){el.innerHTML='<div style="color:var(--muted);padding:8px 0">No events</div>';return;}
  el.innerHTML=evts.sort((a,b)=>(a.time||'').localeCompare(b.time||'')).map(e=>{
    const col=_catCols[e.category]||'var(--muted)';
    const icon=_catIcons[e.category]||'ğŸ“Œ';
    return'<div style="padding:6px;background:var(--bg);border-radius:6px;border-left:3px solid '+col+';margin-bottom:4px"><div style="display:flex;justify-content:space-between;align-items:center"><span style="font-weight:600">'+icon+' '+(e.time||'')+' '+e.title+'</span><button onclick="calDelEvent(\''+e.id+'\')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:10px">âœ•</button></div>'+(e.notes?'<div style="color:var(--muted);margin-top:2px;font-size:9px">'+e.notes+'</div>':'')+(e.done?'<span style="color:var(--green);font-size:9px">âœ… Done</span>':'')+'</div>';
  }).join('');
}

function calAddEvent(){
  if(!D.calendar)D.calendar={events:[],routine:{}};
  const dt=document.getElementById('cal-new-date').value;
  const tm=document.getElementById('cal-new-time').value;
  const ti=document.getElementById('cal-new-title').value.trim();
  if(!dt||!ti){toast('Need date + title');return;}
  D.calendar.events.push({id:'ev_'+Date.now(),date:dt,time:tm||null,title:ti,category:document.getElementById('cal-new-cat').value,notes:document.getElementById('cal-new-notes').value.trim(),done:false});
  localStorage.setItem('calendar',JSON.stringify(D.calendar));
  document.getElementById('cal-new-title').value='';
  document.getElementById('cal-new-notes').value='';
  renderCalendar();toast('Event added');
}

function calDelEvent(id){
  if(!confirm('Delete this event?'))return;
  D.calendar.events=D.calendar.events.filter(e=>e.id!==id);
  localStorage.setItem('calendar',JSON.stringify(D.calendar));
  renderCalendar();toast('Event deleted');
}

function renderUpcoming(){
  const el=document.getElementById('cal-upcoming');
  if(!D.calendar)return;
  const now=new Date().toISOString().slice(0,10);
  const upcoming=(D.calendar.events||[]).filter(e=>e.date>=now&&!e.done).sort((a,b)=>a.date.localeCompare(b.date)||((a.time||'').localeCompare(b.time||''))).slice(0,8);
  if(!upcoming.length){el.innerHTML='No upcoming events';return;}
  el.innerHTML=upcoming.map(e=>{
    const d=new Date(e.date+'T12:00:00');
    const dayDiff=Math.round((d-new Date(now+'T12:00:00'))/86400000);
    const when=dayDiff===0?'<span style="color:var(--green);font-weight:700">TODAY</span>':dayDiff===1?'<span style="color:var(--amber)">Tomorrow</span>':dayDiff<=7?'<span style="color:var(--blue)">In '+dayDiff+' days</span>':d.toLocaleDateString('en-GB',{day:'numeric',month:'short'});
    return'<div style="padding:4px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between"><span>'+(_catIcons[e.category]||'ğŸ“Œ')+' '+e.title+'</span><span>'+when+'</span></div>';
  }).join('');
}

function renderRoutine(){
  const el=document.getElementById('cal-routine');
  if(!D.calendar||!D.calendar.routine)return;
  const selDay=new Date(_calSel+'T12:00:00').getDay();
  const isRest=selDay===0||selDay===4; // Sun/Thu
  const routine=isRest?D.calendar.routine.rest:D.calendar.routine.training;
  const label=isRest?'Rest Day':'Training Day';
  if(!routine){el.innerHTML='No routine configured';return;}
  el.innerHTML='<div style="grid-column:1/-1;font-size:10px;color:var(--accent2);font-weight:700;margin-bottom:4px">'+label+' Schedule ('+_calSel+')</div>'+routine.map(r=>'<div style="background:var(--bg);border-radius:6px;padding:6px 8px;border:1px solid var(--border);display:flex;gap:8px;align-items:center"><span style="font-weight:700;color:var(--accent);min-width:40px">'+r.time+'</span><span>'+r.label+'</span></div>').join('');
}

// ===== AI ENGINE MONITOR =====
function renderEngine(){
  const e=D.aiEngine;if(!e)return;
  const c=D.company.currency||'$';
  const ctxPct=e.contextWindow>0?Math.round(e.contextUsed/e.contextWindow*100):0;
  const ctxCol=ctxPct<50?'var(--green)':ctxPct<75?'var(--amber)':'var(--red)';
  const statusCol=e.status==='operational'?'var(--green)':e.status==='degraded'?'var(--amber)':'var(--red)';
  const statusIcon=e.status==='operational'?'ğŸŸ¢':e.status==='degraded'?'ğŸŸ¡':'ğŸ”´';

  document.getElementById('engine-status').innerHTML=`
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:14px">
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Status</div>
        <div style="font-size:16px;font-weight:700;color:${statusCol}">${statusIcon} ${e.status.toUpperCase()}</div>
      </div>
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Active Model</div>
        <div style="font-size:14px;font-weight:700;color:var(--green)">${e.currentModel}</div>
        <div style="font-size:9px;color:var(--muted)">${e.provider} Â· ${e.subscription}</div>
      </div>
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Context Window</div>
        <div style="font-size:14px;font-weight:700;color:${ctxCol}">${ctxPct}%</div>
        <div style="width:100%;height:6px;background:var(--border);border-radius:3px;margin-top:4px;overflow:hidden"><div style="width:${ctxPct}%;height:100%;background:${ctxCol};border-radius:3px"></div></div>
        <div style="font-size:8px;color:var(--muted);margin-top:2px">${(e.contextUsed/1000).toFixed(0)}k / ${(e.contextWindow/1000).toFixed(0)}k tokens</div>
      </div>
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Cache Hit Rate</div>
        <div style="font-size:14px;font-weight:700;color:var(--green)">${e.cacheHitRate}%</div>
      </div>
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Compactions</div>
        <div style="font-size:14px;font-weight:700">${e.compactions}</div>
        <div style="font-size:8px;color:var(--muted)">context resets today</div>
      </div>
      <div style="background:var(--bg);border-radius:8px;padding:12px;border:1px solid var(--border);text-align:center">
        <div style="font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px">Monthly Cost</div>
        <div style="font-size:14px;font-weight:700">$${e.monthlyFee}</div>
        <div style="font-size:8px;color:var(--muted)">flat subscription</div>
      </div>
    </div>`;

  // Alerts
  const aEl=document.getElementById('engine-alerts');
  if(aEl&&e.alerts){
    const icons={info:'â„¹ï¸',warning:'âš ï¸',reminder:'ğŸ””',critical:'ğŸš¨'};
    const cols={info:'var(--blue)',warning:'var(--amber)',reminder:'var(--accent2)',critical:'var(--red)'};
    aEl.innerHTML=e.alerts.map(a=>`<div style="padding:4px 0;border-bottom:1px solid var(--border);display:flex;gap:6px"><span>${icons[a.type]||'â„¹ï¸'}</span><span style="color:${cols[a.type]||'var(--muted)'}">${a.message}</span></div>`).join('');
  }

  // History
  const hEl=document.getElementById('engine-history');
  if(hEl&&e.history){
    hEl.innerHTML='<table style="width:100%;border-collapse:collapse"><thead><tr style="border-bottom:1px solid var(--border);font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--muted)"><th style="text-align:left;padding:6px 4px">Date</th><th>Model</th><th>Sessions</th><th>Tokens In</th><th>Tokens Out</th><th>Compactions</th><th style="text-align:left">Notes</th></tr></thead><tbody>'+e.history.map(h=>`<tr style="border-bottom:1px solid var(--border)"><td style="padding:6px 4px;font-weight:600">${h.date}</td><td style="text-align:center"><span style="background:${h.model==='opus'?'var(--green)':'var(--blue)'};color:#fff;font-size:8px;padding:1px 6px;border-radius:3px;font-weight:700">${h.model.toUpperCase()}</span></td><td style="text-align:center">${h.sessions}</td><td style="text-align:center">${h.tokensIn}</td><td style="text-align:center">${h.tokensOut}</td><td style="text-align:center">${h.compactions}</td><td style="color:var(--muted)">${h.notes}</td></tr>`).join('')+'</tbody></table>';
  }
}

// ===== EXPENSE EDITOR =====
function showExpenseEditor(){
  let el=document.getElementById('expense-modal');
  if(el){el.remove();}
  const m=document.createElement('div');m.id='expense-modal';
  m.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px';
  const c=D.company.currency||'$';
  let html='<div style="background:var(--card);border-radius:12px;padding:20px;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;border:1px solid var(--border)">';
  html+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><h3 style="margin:0;font-size:16px">âœï¸ Expense Manager</h3><button onclick="document.getElementById(\'expense-modal\').remove()" style="background:none;border:none;color:var(--muted);font-size:18px;cursor:pointer">âœ•</button></div>';
  html+='<div style="font-size:9px;color:var(--amber);margin-bottom:12px">âš ï¸ Changes save to localStorage. Tell Forge via Telegram to make them permanent in JSON.</div>';
  html+='<table style="width:100%;border-collapse:collapse;font-size:11px"><thead><tr style="border-bottom:1px solid var(--border)"><th style="text-align:left;padding:4px">Name</th><th style="text-align:right;padding:4px">Amount</th><th style="text-align:center;padding:4px">Freq</th><th style="text-align:center;padding:4px">Cat</th><th style="width:30px"></th></tr></thead><tbody>';
  D.companyExpenses.forEach((e,i)=>{
    html+='<tr style="border-bottom:1px solid var(--border)">';
    html+='<td style="padding:4px"><input type="text" value="'+e.name.replace(/"/g,'&quot;')+'" data-idx="'+i+'" data-f="name" onchange="editExp(this)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:2px 6px;color:var(--text);width:100%;font-size:10px;font-family:inherit"></td>';
    html+='<td style="padding:4px;text-align:right"><input type="number" step="0.01" value="'+e.amount+'" data-idx="'+i+'" data-f="amount" onchange="editExp(this)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:2px 6px;color:var(--text);width:70px;text-align:right;font-size:10px;font-family:inherit"></td>';
    html+='<td style="padding:4px;text-align:center"><select data-idx="'+i+'" data-f="frequency" onchange="editExp(this)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:2px 4px;color:var(--text);font-size:9px;font-family:inherit"><option value="monthly"'+(e.frequency==='monthly'?' selected':'')+'>Monthly</option><option value="annual"'+(e.frequency==='annual'?' selected':'')+'>Annual</option><option value="one-time"'+(e.frequency==='one-time'?' selected':'')+'>One-time</option></select></td>';
    html+='<td style="padding:4px;text-align:center"><input type="text" value="'+(e.category||'Other')+'" data-idx="'+i+'" data-f="category" onchange="editExp(this)" style="background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:2px 4px;color:var(--text);width:80px;font-size:9px;font-family:inherit"></td>';
    html+='<td style="padding:4px"><button onclick="delExp('+i+')" style="background:var(--red);color:#fff;border:none;border-radius:4px;padding:2px 6px;font-size:9px;cursor:pointer">âœ•</button></td>';
    html+='</tr>';
  });
  html+='</tbody></table>';
  html+='<div style="margin-top:12px;display:flex;gap:8px"><button onclick="addExp()" style="background:var(--green);color:#fff;border:none;border-radius:6px;padding:6px 14px;font-size:11px;cursor:pointer;font-family:inherit">+ Add Expense</button>';
  html+='<button onclick="document.getElementById(\'expense-modal\').remove()" style="background:var(--accent);color:#fff;border:none;border-radius:6px;padding:6px 14px;font-size:11px;cursor:pointer;font-family:inherit">Done</button></div>';
  html+='</div>';
  m.innerHTML=html;
  document.body.appendChild(m);
}
function editExp(el){
  const i=+el.dataset.idx,field=el.dataset.f;
  D.companyExpenses[i][field]=field==='amount'?parseFloat(el.value)||0:el.value;
  localStorage.setItem('companyExpenses',JSON.stringify(D.companyExpenses));
  render();
}
function delExp(i){
  if(!confirm('Delete "'+D.companyExpenses[i].name+'"?'))return;
  D.companyExpenses.splice(i,1);
  localStorage.setItem('companyExpenses',JSON.stringify(D.companyExpenses));
  render();showExpenseEditor();
}
function addExp(){
  D.companyExpenses.push({id:'exp_new_'+Date.now(),name:'New Expense',amount:0,frequency:'monthly',category:'Other',verified:false});
  localStorage.setItem('companyExpenses',JSON.stringify(D.companyExpenses));
  render();showExpenseEditor();
}

// ===== EXPORT =====
function forceRefresh(){localStorage.clear();toast('Cache cleared â€” reloading...');setTimeout(()=>{window.location.href=window.location.pathname+'?bust='+Date.now()+(window.location.hash||'');},500);}
function exportAll(){
  let csv='Date,Brand,Product,Orders,Revenue,Ad Spend,COGS,Profit,ROAS\n';
  D.daily.forEach(e=>{const p=e.revenue-e.adSpend-e.cogs;csv+=`${e.date},"${e.brandName}","${e.productName}",${e.orders},${e.revenue.toFixed(2)},${e.adSpend.toFixed(2)},${e.cogs.toFixed(2)},${p.toFixed(2)},${e.adSpend>0?(e.revenue/e.adSpend).toFixed(2):'0'}\n`;});
  dl('anton-empire-daily.csv',csv,'text/csv');toast('Exported');
}
function exportJSON(){dl('anton-empire-backup.json',JSON.stringify(D,null,2),'application/json');toast('Backup saved');}
function importJSON(){document.getElementById('impFile').click();}
function handleImport(ev){
  const f=ev.target.files[0];if(!f)return;const r=new FileReader();
  r.onload=function(e){try{const d=JSON.parse(e.target.result);if(d.company)D.company=d.company;if(d.companyExpenses)D.companyExpenses=d.companyExpenses;if(d.brands)D.brands=d.brands;if(d.daily)D.daily=d.daily;sv();render();toast('Imported');}catch(e){toast('Bad file',1);}};
  r.readAsText(f);
}
function resetAll(){if(confirm('Delete ALL data?')){D.companyExpenses=[];D.brands=[];D.daily=[];sv();render();toast('Reset');}}
function dl(n,c,t){const b=new Blob([c],{type:t});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=n;a.click();}
function toast(m,e){const t=document.getElementById('toast');t.textContent=m;t.style.background=e?'var(--red)':'var(--green)';t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

// ===== KPI / ROADMAP / TASKLOG RENDER =====
function renderCriticalTasks(data){
  if(!data||!data.dailyCriticalTasks)return;
  const ct=data.dailyCriticalTasks;
  const dateEl=document.getElementById('ct-date');
  if(dateEl){const d=new Date(ct.date+'T12:00:00');dateEl.textContent=d.toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'});}
  const container=document.getElementById('ct-members');
  let totalTasks=0,totalDone=0;

  // Merge localStorage completions
  const saved=JSON.parse(localStorage.getItem('ae2_criticalTasks')||'null');
  if(saved&&saved.date===ct.date&&saved.members){
    Object.keys(saved.members).forEach(k=>{
      if(ct.members[k]&&saved.members[k]){
        saved.members[k].tasks.forEach((st,i)=>{if(ct.members[k].tasks[i])ct.members[k].tasks[i].done=st.done;});
      }
    });
  }

  container.innerHTML=Object.keys(ct.members).map(key=>{
    const m=ct.members[key];
    const done=m.tasks.filter(t=>t.done).length;
    totalTasks+=m.tasks.length;totalDone+=done;
    const pct=Math.round(done/m.tasks.length*100);
    const color=pct>=100?'var(--green)':pct>=60?'var(--amber)':'var(--red)';
    const rows=m.tasks.map((t,i)=>{
      const pri=t.task.startsWith('ğŸ”´')?'border-left:3px solid var(--red);':t.task.startsWith('ğŸŸ¡')?'border-left:3px solid var(--amber);':'border-left:3px solid var(--green);';
      return`<div style="display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:4px;background:${t.done?'rgba(76,175,80,0.04)':'var(--bg)'};border-radius:8px;${pri}cursor:pointer;transition:all .2s" onclick="toggleTask('${key}',${i})">
        <span style="font-size:18px;flex-shrink:0">${t.done?'âœ…':'â¬œ'}</span>
        <span style="flex:1;font-size:12px;${t.done?'text-decoration:line-through;color:var(--muted)':'font-weight:500'}">${t.task}</span>
        ${t.done?'<span style="font-size:9px;color:var(--green);font-weight:600">DONE</span>':''}
      </div>`;
    }).join('');
    return`<div class="card" style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h2 style="margin:0;font-size:14px">${m.name}</h2>
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:12px;font-weight:800;color:${color}">${done}/${m.tasks.length}</span>
          <div style="width:60px;height:6px;background:var(--bg);border-radius:3px;overflow:hidden">
            <div style="height:100%;width:${pct}%;background:${color};border-radius:3px;transition:width .3s"></div>
          </div>
        </div>
      </div>
      ${rows}
    </div>`;
  }).join('');

  // Overall progress ring
  const overallPct=totalTasks>0?Math.round(totalDone/totalTasks*100):0;
  const ring=document.getElementById('ct-ring');
  if(ring){
    const circ=2*Math.PI*42;
    ring.style.strokeDasharray=circ;
    ring.style.strokeDashoffset=circ-(circ*overallPct/100);
    ring.style.stroke=overallPct>=100?'var(--green)':overallPct>=60?'var(--amber)':'var(--red)';
  }
  const oEl=document.getElementById('ct-overall');
  if(oEl)oEl.textContent=overallPct+'%';

  // ROI Tracker
  if(data.productivity&&data.productivity.totals){
    const p=data.productivity.totals||{};
    const el=id=>document.getElementById(id);
    if(el('roi-equiv')&&p.humanCostEquiv)el('roi-equiv').textContent='$'+p.humanCostEquiv.toLocaleString();
    if(el('roi-hours')&&p.forgeHours!=null)el('roi-hours').textContent=p.forgeHours+'h';
    if(el('roi-hequiv')&&p.humanEquivHours!=null)el('roi-hequiv').textContent=p.humanEquivHours+'h';
    if(el('roi-tasks')&&p.tasksCompleted!=null)el('roi-tasks').textContent=p.tasksCompleted;
    if(el('roi-since')&&data.productivity.since)el('roi-since').textContent='since '+new Date(data.productivity.since+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short'});
    if(el('roi-note')&&p.hourlyRate&&p.humanEquivHours&&p.humanCostEquiv)el('roi-note').textContent='Based on $'+p.hourlyRate+'/hr VA rate Â· '+p.humanEquivHours+'h would cost $'+p.humanCostEquiv;

    // Time split bar (today)
    const today=data.productivity.days[data.productivity.days.length-1];
    if(today){
      const total=today.antonHours+today.forgeHours;
      if(el('ct-split-anton'))el('ct-split-anton').style.width=(today.antonHours/total*100)+'%';
      if(el('ct-split-forge'))el('ct-split-forge').style.width=(today.forgeHours/total*100)+'%';
      if(el('ct-split-label'))el('ct-split-label').textContent='Anton '+today.antonHours+'h input â†’ Forge '+today.forgeHours+'h output â†’ '+today.humanEquivHours+'h human equiv.';
    }
  }

  // Completion history chart
  if(data.taskHistory){
    const hist=document.getElementById('ct-history');
    if(hist){
      hist.innerHTML=data.taskHistory.map(d=>{
        const aTotal=d.anton.total,aDone=d.anton.done,fTotal=d.forge.total,fDone=d.forge.done;
        const allDone=aDone+fDone,allTotal=aTotal+fTotal;
        const pct=Math.round(allDone/allTotal*100);
        const dt=new Date(d.date+'T12:00:00').toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'});
        const color=pct>=100?'var(--green)':pct>=60?'var(--amber)':'var(--red)';
        return`<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <div style="width:70px;font-size:10px;color:var(--muted);flex-shrink:0">${dt}</div>
          <div style="flex:1;height:14px;background:var(--bg);border-radius:4px;overflow:hidden;position:relative">
            <div style="height:100%;width:${pct}%;background:${color};border-radius:4px;transition:width .3s"></div>
            <span style="position:absolute;right:6px;top:1px;font-size:9px;font-weight:700">${allDone}/${allTotal}</span>
          </div>
          <div style="width:35px;text-align:right;font-size:11px;font-weight:800;color:${color}">${pct}%</div>
        </div>`;
      }).join('');
    }
  }
}
function toggleTask(member,idx){
  if(!_jsonData||!_jsonData.dailyCriticalTasks)return;
  const t=_jsonData.dailyCriticalTasks.members[member].tasks[idx];
  t.done=!t.done;
  renderCriticalTasks(_jsonData);
  // Save to localStorage
  localStorage.setItem('ae2_criticalTasks',JSON.stringify(_jsonData.dailyCriticalTasks));
}

function renderTeam(data){
  if(!data||!data.team)return;
  const team=data.team;
  const biz=team.filter(t=>t.domain!=='personal');
  const active=biz.filter(t=>t.status==='active');
  const planned=biz.filter(t=>t.status==='planned');
  document.getElementById('tm-active').textContent=active.length;
  document.getElementById('tm-planned').textContent=planned.length;

  // --- Org Tree Diagram ---
  const tree=document.getElementById('org-tree');
  if(tree){
    const nodeStyle=(t,big)=>{
      const isActive=t.status==='active';
      const border=isActive?'var(--green)':'var(--amber)';
      const bg=isActive?'rgba(76,175,80,0.08)':'rgba(255,193,7,0.08)';
      const icon=t.emoji||( t.type==='human'?'ğŸ‘¤':'ğŸ¤–');
      const w=big?'180px':'140px';
      const fs=big?'13px':'11px';
      return`<div style="display:inline-flex;flex-direction:column;align-items:center;padding:${big?'14px 18px':'10px 14px'};border:2px solid ${border};border-radius:12px;background:${bg};min-width:${w};position:relative">
        <div style="font-size:${big?'22px':'16px'};margin-bottom:4px">${icon}</div>
        <div style="font-weight:700;font-size:${fs};color:var(--text)">${t.name}</div>
        <div style="font-size:${big?'10px':'9px'};color:var(--muted);text-align:center">${t.role}</div>
        <div style="margin-top:4px;font-size:9px;padding:2px 8px;border-radius:10px;background:${isActive?'var(--green)':'var(--amber)'};color:#000;font-weight:600">${isActive?'ACTIVE':'PLANNED'}</div>
      </div>`;
    };
    const line=`<div style="width:2px;height:20px;background:var(--border);margin:0 auto"></div>`;
    const hLine=`<div style="height:2px;background:var(--border);flex:1"></div>`;

    // CEO at top
    const ceo=biz.find(t=>t.id==='anton')||biz[0];
    const coo=biz.find(t=>t.id==='forge')||biz[1];
    const reports=biz.filter(t=>t.id!=='anton'&&t.id!=='forge');

    let html=nodeStyle(ceo,true);
    html+=line;
    html+=nodeStyle(coo,true);
    if(reports.length){
      html+=line;
      // horizontal connector
      html+=`<div style="display:flex;align-items:flex-start;justify-content:center;width:100%;position:relative">`;
      html+=`<div style="position:absolute;top:0;left:50%;transform:translateX(-50%);height:2px;background:var(--border);width:${Math.min(reports.length*160,800)}px"></div>`;
      html+=`</div>`;
      html+=`<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:2px">`;
      reports.forEach(t=>{
        html+=`<div style="display:flex;flex-direction:column;align-items:center">${line}${nodeStyle(t,false)}</div>`;
      });
      html+=`</div>`;
    }
    tree.innerHTML=html;
  }
  // Profile Cards
  const profiles=document.getElementById('tm-profiles');
  if(profiles){
    profiles.innerHTML=biz.map(t=>{
      const isActive=t.status==='active';
      const border=isActive?'var(--green)':'var(--amber)';
      const badge=isActive?'<span style="font-size:9px;padding:2px 8px;border-radius:10px;background:var(--green);color:#000;font-weight:700">ACTIVE</span>':'<span style="font-size:9px;padding:2px 8px;border-radius:10px;background:var(--amber);color:#000;font-weight:700">PLANNED</span>';
      const since=t.since?new Date(t.since+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}):'â€”';
      const emoji=t.emoji||'ğŸ¤–';
      const row=(label,val)=>val?`<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border)"><span style="font-size:10px;color:var(--muted)">${label}</span><span style="font-size:10px;font-weight:600;text-align:right;max-width:200px">${val}</span></div>`:'';
      return`<div style="background:var(--card);border:1px solid var(--border);border-top:3px solid ${border};border-radius:12px;padding:16px;position:relative">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <div style="width:42px;height:42px;border-radius:50%;background:${isActive?'rgba(76,175,80,0.1)':'rgba(255,193,7,0.1)'};display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">${emoji}</div>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:6px"><span style="font-size:15px;font-weight:800">${t.name}</span>${badge}</div>
            <div style="font-size:11px;color:var(--muted)">${t.role}</div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:0">
          ${row('Phase',t.phase||'â€”')}
          ${row('Type',t.type==='human'?'ğŸ‘¤ Human':'ğŸ¤– AI Agent')}
          ${row('Personality',t.personality||'â€”')}
          ${row('Profile',t.demographic||'â€”')}
          ${row('Since',since)}
          ${row('Strengths',t.strengths||'â€”')}
          ${row('Style',t.style||'â€”')}
        </div>
        <div style="margin-top:10px;padding:8px 10px;background:var(--bg);border-radius:8px;font-size:10px;color:var(--muted)">
          <strong style="color:var(--text)">Responsibilities:</strong> ${t.responsibilities}
        </div>
        ${t.notes?'<div style="margin-top:6px;font-size:9px;color:var(--amber);font-style:italic">'+t.notes+'</div>':''}
      </div>`;
    }).join('');
  }

  // Legacy table (hidden)
  const tb=document.getElementById('tm-table');
  tb.innerHTML='';

  // Job Monitor
  if(data.jobMonitor&&data.jobMonitor.length){
    const jobs=data.jobMonitor;
    // Populate filter dropdown
    const filt=document.getElementById('jm-filter');
    const members=[...new Set(jobs.map(j=>j.member))];
    filt.innerHTML='<option value="all">All Members</option>'+members.map(m=>'<option value="'+m+'">'+m+'</option>').join('');
    window._jobData=jobs;
    filterJobMonitor();
  }
}
function filterJobMonitor(){
  const jobs=window._jobData||[];
  const filt=document.getElementById('jm-filter').value;
  const filtered=filt==='all'?jobs:jobs.filter(j=>j.member===filt);
  const done=filtered.filter(j=>j.status==='done').length;
  document.getElementById('jm-total').textContent=filtered.length;
  document.getElementById('jm-done').textContent=done;
  // Avg duration
  const durations=filtered.map(j=>{
    const d=j.duration||'';const m=d.match(/(\d+)h/);const m2=d.match(/(\d+)m/);
    return(m?parseInt(m[1])*60:0)+(m2?parseInt(m2[1]):0);
  }).filter(d=>d>0);
  const avg=durations.length?Math.round(durations.reduce((a,b)=>a+b,0)/durations.length):0;
  document.getElementById('jm-avgtime').textContent=avg>=60?Math.floor(avg/60)+'h '+avg%60+'m':avg+'m';
  // Resources
  const models={};filtered.forEach(j=>{const m=j.model||'â€”';if(!models[m])models[m]=0;models[m]++;});
  document.getElementById('jm-resources').textContent=Object.entries(models).map(([k,v])=>k+': '+v).join(' Â· ')||'â€”';
  // Table
  const tbl=document.getElementById('jm-table');
  const statusMap={done:'<span style="color:var(--green);font-weight:700">âœ… Done</span>',active:'<span style="color:var(--blue);font-weight:700">ğŸ”„ Active</span>',pending:'<span style="color:var(--amber);font-weight:700">â³ Pending</span>'};
  const modelColor={Opus:'var(--amber)',Sonnet:'var(--purple)','â€”':'var(--muted)'};
  tbl.innerHTML=filtered.sort((a,b)=>(b.started||'').localeCompare(a.started||'')).map(j=>{
    const dt=j.started?new Date(j.started).toLocaleDateString('en-GB',{day:'numeric',month:'short'})+' '+new Date(j.started).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}):'â€”';
    return'<tr><td style="font-weight:600;white-space:nowrap">'+j.member+'</td><td>'+j.task+'</td><td>'+(statusMap[j.status]||j.status)+'</td><td style="white-space:nowrap;font-size:10px">'+dt+'</td><td style="font-weight:600">'+j.duration+'</td><td><span style="color:'+(modelColor[j.model]||'var(--muted)')+';font-weight:600;font-size:10px">'+j.model+'</span></td></tr>';
  }).join('')||'<tr><td colspan="6" class="empty">No tasks recorded</td></tr>';
}

function renderKPI(data){
  if(!data||!data.kpiTargets)return;
  const kt=data.kpiTargets;
  document.getElementById('kpi-week').textContent='Week of '+kt.weekOf;
  const container=document.getElementById('kpi-departments');
  const depts=kt.departments;
  container.innerHTML=Object.keys(depts).map(key=>{
    const dept=depts[key];
    const rows=dept.targets.map(t=>{
      const pct=t.target>0?Math.min((t.current/t.target)*100,100):0;
      const status=pct>=100?'ğŸŸ¢ Done':pct>=60?'ğŸŸ¡ On Track':'ğŸ”´ Behind';
      const barColor=pct>=100?'var(--green)':pct>=60?'var(--amber)':'var(--red)';
      return`<div style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
          <span style="font-size:12px;font-weight:600">${t.metric}</span>
          <span style="font-size:11px;font-weight:700">${t.current}/${t.target} ${t.unit} ${status}</span>
        </div>
        <div style="height:8px;background:var(--bg);border-radius:4px;overflow:hidden">
          <div style="height:100%;width:${pct}%;background:${barColor};border-radius:4px;transition:width .4s"></div>
        </div>
      </div>`;
    }).join('');
    return`<div class="card" style="margin-bottom:12px">
      <h2>${dept.name} <span style="font-size:10px;color:var(--muted);font-weight:400">Owner: ${dept.owner}</span></h2>
      ${rows}
    </div>`;
  }).join('');
}

function renderRoadmap(data){
  if(!data||!data.roadmap)return;
  const rm=data.roadmap;
  const ownerIcon=(o)=>o==='Forge'||o==='forge'?'ğŸ”±':o==='Anton'||o==='anton'?'ğŸ‘‘':o.includes('Forge')?'ğŸ”±ğŸ‘‘':'ğŸ“‹';
  const taskCard=(p,showStatus=true)=>{
    const icon=p.status==='done'?'âœ…':p.status==='in-progress'?'ğŸ”„':p.status==='blocked'?'ğŸš«':'â¬œ';
    const bg=p.status==='done'?'rgba(76,175,80,0.04)':p.status==='blocked'?'rgba(239,68,68,0.04)':'var(--bg)';
    const border=p.status==='done'?'var(--green)':p.status==='in-progress'?'var(--amber)':p.status==='blocked'?'var(--red)':'var(--border)';
    const statusColor=p.status==='done'?'var(--green)':p.status==='in-progress'?'var(--amber)':p.status==='blocked'?'var(--red)':'var(--muted)';
    return`<div style="display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:4px;background:${bg};border-radius:8px;border-left:3px solid ${border}">
      <span style="font-size:14px;flex-shrink:0">${icon}</span>
      <div style="flex:1"><span style="font-size:11px;font-weight:500;${p.status==='done'?'text-decoration:line-through;color:var(--muted)':''}">${p.task}</span>${p.blocker?`<br><span style="font-size:9px;color:var(--red)">âš ï¸ ${p.blocker}</span>`:''}</div>
      ${showStatus?`<span style="font-size:9px;color:${statusColor};font-weight:700;text-transform:uppercase;white-space:nowrap">${p.status.replace('-',' ')}</span>`:''}
      <span style="font-size:12px;flex-shrink:0" title="${p.owner||''}">${ownerIcon(p.owner||'')}</span>
    </div>`;
  };
  if(rm.thisWeek){
    document.getElementById('rm-thisweek').textContent='Week of '+rm.thisWeek.weekOf;
    const tasks=rm.thisWeek.priorities;
    const done=tasks.filter(t=>t.status==='done').length;
    const pct=Math.round(done/tasks.length*100);
    const pctEl=document.getElementById('rm-this-pct');
    if(pctEl){pctEl.textContent=done+'/'+tasks.length+' ('+pct+'%)';pctEl.style.color=pct>=100?'var(--green)':pct>=50?'var(--amber)':'var(--red)';}
    const fill=document.getElementById('rm-this-fill');
    if(fill){fill.style.width=pct+'%';fill.style.background=pct>=100?'var(--green)':pct>=50?'var(--amber)':'var(--red)';}
    document.getElementById('rm-this').innerHTML=tasks.map(p=>taskCard(p)).join('');
  }
  if(rm.nextWeek){
    document.getElementById('rm-nextweek').textContent='Week of '+rm.nextWeek.weekOf;
    document.getElementById('rm-next').innerHTML=rm.nextWeek.priorities.map(p=>taskCard(p,false)).join('');
  }
}

function renderTaskLog(data){
  if(!data||!data.taskLog)return;
  const tl=data.taskLog.slice().reverse();
  const tb=document.getElementById('tl-table');
  tb.innerHTML=tl.map(t=>{
    const icon=t.status==='done'?'âœ…':t.status==='in-progress'?'ğŸ”„':'ğŸš«';
    const sColor=t.status==='done'?'green':t.status==='in-progress'?'amber':'red';
    const started=t.started?new Date(t.started).toLocaleString('en-GB',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'}):'â€”';
    const finished=t.finished?new Date(t.finished).toLocaleString('en-GB',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'}):'â€”';
    let duration='â€”';
    if(t.started&&t.finished){const ms=new Date(t.finished)-new Date(t.started);duration=Math.round(ms/60000)+' min';}
    else if(t.started&&t.status==='in-progress'){const ms=Date.now()-new Date(t.started);duration=Math.round(ms/60000)+' min (active)';}
    return`<tr>
      <td><span class="${sColor}" style="font-weight:700">${icon} ${t.status}</span></td>
      <td style="font-weight:600">${t.task}</td>
      <td>${t.owner||'Forge'}</td>
      <td style="font-size:10px">${started}</td>
      <td style="font-size:10px">${finished}</td>
      <td style="font-size:10px;font-weight:600">${duration}</td>
    </tr>`;
  }).join('');
}

let _jsonData=null;

// ===== BACKUP & RECOVERY =====
const backupFiles = [
  {name:'SOUL.md', desc:'Forge\'s identity & personality', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/SOUL.md'},
  {name:'USER.md', desc:'About Anton â€” context & preferences', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/USER.md'},
  {name:'MEMORY.md', desc:'Long-term memory â€” everything Forge knows', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/MEMORY.md'},
  {name:'AGENTS.md', desc:'Operating instructions & rules', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/AGENTS.md'},
  {name:'IDENTITY.md', desc:'Name, emoji, birth date', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/IDENTITY.md'},
  {name:'TOOLS.md', desc:'Local tool notes & config', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/TOOLS.md'},
  {name:'SOS.md', desc:'Emergency recovery guide', url:'https://raw.githubusercontent.com/AntonUrso2811/forge-workspace/main/SOS.md'},
];

function renderBackupFiles(){
  const el=document.getElementById('backup-files');
  if(!el)return;
  el.innerHTML=backupFiles.map(f=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
      <div>
        <div style="font-size:12px;font-weight:600">${f.name}</div>
        <div style="font-size:10px;color:var(--muted)">${f.desc}</div>
      </div>
      <button class="btn-s btn-o" onclick="downloadFile('${f.url}','${f.name}')">ğŸ“¥</button>
    </div>
  `).join('');
}

async function downloadFile(url,name){
  try{
    const r=await fetch(url);
    if(!r.ok)throw new Error('Failed');
    const b=await r.blob();
    const a=document.createElement('a');
    a.href=URL.createObjectURL(b);
    a.download=name;
    a.click();
    toast('Downloaded '+name);
  }catch(e){
    toast('Failed â€” open GitHub directly');
    window.open('https://github.com/AntonUrso2811/forge-workspace','_blank');
  }
}

async function downloadAllBackup(){
  toast('Downloading files individually...');
  for(const f of backupFiles){
    await downloadFile(f.url,f.name);
    await new Promise(r=>setTimeout(r,500));
  }
  toast('All files downloaded âœ…');
}

renderBackupFiles();

// ===== INIT =====
document.getElementById('d-date').valueAsDate=new Date();
document.getElementById('e-date').valueAsDate=new Date();
document.getElementById('s-company').value=D.company.name;
document.getElementById('s-cur').value=D.company.currency;
document.getElementById('s-tax').value=D.company.taxRate;
document.getElementById('s-margin').value=D.company.targetNetMargin;
document.getElementById('d-brand').onchange=updateProdDropdown;
render();
loadFromJSON();

// ===== AUTO-FRESHNESS CHECK =====
// Every 60s, check if JSON has been updated. If so, reload data silently.
setInterval(async()=>{
  try{
    const r=await fetch('company-data.json?t='+Date.now(),{cache:'no-store'});
    if(!r.ok)return;
    const j=await r.json();
    if(j.lastUpdated&&D.lastUpdated&&j.lastUpdated!==D.lastUpdated){
      console.log('Data updated, refreshing...');
      loadFromJSON();
    }
  }catch(e){}
},60000);
</script>
</body>
</html>

<!-- cache-bust: ${Date.now()} -->
